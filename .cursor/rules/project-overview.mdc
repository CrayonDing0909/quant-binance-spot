---
alwaysApply: true
---
# Project Overview — quant-binance-spot

Binance Spot/Futures quantitative trading system. Python 3.11, vectorbt-based backtesting.

## Environment

- **Activate venv first**: `source .venv/bin/activate` (Python 3.11 symlink)
- **Run scripts**: `PYTHONPATH=src python scripts/<script>.py -c config/<config>.yaml`
- **Run tests**: `python -m pytest tests/ -x -q --tb=short`
- **Install packages**: `python3.11 -m pip install <pkg>` (ensures correct site-packages)

## Production Strategy

- **Active**: R3C 10-Symbol Ensemble (BTC: breakout_vol_atr, ETH: tsmom_multi_ema, 8 others: tsmom_ema)
- **Config**: [prod_live_R3C_E3.yaml](mdc:config/prod_live_R3C_E3.yaml)
- **Base strategy template**: [futures_tsmom.yaml](mdc:config/futures_tsmom.yaml) (TSMOM EMA definition, not used in prod directly)
- **Deployment**: Oracle Cloud (x86_64, 1GB RAM), WebSocket mode via tmux (`r3c_e3_live`)

## Approved Candidates (pending paper trading)

- **OI Liquidation Bounce v4.2**: 5-symbol long-only (BTC/ETH/SOL/DOGE/AVAX), 1x leverage
  - **Config**: [research_oi_liq_bounce.yaml](mdc:config/research_oi_liq_bounce.yaml)
  - **Strategy code**: [oi_liq_bounce_strategy.py](mdc:src/qtrade/strategy/oi_liq_bounce_strategy.py)
  - **Status**: Risk Manager APPROVED (2026-02-25), pending paper trading ≥ 2 weeks
  - **Deployment conditions**: position_pct=0.50, circuit_breaker_pct=0.10, confirm OI data stability
  - **Key metrics**: Portfolio SR=2.49, MDD=-1.3%, time-in-market=4.2%, correlation w/ R3C ≈ 0.01

- **Meta-Blend 8-Symbol** (R3C x tsmom_carry_v2): multi-strategy signal blend, 3x leverage
  - **Config**: [prod_candidate_meta_blend.yaml](mdc:config/prod_candidate_meta_blend.yaml)
  - **Strategy code**: [meta_blend_strategy.py](mdc:src/qtrade/strategy/meta_blend_strategy.py)
  - **Status**: Risk Manager APPROVED (2026-02-25), pending paper trading 1-2 weeks

## Strategy Portfolio Management

Rules for adding/replacing/retiring strategies in a multi-strategy portfolio:
- **Governance doc**: [STRATEGY_PORTFOLIO_GOVERNANCE.md](mdc:docs/STRATEGY_PORTFOLIO_GOVERNANCE.md)
- **Compare strategies**: `scripts/compare_strategies.py` — marginal Sharpe, correlation matrix, optimal weights, redundancy check
- **Multi-strategy backtest**: `scripts/run_portfolio_backtest.py --multi-strategy` — combine N independent strategy configs
- **Auto-generate blend config**: `scripts/generate_blend_config.py` — produce meta_blend YAML from comparison output

## Directory Map

See [CLI_REFERENCE.md](mdc:docs/CLI_REFERENCE.md) for full project map (auto-generated by `scripts/gen_cli_reference.py`).

```
src/qtrade/
├── config.py           ← AppConfig dataclass, load_config()
├── strategy/           ← Strategy implementations
│   ├── base.py         ← StrategyContext (market_type, direction, signal_delay)
│   ├── tsmom_strategy.py ← Active production strategy
│   └── exit_rules.py   ← SL/TP/Adaptive SL
├── backtest/
│   ├── run_backtest.py ← BacktestResult dataclass, run_symbol_backtest()
│   ├── costs.py        ← Funding Rate + Volume Slippage cost model
│   └── metrics.py      ← Performance metrics + Long/Short analysis
├── live/
│   ├── base_runner.py  ← BaseRunner ABC (14 shared safety mechanisms)
│   ├── runner.py       ← LiveRunner (Polling, inherits BaseRunner)
│   ├── websocket_runner.py ← WebSocketRunner (Event-driven)
│   └── signal_generator.py ← SignalResult dataclass
├── validation/         ← WFA, DSR, PBO, CPCV, IC monitor
├── data/               ← Multi-source: Binance/yfinance/ccxt
├── risk/               ← Position sizing, Kelly, Monte Carlo
└── monitor/            ← Health check, Telegram, notifier

config/                 ← Active configs only (~15)
config/archive/         ← Deprecated / completed research configs
scripts/                ← Active reusable scripts (~30)
scripts/archive/        ← One-off research / migration scripts
docs/                   ← Living docs (~5 files)
docs/archive/           ← Historical / superseded docs
```

## Signal Convention

- **Spot**: `[0, 1]` — 0=cash, 1=full long
- **Futures**: `[-1, 1]` — -1=full short, 0=flat, 1=full long
- Strategies can output `[-1, 1]` uniformly; negative values are auto-clipped for Spot

## Key Dataclasses

- `AppConfig` ([config.py](mdc:src/qtrade/config.py)) — unified YAML config
- `StrategyContext` ([base.py](mdc:src/qtrade/strategy/base.py)) — market_type, direction, signal_delay
- `BacktestResult` ([run_backtest.py](mdc:src/qtrade/backtest/run_backtest.py)) — standardized backtest output
- `SignalResult` ([signal_generator.py](mdc:src/qtrade/live/signal_generator.py)) — type-safe live signal

## Config Pattern

Always use `cfg.to_backtest_dict()` / `cfg.market_type_str` / `cfg.direction` — never manually assemble.
Research configs go in `config/research_*.yaml`; NEVER modify production config during research.

## Team — 5-Agent Workflow

This project uses 5 specialized agents. Each agent has a clear scope and handoff protocol.

### Agent Roster

| Agent | Definition | Scope |
|-------|------------|-------|
| Alpha Researcher | `.cursor/agents/alpha-researcher.md` | Strategy discovery, on-chain data, Notebook EDA, Strategy Proposal |
| Quant Developer | `.cursor/agents/quant-developer.md` | Strategy implementation, backtest execution, report generation |
| Quant Researcher | `.cursor/agents/quant-researcher.md` | Alpha validation, bias detection, statistical testing, GO/FAIL verdict |
| Risk Manager | `.cursor/agents/risk-manager.md` | Pre-launch risk audit, weekly/monthly portfolio risk review |
| DevOps | `.cursor/agents/devops.md` | Oracle Cloud deployment, monitoring, data management, incident response |

### Workflow & Handoff

```
Alpha Researcher ─── Strategy Proposal ──→ Quant Developer
                                              │
                                    BacktestResult + Report
                                              │
                                              ▼
                               Quant Researcher (validation)
                                  │                  │
                             GO_NEXT            NEED_MORE_WORK / FAIL
                                  │                  │
                                  ▼                  ▼
                            Risk Manager        Back to Developer
                              │       │         (or Alpha Researcher)
                         APPROVED  REJECTED
                              │       │
                              ▼       ▼
                           DevOps   Back to Developer
                              │
                    ┌─────────┴─────────┐
                    │   Production      │
                    │   (live trading)  │
                    └─────────┬─────────┘
                              │
                    Risk Manager (periodic)
                    Weekly quick + Monthly deep
```

### Handoff Rules

1. **Alpha Researcher → Quant Developer**: Strategy Proposal must be complete (all fields filled). Developer confirms data availability before starting.
2. **Quant Developer → Quant Researcher**: BacktestResult + full report (metrics, yearly, WFA, cost stress). Must use `config/research_*.yaml`.
3. **Quant Researcher → Risk Manager**: Only on `GO_NEXT` verdict. Includes validation report + BacktestResult path.
4. **Risk Manager → DevOps**: Only on `APPROVED` verdict. Includes Risk Audit Report + deployment config.
5. **Risk Manager → Quant Developer**: On `REJECTED`, includes specific failures and remediation guidance.
6. **Quant Researcher → Quant Developer**: On `NEED_MORE_WORK`, includes specific gates that failed.
7. **Quant Researcher → Alpha Researcher**: If the hypothesis itself is flawed (not just implementation).