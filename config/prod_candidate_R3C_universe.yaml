# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# PRODUCTION CANDIDATE ‚Äî R3C Universe (Micro Accel + 19 Symbols)
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# Created: 2026-02-21
# Origin: research_r3_trackA_C_universe.yaml
# Lineage: R2.1 ‚Üí R3 Track A Config C (Aggressive) + 19-Symbol Universe
#
# CHANGE vs R2.1:
#   Expanded from 3 ‚Üí 19 symbols, vol-parity weighting
#   Added microstructure accel overlay (aggressive C params)
#   MATICUSDT excluded (Binance MATIC‚ÜíPOL migration)
#   All base strategy entry logic UNCHANGED
#   All cost/risk/position params UNCHANGED (except MaxDD raised to 40%)
#
# Ensemble:
#   BTC  ‚Üí breakout_vol_atr + time_stop 72h + vol_scale 0.7 + volume_confirm
#   ETH  ‚Üí tsmom_multi_ema (lookbacks 72/168/336/720)
#   All others ‚Üí tsmom_ema (lookback 168)
#   Base Overlay ‚Üí vol_spike_z=2.0, cooldown=12 bars
#   Micro Accel  ‚Üí aggressive (C): boost 45%, reduce 40%, floor 0.1, cap 1.0
#
# Research Evidence:
#   1.0x: Sharpe 6.11 | CAGR 82.41% | MaxDD 3.03%
#   1.5x: Sharpe 5.08 | CAGR 64.61% | MaxDD 3.37%
#   2.0x: Sharpe 4.06 | CAGR 48.78% | MaxDD 4.83%
#   +1 bar delay: Sharpe drop 3.4% (PASS)
#   Truncation invariance: all PASS
#   Yearly: all years positive
#
# RISK STATEMENT:
#   - Sharpe > 5 is exceptionally high; expect live degradation
#   - WF tested base-strategy only (overlay not included in WF splits)
#   - Paper-trade minimum 4 weeks before sizing up
#   - Monitor per-symbol divergence from backtest weekly
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

market:
  symbols:
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - XRPUSDT
    - DOGEUSDT
    - ADAUSDT
    - AVAXUSDT
    - LINKUSDT
    - DOTUSDT
    - LTCUSDT
    - NEARUSDT
    - APTUSDT
    - ARBUSDT
    - OPUSDT
    - FILUSDT
    - ATOMUSDT
    - UNIUSDT
    - AAVEUSDT
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "tsmom_ema"
  params:
    lookback: 168
    vol_target: 0.15
    ema_fast: 20
    ema_slow: 50
    agree_weight: 1.0
    disagree_weight: 0.3
  symbol_overrides: {}

  # ‚îÄ‚îÄ Vol-only Overlay (inherited from R2.1) ‚îÄ‚îÄ
  overlay:
    enabled: true
    mode: "oi_vol"
    params:
      oi_extreme_z: 999.0
      oi_reversal_window: 6
      reduce_pct: 0.5
      oi_lookback: 24
      oi_z_window: 168
      vol_spike_z: 2.0
      overlay_cooldown_bars: 12
      trend_lookback: 20
      atr_period: 14
      vol_z_window: 168

  # ‚îÄ‚îÄ Microstructure Accel Overlay (R3 Track A ‚Äî AGGRESSIVE) ‚îÄ‚îÄ
  micro_accel_overlay:
    enabled: true
    params:
      # Feature computation
      taker_window: 12
      vol_short_window: 12
      vol_long_window: 168
      ema_slope_period: 12
      ema_slope_norm_window: 48
      return_burst_window: 6
      oi_lookback: 24
      oi_z_window: 168
      # Scoring weights
      w_taker: 0.30
      w_vol: 0.10
      w_slope: 0.25
      w_burst: 0.25
      w_oi: 0.10
      # Overlay action thresholds (AGGRESSIVE / C)
      accel_threshold: 0.15
      decel_threshold: 0.15
      adverse_threshold: 0.45
      boost_pct: 0.45
      reduce_pct: 0.40
      size_floor: 0.10
      size_cap: 1.0
      cooldown_bars: 2
      adverse_exit_enabled: true
      adverse_exit_to: 0.0

ensemble:
  enabled: true
  weight_mode: "fixed"
  # Vol-parity weights (computed from trailing 720h realized vol)
  fixed_weights:
    BTCUSDT: 0.0722
    ETHUSDT: 0.0538
    SOLUSDT: 0.0509
    BNBUSDT: 0.0707
    XRPUSDT: 0.0491
    DOGEUSDT: 0.0512
    ADAUSDT: 0.0511
    AVAXUSDT: 0.0545
    LINKUSDT: 0.0538
    DOTUSDT: 0.0540
    LTCUSDT: 0.0605
    NEARUSDT: 0.0495
    APTUSDT: 0.0483
    ARBUSDT: 0.0495
    OPUSDT: 0.0426
    FILUSDT: 0.0489
    ATOMUSDT: 0.0523
    UNIUSDT: 0.0394
    AAVEUSDT: 0.0477
  vol_parity:
    lookback: 720
    min_weight: 0.03
    max_weight: 0.20

  strategies:
    BTCUSDT:
      name: "breakout_vol_atr"
      params:
        channel_period: 336
        channel_multiplier: 2.5
        atr_period: 14
        vol_fast_period: 14
        vol_slow_period: 72
        expansion_ratio: 1.1
        fake_breakout_bars: 6
        min_hold_bars: 24
        trail_exit_mid: true
        stop_loss_atr: 3.5
        max_holding_bars: 72
        cooldown_bars: 24
        vol_scale_enabled: true
        vol_scale_target: 99.0
        vol_scale_lookback: 168
        vol_scale_floor: 0.7
        vol_scale_cap: 0.7
        volume_confirm_enabled: true
        volume_confirm_period: 20
        volume_confirm_ratio: 1.5

    ETHUSDT:
      name: "tsmom_multi_ema"
      params:
        lookbacks: [72, 168, 336, 720]
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3

    # All other symbols use the default tsmom_ema strategy
    # (defined in top-level strategy.name + strategy.params)

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.40

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.0722
    ETHUSDT: 0.0538
    SOLUSDT: 0.0509
    BNBUSDT: 0.0707
    XRPUSDT: 0.0491
    DOGEUSDT: 0.0512
    ADAUSDT: 0.0511
    AVAXUSDT: 0.0545
    LINKUSDT: 0.0538
    DOTUSDT: 0.0540
    LTCUSDT: 0.0605
    NEARUSDT: 0.0495
    APTUSDT: 0.0483
    ARBUSDT: 0.0495
    OPUSDT: 0.0426
    FILUSDT: 0.0489
    ATOMUSDT: 0.0523
    UNIUSDT: 0.0394
    AAVEUSDT: 0.0477

live:
  kline_cache: true
  flip_confirmation: false
  prefer_limit_order: true
  limit_order_timeout_s: 10

  # ‚îÄ‚îÄ Symbol Governance: Negative Edge Filter + Kill-List/Quarantine ‚îÄ‚îÄ
  # Weekly review ‚Üí de-weight or quarantine symbols with persistent negative edge.
  # When disabled (enabled: false), all weights remain unchanged (backward compatible).
  symbol_governance:
    enabled: false            # SAFETY: start disabled; enable after Phase 2
    review_frequency: "weekly"
    warmup_days: 14
    quarantine_min_days: 14
    consecutive_reviews_for_quarantine: 2
    consecutive_reviews_for_recovery: 2
    artifacts_dir: "reports/symbol_governance"

    thresholds:
      edge_sharpe_deweight: 0.3
      edge_sharpe_quarantine: 0.0
      edge_sharpe_recover_active: 0.8
      edge_sharpe_recover_from_quarantine: 0.5
      edge_per_turnover_min: 0.0
      slippage_ratio_deweight: 1.5
      slippage_ratio_quarantine: 1.8
      slippage_ratio_recover_active: 1.2
      slippage_ratio_recover_from_quarantine: 1.3
      consistency_min: 99.0
      consistency_recover: 99.5
      missed_signals_quarantine: 5.0
      dd_quarantine_pct: 25.0

    weights:
      active_multiplier: 1.0
      deweight_multiplier: 0.5
      quarantine_multiplier: 0.0
      min_weight: 0.03
      max_weight: 0.20

  watchdog:
    enabled: true
    interval_sec: 300
    alert_cooldown_sec: 1800
    startup_grace_sec: 300
    runner_ready_grace_sec: 180
    heartbeat_warn_sec: 90
    heartbeat_critical_sec: 180
    ws_msg_warn_sec: 180
    ws_msg_critical_sec: 300
    data_warn_age_sec:
      "1h": 7200
      "5m": 1800
    data_critical_age_sec:
      "1h": 14400
      "5m": 3600
    error_window_minutes: 15
    error_warn_count: 5
    error_critical_count: 12

notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "üöÄ [PROD-R3C-UNIV]"
  enabled: true

output:
  report_dir: "./reports"
