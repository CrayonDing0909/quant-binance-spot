# Layer 2 å¯¦é©— B1: ä¸‰ç­–ç•¥ Blend â€” Breakout 40 / TSMOM 40 / NW 20
#
# ç­–ç•¥åˆ†é…ï¼ˆsymbol routing â€” æ¡†æ¶é™åˆ¶æ¯ symbol ä¸€ç­–ç•¥ï¼‰ï¼š
#   BTC â†’ breakout_vol_atr (40%) â€” Breakout Î± sleeve
#   ETH â†’ tsmom_multi_ema  (40%) â€” TSMOM Î± sleeve  
#   SOL â†’ nw_envelope_regime (20%) â€” NW é˜²å®ˆ sleeve
#
# è¨­è¨ˆç†å¿µï¼š
#   - BTC å„ªå…ˆçµ¦ Breakoutï¼ˆLayer 1 å·²é©—è­‰ BTC breakout OOS SR=0.83ï¼‰
#   - ETH ç¶­æŒ TSMOM ä¸»å°ï¼ˆproven alphaï¼‰
#   - NW ä½œç‚ºé˜²å®ˆ sleeveï¼šSOL NW æ­·å² SR=0.79, MDD=4.9%ï¼ˆæ¥µä½é¢¨éšªï¼‰
#   - NW æ¬Šé‡ 20% ç¢ºä¿ä¸ä¸»å°çµ„åˆ

market:
  symbols: ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "tsmom_ema"
  params:
    lookback: 168
    vol_target: 0.15
    ema_fast: 20
    ema_slow: 50
    agree_weight: 1.0
    disagree_weight: 0.3
  symbol_overrides: {}

ensemble:
  enabled: true
  weight_mode: "fixed"
  fixed_weights:
    BTCUSDT: 0.40
    ETHUSDT: 0.40
    SOLUSDT: 0.20
  vol_parity:
    lookback: 720
    min_weight: 0.15
    max_weight: 0.50

  strategies:
    BTCUSDT:
      name: "breakout_vol_atr"
      params:
        channel_period: 336
        channel_multiplier: 2.5
        atr_period: 14
        vol_fast_period: 14
        vol_slow_period: 72
        expansion_ratio: 1.1
        fake_breakout_bars: 6
        min_hold_bars: 24
        trail_exit_mid: true
        stop_loss_atr: 3.5
        cooldown_bars: 24

    ETHUSDT:
      name: "tsmom_multi_ema"
      params:
        lookbacks: [72, 168, 336, 720]
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3

    SOLUSDT:
      name: "nw_envelope_regime"
      params:
        # â”€â”€ Ablation / MTF â”€â”€
        use_mtf: true
        mtf_alignment_mode: "right_ffill"
        module_a_enabled: true
        module_b_enabled: false
        entry_mode: "pullback_nw"
        # â”€â”€ Entry Quality Filters â”€â”€
        use_ltf_proxy: true
        ltf_ema_fast: 20
        ltf_ema_slow: 50
        use_momentum_confirm: true
        momentum_lookback: 3
        min_pullback_depth: 0.3
        reentry_lockout: true
        # â”€â”€ NW Kernel (1h) â”€â”€
        kernel_bandwidth: 8.0
        kernel_alpha: 1.0
        kernel_lookback: 200
        envelope_multiplier: 2.0
        envelope_window: 200
        # â”€â”€ Regime Filter â”€â”€
        regime_mode: "adx"
        adx_period: 14
        adx_threshold: 20.0
        slope_window: 10
        slope_threshold: 0.001
        # â”€â”€ 4h MTF â”€â”€
        htf_bandwidth: 8.0
        htf_lookback: 50
        htf_adx_period: 14
        htf_adx_threshold: 20.0
        htf_slope_window: 5
        htf_slope_threshold: 0.002
        # â”€â”€ Position Scaling â”€â”€
        trend_scale: 1.0
        range_scale: 0.5
        mr_exit_target: "nw"
        # â”€â”€ Risk / Exit â”€â”€
        atr_period: 14
        stop_loss_atr: 3.0
        take_profit_atr: 4.0
        cooldown_bars: 8
        max_holding_bars: 0
        min_hold_bars: 4

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.30

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.40
    ETHUSDT: 0.40
    SOLUSDT: 0.20

live:
  kline_cache: true
  flip_confirmation: false
  prefer_limit_order: true
  limit_order_timeout_s: 10

notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸ”¬ [L2-B1]"
  enabled: true

output:
  report_dir: "./reports"
