# åˆç´„ç­–ç•¥é…ç½®ï¼šAlt Ensembleï¼ˆNW + TSMOM å¤šç­–ç•¥çµ„åˆï¼‰
#
# çµ„åˆé‚è¼¯ï¼ˆAlt Ensemble â€” åŸºæ–¼å¯¦è­‰æœ€ä½³ per-symbol assignmentï¼‰ï¼š
#   - BTCUSDT â†’ nw_envelope_regimeï¼ˆTSMOM å…¨è™§ï¼ŒNW æŒå¹³ä½† MDD åƒ… 12%ï¼‰
#   - ETHUSDT â†’ tsmom_multi_emaï¼ˆSR 0.46, +22%, å”¯ä¸€æ­£ alpha çš„ TSMOM è®Šé«”ï¼‰
#   - SOLUSDT â†’ tsmom_emaï¼ˆSR 1.14, +91%, MDD 14%, é å„ªæ–¼ NW çš„ +50%ï¼‰
#
# è¨­è¨ˆç†å¿µï¼š
#   æ¯å€‹ symbol ä½¿ç”¨å…¶å¯¦è­‰æœ€å„ªç­–ç•¥è®Šé«”
#   NW V3 åœ¨ BTC ä½œç‚ºä½æ³¢é˜²å®ˆ sleeveï¼ˆMDD 12% vs TSMOM 25%ï¼‰
#   TSMOM åœ¨ ETH/SOL æ•æ‰å‹•é‡ alpha
#
# æ”¯æ´å…©ç¨®æ¬Šé‡æ¨¡å¼ï¼š
#   weight_mode: "fixed"      â†’ å›ºå®šæ¬Šé‡ (BTC 0.35 / ETH 0.35 / SOL 0.30)
#   weight_mode: "vol_parity" â†’ æ³¢å‹•ç‡åæ¯”åˆ†é…ï¼Œå«ä¸Šä¸‹é™ (20%~50%)
#
# ä½¿ç”¨æ–¹å¼ï¼š
#   # å›ºå®šæ¬Šé‡çµ„åˆå›æ¸¬
#   python scripts/run_portfolio_backtest.py -c config/futures_ensemble_nw_tsmom.yaml
#
#   # æ³¢å‹•ç‡å¹³åƒ¹æ¬Šé‡
#   python scripts/run_portfolio_backtest.py -c config/futures_ensemble_nw_tsmom.yaml --weight-mode vol_parity
#
#   # å–®å¹£å›æ¸¬ï¼ˆè‡ªå‹•ä½¿ç”¨è©²å¹£å°æ‡‰çš„ç­–ç•¥ï¼‰
#   python scripts/run_backtest.py -c config/futures_ensemble_nw_tsmom.yaml --symbol BTCUSDT
#   python scripts/run_backtest.py -c config/futures_ensemble_nw_tsmom.yaml --symbol SOLUSDT
#
#   # Walk-Forward é©—è­‰
#   python scripts/run_walk_forward.py -c config/futures_ensemble_nw_tsmom.yaml --splits 5
#
#   # æˆæœ¬æ•æ„Ÿåº¦
#   python scripts/run_portfolio_backtest.py -c config/futures_ensemble_nw_tsmom.yaml --cost-mult 0.5
#   python scripts/run_portfolio_backtest.py -c config/futures_ensemble_nw_tsmom.yaml --cost-mult 1.5

market:
  symbols: ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 5
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# é è¨­ç­–ç•¥ï¼ˆä¸åœ¨ ensemble.strategies ä¸­çš„ symbol ä½¿ç”¨æ­¤ç­–ç•¥ï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
strategy:
  name: "tsmom_multi_ema"
  params:
    lookbacks: [72, 168, 336, 720]
    vol_target: 0.15
    ema_fast: 20
    ema_slow: 50
    agree_weight: 1.0
    disagree_weight: 0.3
    vol_regime_enabled: false

  symbol_overrides: {}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ensemble: æ¯å€‹ symbol å¯ä»¥æœ‰ç¨ç«‹çš„ strategy + params
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ensemble:
  enabled: true

  # æ¬Šé‡æ¨¡å¼: "fixed" æˆ– "vol_parity"
  weight_mode: "fixed"

  # å›ºå®šæ¬Šé‡
  fixed_weights:
    BTCUSDT: 0.35
    ETHUSDT: 0.35
    SOLUSDT: 0.30

  # æ³¢å‹•ç‡å¹³åƒ¹åƒæ•¸
  vol_parity:
    lookback: 720       # 30å¤© rolling vol
    min_weight: 0.20    # æœ€ä½é…ç½®
    max_weight: 0.50    # æœ€é«˜é…ç½®

  # per-symbol ç­–ç•¥è·¯ç”±
  # é¸æ“‡ç†ç”±ï¼ˆåŸºæ–¼ 2022-01 â†’ 2026-02 å›æ¸¬ + æˆæœ¬å¾Œï¼‰ï¼š
  #   BTC: nw_envelope_regimeï¼ˆTSMOM å…¨è™§ï¼ŒNW æŒå¹³ä½† MDD åƒ… 12%ï¼‰
  #   ETH: tsmom_multi_emaï¼ˆSR 0.46, +22%, å”¯ä¸€æ­£ alpha çš„ TSMOM è®Šé«”ï¼‰
  #   SOL: tsmom_emaï¼ˆSR 1.14, +91%, MDD 14%, é å„ªæ–¼ NW çš„ +50%ï¼‰
  #
  # åŸå§‹ assignment (TSMOMâ†’BTC/ETH, NWâ†’SOL): SR 0.49, MDD 12%
  # å„ªåŒ– assignment (NWâ†’BTC, TSMOMâ†’ETH/SOL):  SR 0.91, MDD 8% â† æ¡ç”¨
  strategies:
    BTCUSDT:
      name: "nw_envelope_regime"
      params:
        # â”€â”€ Ablation / MTF â”€â”€
        use_mtf: true
        mtf_alignment_mode: "right_ffill"
        module_a_enabled: true
        module_b_enabled: false
        entry_mode: "pullback_nw"

        # â”€â”€ Phase B Entry Quality Filters â”€â”€
        use_ltf_proxy: true
        ltf_ema_fast: 20
        ltf_ema_slow: 50
        use_momentum_confirm: true
        momentum_lookback: 3
        min_pullback_depth: 0.3
        reentry_lockout: true

        # â”€â”€ NW Kernel (1h) â”€â”€
        kernel_bandwidth: 8.0
        kernel_alpha: 1.0
        kernel_lookback: 200
        envelope_multiplier: 2.0
        envelope_window: 200

        # â”€â”€ Regime Filter â”€â”€
        regime_mode: "adx"
        adx_period: 14
        adx_threshold: 20.0
        slope_window: 10
        slope_threshold: 0.001

        # â”€â”€ 4h MTF â”€â”€
        htf_bandwidth: 8.0
        htf_lookback: 50
        htf_adx_period: 14
        htf_adx_threshold: 20.0
        htf_slope_window: 5
        htf_slope_threshold: 0.002

        # â”€â”€ Position Scaling â”€â”€
        trend_scale: 1.0
        range_scale: 0.5
        mr_exit_target: "nw"

        # â”€â”€ Risk / Exit â”€â”€
        atr_period: 14
        stop_loss_atr: 3.0
        take_profit_atr: 4.0
        trailing_stop_atr: null
        cooldown_bars: 8
        max_holding_bars: 0
        min_hold_bars: 4

    ETHUSDT:
      name: "tsmom_multi_ema"
      params:
        lookbacks: [72, 168, 336, 720]
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3
        vol_regime_enabled: false

    SOLUSDT:
      name: "tsmom_ema"
      params:
        lookback: 168
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3
        vol_regime_enabled: false

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true

  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true

  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.30

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.35
    ETHUSDT: 0.35
    SOLUSDT: 0.30

live:
  kline_cache: true
  flip_confirmation: false
  prefer_limit_order: true
  limit_order_timeout_s: 10

notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸŸ£ [ENSEMBLE]"
  enabled: true

output:
  report_dir: "./reports"
