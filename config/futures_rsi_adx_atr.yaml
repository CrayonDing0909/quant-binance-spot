# åˆç´„ç­–ç•¥é…ç½®ç¯„ä¾‹ï¼šRSI + ADX + ATR
# 
# èˆ‡ç¾è²¨ç‰ˆæœ¬ (rsi_adx_atr.yaml) ä½¿ç”¨ç›¸åŒç­–ç•¥ï¼Œä½†æ”¯æ´åšç©º
# 
# ä½¿ç”¨æ–¹å¼ï¼š
#   python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml
#   python scripts/run_backtest.py -c config/futures_rsi_adx_atr.yaml
#   python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --paper

market:
  symbols: ["BTCUSDT", "ETHUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"  # ä½¿ç”¨åˆç´„ API

# åˆç´„å°ˆå±¬é…ç½®
futures:
  leverage: 5             # æ§“æ¡¿å€æ•¸ï¼ˆå»ºè­° 1-5 å€ï¼‰
  margin_type: "ISOLATED" # ISOLATEDï¼ˆé€å€‰ï¼‰æˆ– CROSSEDï¼ˆå…¨å€‰ï¼‰
  position_mode: "ONE_WAY" # ONE_WAYï¼ˆå–®å‘ï¼‰æˆ– HEDGEï¼ˆé›™å‘ï¼‰
  direction: "both"       # äº¤æ˜“æ–¹å‘: "both"=å¤šç©ºéƒ½åš, "long_only"=åªåšå¤š, "short_only"=åªåšç©º

strategy:
  name: "rsi_adx_atr"
  params:
    # RSI åƒæ•¸
    rsi_period: 10
    oversold: 30           # RSI < 30 â†’ åšå¤š
    overbought: 80         # RSI > 80 â†’ åšç©ºï¼ˆæƒææœ€ä½³ï¼šSharpe 2.42â†’3.59ï¼‰
    
    # ADX éæ¿¾å™¨
    min_adx: 15
    adx_period: 14
    
    # ATR æ­¢ææ­¢ç›ˆ
    stop_loss_atr: 1.5     # æ­¢æ = 1.5 ATR
    take_profit_atr: null   # null = ä¸è¨­å›ºå®šæ­¢ç›ˆï¼Œé  RSI ä¿¡è™Ÿå‡ºå ´ï¼ˆå›æ¸¬æœ€å„ªï¼‰
    atr_period: 14
    
    # å†·å»æœŸ
    cooldown_bars: 1

  # å¹£ç¨®å°ˆå±¬åƒæ•¸è¦†å¯«
  symbol_overrides:
    BTCUSDT:
      oversold: 30
      overbought: 80       # æƒææœ€ä½³ï¼šS_PF 1.23â†’1.35, Sharpe 2.42â†’3.59
    ETHUSDT:
      oversold: 35
      overbought: 78       # æƒææœ€ä½³ï¼šS_PF 1.74â†’2.03, Sharpe 3.33â†’4.03

backtest:
  initial_cash: 10000
  fee_bps: 4              # åˆç´„æ‰‹çºŒè²»è¼ƒä½ï¼ˆMaker 0.02%, Taker 0.04%ï¼‰
  slippage_bps: 3         # å›ºå®šæ»‘é»ï¼ˆslippage_model.enabled=true æ™‚è¢«è¦†è“‹ï¼‰
  trade_on: "next_open"
  validate_data: true
  clean_data: true

  # ğŸ”´ Funding Rate æˆæœ¬æ¨¡å‹ï¼ˆæ°¸çºŒåˆç´„æŒå€‰æˆæœ¬ï¼‰
  # æ¯ 8 å°æ™‚çµç®—ï¼Œå¤šé ­åœ¨ rate>0 æ™‚ä»˜è²»ï¼Œç©ºé ­æ”¶è²»
  # é–‹å•Ÿå¾Œå›æ¸¬æœƒé¡¯ç¤ºã€Œèª¿æ•´å¾Œç¸¾æ•ˆã€ï¼Œæ›´è²¼è¿‘çœŸå¯¦æ”¶ç›Š
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001   # 0.01% per 8hï¼ˆç„¡æ­·å²è³‡æ–™æ™‚çš„é è¨­å€¼ï¼‰
    use_historical: true      # å˜—è©¦è¼‰å…¥æ­·å² funding rateï¼ˆéœ€å…ˆ download_data.py --funding-rateï¼‰

  # ğŸ”´ Volume-based æ»‘é»æ¨¡å‹ï¼ˆSquare-Root Market Impactï¼‰
  # slippage = base_spread + k Ã— (trade_value / ADV)^0.5
  # é–‹å•Ÿå¾Œå–ä»£å›ºå®š slippage_bpsï¼Œå¤§è³‡é‡‘æ™‚æ»‘é»æœƒé¡¯è‘—å¢åŠ 
  slippage_model:
    enabled: true
    base_bps: 2               # æœ€ä½è²·è³£åƒ¹å·® (bps)
    impact_coefficient: 0.1   # è¡æ“Šä¿‚æ•¸ kï¼ˆ0.05~0.20ï¼Œè¶Šå¤§=æµå‹•æ€§è¶Šå·®ï¼‰
    impact_power: 0.5         # è¡æ“ŠæŒ‡æ•¸ï¼ˆ0.5 = å¹³æ–¹æ ¹æ¨¡å‹ï¼Œå­¸è¡“æ¨™æº–ï¼‰
    adv_lookback: 20          # è¨ˆç®—å¹³å‡æˆäº¤é‡çš„å›çœ‹ bar æ•¸
    participation_rate: 0.10  # å¸‚å ´ä½”æ¯”ä¸Šé™ï¼ˆ10%ï¼‰

# é¢¨æ§ï¼ˆåˆç´„å»ºè­°æ›´ä¿å®ˆï¼‰
risk:
  max_drawdown_pct: 0.65  # 65% ç†”æ–·ï¼ˆ5x æ§“æ¡¿ä¸‹ 1x MDDâ‰ˆ14% â†’ 5xâ‰ˆ57%ï¼Œç•™ç·©è¡ï¼‰

# å€‰ä½è¨ˆç®—
position_sizing:
  method: "fixed"
  position_pct: 1.0
  kelly_fraction: 0.25

# å¤šå¹£ç¨®å€‰ä½åˆ†é…
portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 1.00         # 100% æ¬Šç›Š
    ETHUSDT: 1.00         # 100% æ¬Šç›Š
    # ç¸½æ›éšª 200%ï¼ˆ2xï¼‰ï¼Œ5x æ§“æ¡¿ä¸‹ä¿è­‰é‡‘ç”¨ 40%ï¼ŒMDD é ä¼° ~27%

# å¯¦ç›¤å°ˆå±¬é…ç½®
live:
  kline_cache: true           # å¢é‡ K ç·šå¿«å–ï¼ˆç­–ç•¥å¾ bar 0 è·‘åˆ°æœ€æ–°ï¼Œèˆ‡å›æ¸¬ä¸€è‡´ï¼‰
  flip_confirmation: false    # æ–¹å‘åˆ‡æ› 2-tick ç¢ºèªï¼ˆå¿«å–æ¨¡å¼ä¸‹ä¸éœ€è¦ï¼‰

# Telegram é€šçŸ¥ï¼ˆä½¿ç”¨ç¨ç«‹çš„ Botï¼‰
notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸ”´ [FUTURES]"
  enabled: true

output:
  report_dir: "./reports"
