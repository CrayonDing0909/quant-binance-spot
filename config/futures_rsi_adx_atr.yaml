# åˆç´„ç­–ç•¥é…ç½®ç¯„ä¾‹ï¼šRSI + ADX + ATR
# 
# èˆ‡ç¾è²¨ç‰ˆæœ¬ (rsi_adx_atr.yaml) ä½¿ç”¨ç›¸åŒç­–ç•¥ï¼Œä½†æ”¯æ´åšç©º
# 
# ä½¿ç”¨æ–¹å¼ï¼š
#   python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml
#   python scripts/run_backtest.py -c config/futures_rsi_adx_atr.yaml
#   python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --paper

market:
  symbols: ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"  # ä½¿ç”¨åˆç´„ API

# åˆç´„å°ˆå±¬é…ç½®
futures:
  leverage: 5             # æ§“æ¡¿å€æ•¸ï¼ˆå»ºè­° 1-5 å€ï¼‰
  margin_type: "ISOLATED" # ISOLATEDï¼ˆé€å€‰ï¼‰æˆ– CROSSEDï¼ˆå…¨å€‰ï¼‰
  position_mode: "ONE_WAY" # ONE_WAYï¼ˆå–®å‘ï¼‰æˆ– HEDGEï¼ˆé›™å‘ï¼‰
  direction: "both"       # äº¤æ˜“æ–¹å‘: "both"=å¤šç©ºéƒ½åš, "long_only"=åªåšå¤š, "short_only"=åªåšç©º

strategy:
  name: "rsi_adx_atr"
  params:
    # ğŸŒŸ RSI æ¨¡å¼ï¼šdynamic (è§£æ±º Alpha Decay)
    rsi_mode: "dynamic"   # "static" or "dynamic"
    rsi_period: 10
    
    # Dynamic RSI åƒæ•¸ (Rolling Percentile)
    rsi_lookback_days: 14  # æ»¾å‹•çª—å£å¤©æ•¸
    rsi_quantile_low: 0.10 # è²·å…¥é–¾å€¼ (10th percentile)
    rsi_quantile_high: 0.90 # è³£å‡ºé–¾å€¼ (90th percentile)
    
    # éœæ…‹åƒæ•¸å‚™ä»½ (å¦‚æœ mode=static)
    oversold: 30
    overbought: 80
    
    # ADX éæ¿¾å™¨
    min_adx: 15
    adx_period: 14
    
    # ğŸ’° Funding Rate éæ¿¾å™¨ (æ–°åŠŸèƒ½)
    # éæ¿¾æ“æ“ äº¤æ˜“ï¼šç•¶ funding rate æ¥µé«˜æ™‚ä¸åšå¤šï¼Œæ¥µä½æ™‚ä¸åšç©º
    use_funding_filter: true
    fr_max_pos: 0.0002     # 0.02% (Longs paying Shorts)
    fr_max_neg: -0.0002    # -0.02% (Shorts paying Longs)
    
    # ğŸ›¡ï¸ é¢¨æ§å„ªåŒ– (åŸºæ–¼ç†±åŠ›åœ–æƒæçµæœ)
    # æœ€ä½³å¹³è¡¡é»ï¼šSL 2.0 / CD 3
    # æ—¢èƒ½æ•æ‰åˆ©æ½¤ (æ¯” 2.5/5 æ›´å¥½)ï¼Œåˆä¸åƒ 1.5/1 é‚£æ¨£éæ–¼æ¿€é€²
    stop_loss_atr: 2.0     # åŸºæº– SL å€æ•¸ï¼ˆadaptive_sl å•Ÿç”¨æ™‚ä½œç‚º fallbackï¼‰
    take_profit_atr: null   # null = ä¸è¨­å›ºå®šæ­¢ç›ˆï¼Œé  RSI ä¿¡è™Ÿå‡ºå ´
    atr_period: 14
    
    # ğŸ†• è‡ªé©æ‡‰æ­¢æï¼ˆAdaptive SLï¼‰
    # æ ¹æ“š Efficiency Ratio å‹•æ…‹èª¿æ•´ SL å¯¬åº¦ï¼š
    #   éœ‡ç›ªå¸‚ï¼ˆER ä½ï¼‰â†’ æ”¾å¯¬ SLï¼ˆæ‰›éå™ªè²ï¼‰
    #   è¶¨å‹¢å¸‚ï¼ˆER é«˜ï¼‰â†’ æ”¶ç·Š SLï¼ˆä¿è­·åˆ©æ½¤ï¼‰
    # å›æ¸¬çµæœï¼ˆ2025-2026ï¼‰ï¼šMDD 12.1%â†’10.7%ï¼ˆBTCï¼‰ï¼Œ13.8%â†’10.4%ï¼ˆETHï¼‰
    adaptive_sl: true
    adaptive_sl_er_period: 10   # ER è¨ˆç®—é€±æœŸ
    er_sl_min: 1.5              # ER=1ï¼ˆè¶¨å‹¢ï¼‰â†’ SL = 1.5x ATRï¼ˆæœ€çª„ï¼‰
    er_sl_max: 2.5              # ER=0ï¼ˆéœ‡ç›ªï¼‰â†’ SL = 2.5x ATRï¼ˆæœ€å¯¬ï¼‰
    
    # å†·å»æœŸ
    cooldown_bars: 3       # åŸ 5 â†’ 3 (æ­¢æå¾Œç­‰å¾… 3 å°æ™‚)
    
    # ğŸ†• æ³¢å‹•ç‡éæ¿¾å™¨ï¼ˆéæ¿¾ä½æ³¢å‹•ç£¨è€—ï¼‰
    # ATR/Price < 0.005 æ™‚ä¸é–‹å€‰ â†’ é¿å…éœ‡ç›ªå¸‚é »ç¹äº¤æ˜“
    min_atr_ratio: 0.005
    vol_filter_mode: "absolute"    # "absolute" or "percentile"
    
    # ğŸ†• å¤šæ™‚é–“æ¡†æ¶è¶¨å‹¢éæ¿¾ï¼ˆè»Ÿæ¨¡å¼ï¼‰
    # 4h EMA20/50 åˆ¤æ–·å¤§è¶¨å‹¢ï¼Œç”¨é€£çºŒæ¬Šé‡è€ŒéäºŒå…ƒé–˜é–€
    # soft æ¨¡å¼ï¼šé †è¶¨å‹¢å…¨å€‰ã€é€†è¶¨å‹¢åŠå€‰ã€ç„¡è¶¨å‹¢ 75%
    htf_interval: "4h"
    htf_mode: "soft"               # "soft"ï¼ˆæ¨è–¦ï¼‰æˆ– "hard"ï¼ˆæ¿€é€²ï¼‰
    htf_ema_fast: 20
    htf_ema_slow: 50
    htf_align_weight: 1.0          # é †è¶¨å‹¢æ¬Šé‡
    htf_counter_weight: 0.5        # é€†è¶¨å‹¢æ¬Šé‡
    htf_neutral_weight: 0.75       # ç„¡è¶¨å‹¢æ¬Šé‡

  # ç§»é™¤èˆŠçš„éœæ…‹é–¾å€¼è¦†å¯«ï¼Œä½¿ç”¨çµ±ä¸€çš„å‹•æ…‹é‚è¼¯
  symbol_overrides: {}

backtest:
  initial_cash: 10000
  fee_bps: 4              # åˆç´„æ‰‹çºŒè²»è¼ƒä½ï¼ˆMaker 0.02%, Taker 0.04%ï¼‰
  slippage_bps: 3         # å›ºå®šæ»‘é»ï¼ˆslippage_model.enabled=true æ™‚è¢«è¦†è“‹ï¼‰
  trade_on: "next_open"
  validate_data: true
  clean_data: true

  # ğŸ”´ Funding Rate æˆæœ¬æ¨¡å‹ï¼ˆæ°¸çºŒåˆç´„æŒå€‰æˆæœ¬ï¼‰
  # æ¯ 8 å°æ™‚çµç®—ï¼Œå¤šé ­åœ¨ rate>0 æ™‚ä»˜è²»ï¼Œç©ºé ­æ”¶è²»
  # é–‹å•Ÿå¾Œå›æ¸¬æœƒé¡¯ç¤ºã€Œèª¿æ•´å¾Œç¸¾æ•ˆã€ï¼Œæ›´è²¼è¿‘çœŸå¯¦æ”¶ç›Š
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001   # 0.01% per 8hï¼ˆç„¡æ­·å²è³‡æ–™æ™‚çš„é è¨­å€¼ï¼‰
    use_historical: true      # å˜—è©¦è¼‰å…¥æ­·å² funding rateï¼ˆéœ€å…ˆ download_data.py --funding-rateï¼‰

  # ğŸ”´ Volume-based æ»‘é»æ¨¡å‹ï¼ˆSquare-Root Market Impactï¼‰
  # slippage = base_spread + k Ã— (trade_value / ADV)^0.5
  # é–‹å•Ÿå¾Œå–ä»£å›ºå®š slippage_bpsï¼Œå¤§è³‡é‡‘æ™‚æ»‘é»æœƒé¡¯è‘—å¢åŠ 
  slippage_model:
    enabled: true
    base_bps: 2               # æœ€ä½è²·è³£åƒ¹å·® (bps)
    impact_coefficient: 0.1   # è¡æ“Šä¿‚æ•¸ kï¼ˆ0.05~0.20ï¼Œè¶Šå¤§=æµå‹•æ€§è¶Šå·®ï¼‰
    impact_power: 0.5         # è¡æ“ŠæŒ‡æ•¸ï¼ˆ0.5 = å¹³æ–¹æ ¹æ¨¡å‹ï¼Œå­¸è¡“æ¨™æº–ï¼‰
    adv_lookback: 20          # è¨ˆç®—å¹³å‡æˆäº¤é‡çš„å›çœ‹ bar æ•¸
    participation_rate: 0.10  # å¸‚å ´ä½”æ¯”ä¸Šé™ï¼ˆ10%ï¼‰

# é¢¨æ§ï¼ˆåˆç´„å»ºè­°æ›´ä¿å®ˆï¼‰
risk:
  max_drawdown_pct: 0.65  # 65% ç†”æ–·ï¼ˆ5x æ§“æ¡¿ä¸‹ 1x MDDâ‰ˆ14% â†’ 5xâ‰ˆ57%ï¼Œç•™ç·©è¡ï¼‰

# ğŸ†• å€‰ä½è¨ˆç®— â€” æ³¢å‹•ç‡ç›®æ¨™å®šä½ï¼ˆVolatility Targetingï¼‰
# é«˜æ³¢å‹•æœŸè‡ªå‹•é™ä½å€‰ä½ï¼Œä½æ³¢å‹•æœŸå…è¨±åŠ å€‰
# æ•ˆæœï¼šå¹³æ»‘æ¬Šç›Šæ›²ç·šã€é™ä½ MDDã€æå‡ risk-adjusted return
position_sizing:
  method: "volatility"         # "fixed" or "volatility"
  position_pct: 1.0            # method=fixed æ™‚ä½¿ç”¨
  kelly_fraction: 0.25         # Kelly ä¿å®ˆå› å­ï¼ˆä¿ç•™å‚™ç”¨ï¼‰
  target_volatility: 1.00      # ç›®æ¨™å¹´åŒ–æ³¢å‹•ç‡ 100%
  vol_lookback: 168            # å›çœ‹ 168 bars = 7 å¤©ï¼ˆ1h æ•¸æ“šï¼‰

# å¤šå¹£ç¨®å€‰ä½åˆ†é…ï¼ˆå„ªåŒ–æ¬Šé‡ï¼ŒåŸºæ–¼ 2022-2026 Grid Searchï¼‰
# åŸå§‹ç­‰æ¬Š 1.0/1.0/1.0ï¼ˆç¸½ 3xï¼‰â†’ Sharpe 1.96, MDD -38.6%
# å„ªåŒ–æ¯”ä¾‹ 15:50:35ï¼Œç¶­æŒç¸½æ›éšª ~2x â†’ Sharpe 1.98, MDD ~39%
portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.50         # 15% æ¯”ä¾‹ Ã— 2x = 0.30ï¼ˆBTC æœ€å¼±ï¼Œé™ä½æ›éšªï¼‰
    ETHUSDT: 1.00         # 50% æ¯”ä¾‹ Ã— 2x = 1.00ï¼ˆETH æœ€ç©©å®šï¼Œä¸»åŠ›ï¼‰
    SOLUSDT: 1.00         # 35% æ¯”ä¾‹ Ã— 2x = 0.70ï¼ˆSOL é«˜æ”¶ç›Šï¼Œæ¬¡ä¸»åŠ›ï¼‰
    # ç¸½æ›éšª 200%ï¼ˆ2xï¼‰ï¼Œæ¯”åŸ 3x æ›´ä¿å®ˆï¼Œ5x æ§“æ¡¿ä¸‹ä¿è­‰é‡‘ç”¨ 40%
    # ç›¸å°æ¯”ä¾‹ BTC:ETH:SOL = 15:50:35ï¼ˆèˆ‡å›æ¸¬å„ªåŒ–ä¸€è‡´ï¼‰

# å¯¦ç›¤å°ˆå±¬é…ç½®
live:
  kline_cache: true           # å¢é‡ K ç·šå¿«å–ï¼ˆç­–ç•¥å¾ bar 0 è·‘åˆ°æœ€æ–°ï¼Œèˆ‡å›æ¸¬ä¸€è‡´ï¼‰
  flip_confirmation: false    # æ–¹å‘åˆ‡æ› 2-tick ç¢ºèªï¼ˆå¿«å–æ¨¡å¼ä¸‹ä¸éœ€è¦ï¼‰
  prefer_limit_order: true    # ğŸ†• å„ªå…ˆç”¨é™åƒ¹å–®ï¼ˆMaker fee 0.02% vs Taker 0.04%ï¼Œçœä¸€åŠæ‰‹çºŒè²»ï¼‰
  limit_order_timeout_s: 10   # é™åƒ¹å–®ç­‰å¾…ç§’æ•¸ï¼ˆè¶…æ™‚è‡ªå‹•æ”¹å¸‚åƒ¹å–®ç¢ºä¿æˆäº¤ï¼‰

# Telegram é€šçŸ¥ï¼ˆä½¿ç”¨ç¨ç«‹çš„ Botï¼‰
notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸ”´ [FUTURES]"
  enabled: true

output:
  report_dir: "./reports"
