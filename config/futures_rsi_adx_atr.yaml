# åˆç´„ç­–ç•¥é…ç½®ç¯„ä¾‹ï¼šRSI + ADX + ATR
# 
# èˆ‡ç¾è²¨ç‰ˆæœ¬ (rsi_adx_atr.yaml) ä½¿ç”¨ç›¸åŒç­–ç•¥ï¼Œä½†æ”¯æ´åšç©º
# 
# ä½¿ç”¨æ–¹å¼ï¼š
#   python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml
#   python scripts/run_backtest.py -c config/futures_rsi_adx_atr.yaml
#   python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --paper

market:
  symbols: ["BTCUSDT", "ETHUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"  # ä½¿ç”¨åˆç´„ API

# åˆç´„å°ˆå±¬é…ç½®
futures:
  leverage: 5             # æ§“æ¡¿å€æ•¸ï¼ˆå»ºè­° 1-5 å€ï¼‰
  margin_type: "ISOLATED" # ISOLATEDï¼ˆé€å€‰ï¼‰æˆ– CROSSEDï¼ˆå…¨å€‰ï¼‰
  position_mode: "ONE_WAY" # ONE_WAYï¼ˆå–®å‘ï¼‰æˆ– HEDGEï¼ˆé›™å‘ï¼‰
  direction: "both"       # äº¤æ˜“æ–¹å‘: "both"=å¤šç©ºéƒ½åš, "long_only"=åªåšå¤š, "short_only"=åªåšç©º

strategy:
  name: "rsi_adx_atr"
  params:
    # ğŸŒŸ RSI æ¨¡å¼ï¼šdynamic (è§£æ±º Alpha Decay)
    rsi_mode: "dynamic"   # "static" or "dynamic"
    rsi_period: 10
    
    # Dynamic RSI åƒæ•¸ (Rolling Percentile)
    rsi_lookback_days: 14  # æ»¾å‹•çª—å£å¤©æ•¸
    rsi_quantile_low: 0.10 # è²·å…¥é–¾å€¼ (10th percentile)
    rsi_quantile_high: 0.90 # è³£å‡ºé–¾å€¼ (90th percentile)
    
    # éœæ…‹åƒæ•¸å‚™ä»½ (å¦‚æœ mode=static)
    oversold: 30
    overbought: 80
    
    # ADX éæ¿¾å™¨
    min_adx: 15
    adx_period: 14
    
    # ğŸ’° Funding Rate éæ¿¾å™¨ (æ–°åŠŸèƒ½)
    # éæ¿¾æ“æ“ äº¤æ˜“ï¼šç•¶ funding rate æ¥µé«˜æ™‚ä¸åšå¤šï¼Œæ¥µä½æ™‚ä¸åšç©º
    use_funding_filter: true
    fr_max_pos: 0.0002     # 0.02% (Longs paying Shorts)
    fr_max_neg: -0.0002    # -0.02% (Shorts paying Longs)
    
    # ğŸ›¡ï¸ é¢¨æ§å„ªåŒ– (åŸºæ–¼ç†±åŠ›åœ–æƒæçµæœ)
    # æœ€ä½³å¹³è¡¡é»ï¼šSL 2.0 / CD 3
    # æ—¢èƒ½æ•æ‰åˆ©æ½¤ (æ¯” 2.5/5 æ›´å¥½)ï¼Œåˆä¸åƒ 1.5/1 é‚£æ¨£éæ–¼æ¿€é€²
    stop_loss_atr: 2.0     # åŸ 2.5 â†’ 2.0
    take_profit_atr: null   # null = ä¸è¨­å›ºå®šæ­¢ç›ˆï¼Œé  RSI ä¿¡è™Ÿå‡ºå ´
    atr_period: 14
    
    # å†·å»æœŸ
    cooldown_bars: 3       # åŸ 5 â†’ 3 (æ­¢æå¾Œç­‰å¾… 3 å°æ™‚)

  # ç§»é™¤èˆŠçš„éœæ…‹é–¾å€¼è¦†å¯«ï¼Œä½¿ç”¨çµ±ä¸€çš„å‹•æ…‹é‚è¼¯
  symbol_overrides: {}

backtest:
  initial_cash: 10000
  fee_bps: 4              # åˆç´„æ‰‹çºŒè²»è¼ƒä½ï¼ˆMaker 0.02%, Taker 0.04%ï¼‰
  slippage_bps: 3         # å›ºå®šæ»‘é»ï¼ˆslippage_model.enabled=true æ™‚è¢«è¦†è“‹ï¼‰
  trade_on: "next_open"
  validate_data: true
  clean_data: true

  # ğŸ”´ Funding Rate æˆæœ¬æ¨¡å‹ï¼ˆæ°¸çºŒåˆç´„æŒå€‰æˆæœ¬ï¼‰
  # æ¯ 8 å°æ™‚çµç®—ï¼Œå¤šé ­åœ¨ rate>0 æ™‚ä»˜è²»ï¼Œç©ºé ­æ”¶è²»
  # é–‹å•Ÿå¾Œå›æ¸¬æœƒé¡¯ç¤ºã€Œèª¿æ•´å¾Œç¸¾æ•ˆã€ï¼Œæ›´è²¼è¿‘çœŸå¯¦æ”¶ç›Š
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001   # 0.01% per 8hï¼ˆç„¡æ­·å²è³‡æ–™æ™‚çš„é è¨­å€¼ï¼‰
    use_historical: true      # å˜—è©¦è¼‰å…¥æ­·å² funding rateï¼ˆéœ€å…ˆ download_data.py --funding-rateï¼‰

  # ğŸ”´ Volume-based æ»‘é»æ¨¡å‹ï¼ˆSquare-Root Market Impactï¼‰
  # slippage = base_spread + k Ã— (trade_value / ADV)^0.5
  # é–‹å•Ÿå¾Œå–ä»£å›ºå®š slippage_bpsï¼Œå¤§è³‡é‡‘æ™‚æ»‘é»æœƒé¡¯è‘—å¢åŠ 
  slippage_model:
    enabled: true
    base_bps: 2               # æœ€ä½è²·è³£åƒ¹å·® (bps)
    impact_coefficient: 0.1   # è¡æ“Šä¿‚æ•¸ kï¼ˆ0.05~0.20ï¼Œè¶Šå¤§=æµå‹•æ€§è¶Šå·®ï¼‰
    impact_power: 0.5         # è¡æ“ŠæŒ‡æ•¸ï¼ˆ0.5 = å¹³æ–¹æ ¹æ¨¡å‹ï¼Œå­¸è¡“æ¨™æº–ï¼‰
    adv_lookback: 20          # è¨ˆç®—å¹³å‡æˆäº¤é‡çš„å›çœ‹ bar æ•¸
    participation_rate: 0.10  # å¸‚å ´ä½”æ¯”ä¸Šé™ï¼ˆ10%ï¼‰

# é¢¨æ§ï¼ˆåˆç´„å»ºè­°æ›´ä¿å®ˆï¼‰
risk:
  max_drawdown_pct: 0.65  # 65% ç†”æ–·ï¼ˆ5x æ§“æ¡¿ä¸‹ 1x MDDâ‰ˆ14% â†’ 5xâ‰ˆ57%ï¼Œç•™ç·©è¡ï¼‰

# å€‰ä½è¨ˆç®—
position_sizing:
  method: "fixed"
  position_pct: 1.0
  kelly_fraction: 0.25

# å¤šå¹£ç¨®å€‰ä½åˆ†é…
portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 1.00         # 100% æ¬Šç›Š
    ETHUSDT: 1.00         # 100% æ¬Šç›Š
    # ç¸½æ›éšª 200%ï¼ˆ2xï¼‰ï¼Œ5x æ§“æ¡¿ä¸‹ä¿è­‰é‡‘ç”¨ 40%ï¼ŒMDD é ä¼° ~27%

# å¯¦ç›¤å°ˆå±¬é…ç½®
live:
  kline_cache: true           # å¢é‡ K ç·šå¿«å–ï¼ˆç­–ç•¥å¾ bar 0 è·‘åˆ°æœ€æ–°ï¼Œèˆ‡å›æ¸¬ä¸€è‡´ï¼‰
  flip_confirmation: false    # æ–¹å‘åˆ‡æ› 2-tick ç¢ºèªï¼ˆå¿«å–æ¨¡å¼ä¸‹ä¸éœ€è¦ï¼‰
  prefer_limit_order: true    # ğŸ†• å„ªå…ˆç”¨é™åƒ¹å–®ï¼ˆMaker fee 0.02% vs Taker 0.04%ï¼Œçœä¸€åŠæ‰‹çºŒè²»ï¼‰
  limit_order_timeout_s: 10   # é™åƒ¹å–®ç­‰å¾…ç§’æ•¸ï¼ˆè¶…æ™‚è‡ªå‹•æ”¹å¸‚åƒ¹å–®ç¢ºä¿æˆäº¤ï¼‰

# Telegram é€šçŸ¥ï¼ˆä½¿ç”¨ç¨ç«‹çš„ Botï¼‰
notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸ”´ [FUTURES]"
  enabled: true

output:
  report_dir: "./reports"
