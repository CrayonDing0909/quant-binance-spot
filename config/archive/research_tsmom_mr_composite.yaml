# ═══════════════════════════════════════════════════════════════
# RESEARCH — TSMOM + Mean-Reversion Composite (3-Factor)
# ═══════════════════════════════════════════════════════════════
# Created: 2026-02-25
# Origin:  Quant Researcher 盤整期互補策略分析
# Purpose: TSMOM + Bollinger MR + Short-Term Reversal 三因子組合
#          互補 Meta-Blend 在盤整期的弱勢
#
# 策略邏輯:
#   1. TSMOM_EMA (70%): 動量 + EMA 趨勢對齊（捕捉趨勢）
#   2. Bollinger MR (15%): %B 超買超賣回歸（盤整期 alpha）
#   3. Short-Term Reversal (15%): 24h 反轉（盤整期 alpha）
#   4. Regime-Aware Gate: 強趨勢時 MR/Rev 不能逆向
#
# 學術依據:
#   - Moskowitz et al. (2012): TSMOM
#   - Brock et al. (1992): BB Mean-Reversion
#   - Jegadeesh (1990): Short-Term Reversals
#   - 現有 IC 分析: TSMOM IC≈0 in 2023-2025, MR IC=+0.042, Rev IC=+0.033
#   - TSMOM vs MR/Rev 相關性: -0.16 ~ -0.20（天然對沖）
#
# Symbols: 沿用 Meta-Blend 8 幣種（一致比較基準）
# ═══════════════════════════════════════════════════════════════

market:
  symbols:
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - DOGEUSDT
    - ADAUSDT
    - AVAXUSDT
    - LINKUSDT
  interval: "1h"
  start: "2020-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "tsmom_mr_composite"
  params:
    # ── Factor Weights ──
    # 預設: TSMOM 70% + MR 15% + Reversal 15%
    # TSMOM 仍為 anchor，MR/Rev 為 satellite
    w_tsmom: 0.70
    w_mr: 0.15
    w_reversal: 0.15

    # ── Regime Gate ──
    # 強趨勢時（|TSMOM signal| > 0.4）MR/Rev 不能反向
    regime_gate_enabled: true
    trend_strength_thresh: 0.4

    # ── Signal Smoothing（降低 MR/Rev 換手率）──
    mr_smooth_period: 12
    rev_smooth_period: 12

    # ── TSMOM Sub-factor ──
    tsmom_lookback: 168       # 7 天
    tsmom_vol_target: 0.15
    tsmom_ema_fast: 20
    tsmom_ema_slow: 50
    tsmom_agree_weight: 1.0
    tsmom_disagree_weight: 0.3

    # ── Bollinger MR Sub-factor ──
    mr_bb_period: 20
    mr_bb_std: 2.0
    mr_overbought: 0.8
    mr_oversold: 0.2
    mr_exit_upper: 0.65
    mr_exit_lower: 0.35

    # ── Short-Term Reversal Sub-factor ──
    rev_lookback: 24          # 24 小時
    rev_vol_target: 0.15
    rev_vol_lookback: 168

    # ── Per-symbol weight override ──
    # BTC 趨勢更長，提高 TSMOM 權重、降低 MR/Rev
    # NOTE: 只有 w_tsmom/w_mr/w_reversal 可 per-symbol override
    #       tsmom_lookback 等子因子參數暫不支援 per-symbol（全局 168h）
    #       如需 BTC 720h lookback，需修改策略程式碼
    symbol_factor_weights:
      BTCUSDT:
        w_tsmom: 0.80
        w_mr: 0.10
        w_reversal: 0.10

  # ── Overlay: vol_pause (與 Meta-Blend 一致做公平比較) ──
  overlay:
    enabled: true
    mode: "oi_vol"
    params:
      oi_extreme_z: 999.0         # OI part effectively disabled
      oi_reversal_window: 6
      reduce_pct: 0.5
      oi_lookback: 24
      oi_z_window: 168
      vol_spike_z: 2.0            # Vol spike protection ENABLED
      overlay_cooldown_bars: 12
      trend_lookback: 20
      atr_period: 14
      vol_z_window: 168

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.40

position_sizing:
  method: "fixed"
  position_pct: 1.0

# ── Portfolio allocation: 8-symbol equal-weight ──
# 研究階段使用等權重，避免引入 allocation bias
# BTC/ETH 不額外加權（與 Meta-Blend 不同）
portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.125
    ETHUSDT: 0.125
    SOLUSDT: 0.125
    BNBUSDT: 0.125
    DOGEUSDT: 0.125
    ADAUSDT: 0.125
    AVAXUSDT: 0.125
    LINKUSDT: 0.125

notification:
  enabled: false

output:
  report_dir: "./reports"
