# ═══════════════════════════════════════════════════════════════
# RESEARCH — Tier Unification Ablation: ALL TSMOM_HEAVY
# ═══════════════════════════════════════════════════════════════
# Purpose: 測試所有幣種統一使用 tsmom_heavy tier (70/30) 的表現
#   70% TSMOM + 30% BasisCarry — 動量權重更高的統一配置
#   其他一切與 prod_candidate_htf_lsr.yaml 完全相同
#
# Baseline: prod_candidate_htf_lsr.yaml (Portfolio SR=3.77)
# Compare: research_tier_ablation_all_default.yaml (50/50)
# ═══════════════════════════════════════════════════════════════

market:
  symbols:
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - DOGEUSDT
    - ADAUSDT
    - AVAXUSDT
    - LINKUSDT
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "meta_blend"
  display_name: "Tier Ablation: ALL TSMOM_HEAVY"
  params:
    # ── 所有幣種統一用 tsmom_heavy tier (70/30) ──
    sub_strategies:
      - name: "tsmom_carry_v2"
        weight: 1.0
        params:
          combination_mode: "confirmatory"
          tier: "tsmom_heavy"
          tsmom_lookback: 168
          tsmom_vol_target: 0.15
          tsmom_ema_fast: 20
          tsmom_ema_slow: 50
          tsmom_agree_weight: 1.0
          tsmom_disagree_weight: 0.3
          w_tsmom: 0.70
          w_basis_carry: 0.30
          basis_ema_fast: 24
          basis_ema_slow: 168
          basis_tanh_scale: 50.0
          fr_rolling_window: 72
          basis_carry_fr_weight: 0.7
          basis_carry_basis_weight: 0.3
          carry_agree_scale: 1.0
          carry_disagree_scale: 0.7
          carry_neutral_scale: 0.85
          carry_confirm_smoothing: 24
          composite_ema: 12
          position_step: 0.1
          min_change_threshold: 0.05
          htf_filter_enabled: true

  # ── 無 symbol_overrides — 所有幣種統一配置 ──

  # ── Overlay: 完全相同 ──
  overlay:
    enabled: true
    mode: "oi_vol+lsr_confirmatory"
    params:
      oi_extreme_z: 999.0
      oi_reversal_window: 6
      reduce_pct: 0.5
      oi_lookback: 24
      oi_z_window: 168
      vol_spike_z: 2.0
      overlay_cooldown_bars: 12
      trend_lookback: 20
      atr_period: 14
      vol_z_window: 168
      lsr_type: "lsr"
      lsr_window: 168
      lsr_entry_pctile: 0.85
      lsr_scale_boost: 1.3
      lsr_scale_reduce: 0.3
      lsr_min_coverage: 0.3
      lsr_pos_threshold: 0.05
      oi_confirm_enabled: true
      fr_confirm_enabled: true

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.40

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.45
    ETHUSDT: 0.45
    SOLUSDT: 0.35
    BNBUSDT: 0.35
    DOGEUSDT: 0.35
    ADAUSDT: 0.35
    AVAXUSDT: 0.35
    LINKUSDT: 0.35

output:
  report_dir: "./reports"
