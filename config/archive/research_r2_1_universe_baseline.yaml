# ═══════════════════════════════════════════════════════════════
# RESEARCH — R2.1 Baseline (Vol-only) — Expanded 19-Symbol Universe
# ═══════════════════════════════════════════════════════════════
# Created: 2026-02-21
# Base: prod_candidate_R2_1.yaml
# Change: Expanded from 3 → 19 symbols, vol-parity weighting
# MATICUSDT excluded (data ends 2024-09-11, Binance→POL migration)
#
# Strategy routing:
#   BTC  → breakout_vol_atr (same as R2.1)
#   ETH  → tsmom_multi_ema (same as R2.1)
#   All others → tsmom_ema (default)
#
# RESEARCH ONLY — DO NOT USE FOR LIVE TRADING
# ═══════════════════════════════════════════════════════════════

market:
  symbols:
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - XRPUSDT
    - DOGEUSDT
    - ADAUSDT
    - AVAXUSDT
    - LINKUSDT
    - DOTUSDT
    - LTCUSDT
    - NEARUSDT
    - APTUSDT
    - ARBUSDT
    - OPUSDT
    - FILUSDT
    - ATOMUSDT
    - UNIUSDT
    - AAVEUSDT
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "tsmom_ema"
  params:
    lookback: 168
    vol_target: 0.15
    ema_fast: 20
    ema_slow: 50
    agree_weight: 1.0
    disagree_weight: 0.3
  symbol_overrides: {}

  # ── Vol-only Overlay (OI disabled via extreme threshold) ──
  overlay:
    enabled: true
    mode: "oi_vol"
    params:
      oi_extreme_z: 999.0
      oi_reversal_window: 6
      reduce_pct: 0.5
      oi_lookback: 24
      oi_z_window: 168
      vol_spike_z: 2.0
      overlay_cooldown_bars: 12
      trend_lookback: 20
      atr_period: 14
      vol_z_window: 168

ensemble:
  enabled: true
  weight_mode: "fixed"
  # Vol-parity weights (computed from trailing 720h realized vol)
  fixed_weights:
    BTCUSDT: 0.0722
    ETHUSDT: 0.0538
    SOLUSDT: 0.0509
    BNBUSDT: 0.0707
    XRPUSDT: 0.0491
    DOGEUSDT: 0.0512
    ADAUSDT: 0.0511
    AVAXUSDT: 0.0545
    LINKUSDT: 0.0538
    DOTUSDT: 0.0540
    LTCUSDT: 0.0605
    NEARUSDT: 0.0495
    APTUSDT: 0.0483
    ARBUSDT: 0.0495
    OPUSDT: 0.0426
    FILUSDT: 0.0489
    ATOMUSDT: 0.0523
    UNIUSDT: 0.0394
    AAVEUSDT: 0.0477
  vol_parity:
    lookback: 720
    min_weight: 0.03
    max_weight: 0.20

  strategies:
    BTCUSDT:
      name: "breakout_vol_atr"
      params:
        channel_period: 336
        channel_multiplier: 2.5
        atr_period: 14
        vol_fast_period: 14
        vol_slow_period: 72
        expansion_ratio: 1.1
        fake_breakout_bars: 6
        min_hold_bars: 24
        trail_exit_mid: true
        stop_loss_atr: 3.5
        max_holding_bars: 72
        cooldown_bars: 24
        vol_scale_enabled: true
        vol_scale_target: 99.0
        vol_scale_lookback: 168
        vol_scale_floor: 0.7
        vol_scale_cap: 0.7
        volume_confirm_enabled: true
        volume_confirm_period: 20
        volume_confirm_ratio: 1.5

    ETHUSDT:
      name: "tsmom_multi_ema"
      params:
        lookbacks: [72, 168, 336, 720]
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3

    # All other symbols use the default tsmom_ema strategy
    # (defined in top-level strategy.name + strategy.params)

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.40

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.0722
    ETHUSDT: 0.0538
    SOLUSDT: 0.0509
    BNBUSDT: 0.0707
    XRPUSDT: 0.0491
    DOGEUSDT: 0.0512
    ADAUSDT: 0.0511
    AVAXUSDT: 0.0545
    LINKUSDT: 0.0538
    DOTUSDT: 0.0540
    LTCUSDT: 0.0605
    NEARUSDT: 0.0495
    APTUSDT: 0.0483
    ARBUSDT: 0.0495
    OPUSDT: 0.0426
    FILUSDT: 0.0489
    ATOMUSDT: 0.0523
    UNIUSDT: 0.0394
    AAVEUSDT: 0.0477

output:
  report_dir: "./reports"
