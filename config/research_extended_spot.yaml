# ═══════════════════════════════════════════════════════════════
# RESEARCH — Extended Spot Backtest (TSMOM Core Factor Validation)
# ═══════════════════════════════════════════════════════════════
# Purpose: Validate TSMOM + Basis + HTF Filter core alpha on Binance Spot
#          data from 2017-08 onwards (3+ extra years vs futures baseline).
#
# Comparison Baseline: prod_candidate_simplified.yaml (futures, 2020-10+, SR=3.80)
#
# KEY DIFFERENCES vs Production:
#   1. market_type: spot (long-only, signals clipped to [0,1])
#   2. Symbols: 6 of 8 (no SOL/AVAX — not listed until 2020)
#   3. Start: 2017-08-17 (Binance Spot launch, per-symbol data varies)
#   4. Overlay: DISABLED (no OI/LSR data for spot)
#   5. Funding rate: DISABLED (spot has no funding)
#   6. Leverage: 1 (spot)
#   7. FR/OI signals: auto-fallback to Basis-only (strategy handles gracefully)
#
# EXPECTED BEHAVIOR:
#   - TSMOM + EMA signal: works identically (uses OHLCV only)
#   - Basis signal: works identically (uses OHLCV only)
#   - HTF filter: works identically (uses OHLCV only)
#   - Carry (FR/OI): degrades to pure Basis (no FR/OI in spot)
#   - Overlay chain: disabled (no OI/LSR)
#   - Direction: long-only (negative signals auto-clipped)
#
# DATA AVAILABILITY (Binance Spot 1h):
#   BTCUSDT:  2017-08-17
#   ETHUSDT:  2017-08-17
#   BNBUSDT:  2017-11-06
#   ADAUSDT:  2018-04-17
#   LINKUSDT: 2019-01-16
#   DOGEUSDT: 2019-07-05
# ═══════════════════════════════════════════════════════════════

market:
  symbols:
    - BTCUSDT
    - ETHUSDT
    - BNBUSDT
    - ADAUSDT
    - LINKUSDT
    - DOGEUSDT
  interval: "1h"
  start: "2017-08-17"
  end: null
  market_type: "spot"

strategy:
  name: "meta_blend"
  display_name: "Extended Spot — TSMOM Core Factor Validation"
  params:
    # ── Default sub-strategy (BNB, DOGE, ADA) ──
    # Same params as production; FR/OI auto-fallback to Basis
    sub_strategies:
      - name: "tsmom_carry_v2"
        weight: 1.0
        params:
          combination_mode: "confirmatory"
          tier: "default"
          tsmom_lookback: 168
          tsmom_vol_target: 0.15
          tsmom_ema_fast: 20
          tsmom_ema_slow: 50
          tsmom_agree_weight: 1.0
          tsmom_disagree_weight: 0.3
          basis_ema_fast: 24
          basis_ema_slow: 168
          basis_tanh_scale: 50.0
          fr_rolling_window: 72
          oi_z_window: 168
          basis_carry_fr_weight: 0.7
          basis_carry_basis_weight: 0.3
          carry_agree_scale: 1.0
          carry_disagree_scale: 0.7
          carry_neutral_scale: 0.85
          carry_confirm_smoothing: 24
          composite_ema: 12
          position_step: 0.1
          min_change_threshold: 0.05
          htf_filter_enabled: true

  symbol_overrides:
    # ── BTC: btc_enhanced (720h, 30/100) + HTF daily-dominant ──
    BTCUSDT:
      sub_strategies:
        - name: "tsmom_carry_v2"
          weight: 1.0
          params:
            combination_mode: "confirmatory"
            tier: "btc_enhanced"
            tsmom_lookback: 720
            tsmom_ema_fast: 30
            tsmom_ema_slow: 100
            tsmom_vol_target: 0.15
            tsmom_agree_weight: 1.0
            tsmom_disagree_weight: 0.3
            basis_ema_fast: 24
            basis_ema_slow: 168
            basis_tanh_scale: 50.0
            carry_agree_scale: 1.0
            carry_disagree_scale: 0.6
            carry_neutral_scale: 0.85
            carry_confirm_smoothing: 24
            composite_ema: 12
            position_step: 0.1
            min_change_threshold: 0.05
            htf_filter_enabled: true
            htf_4h_ema_fast: 30
            htf_4h_ema_slow: 100
            htf_no_confirm: 0.7
            htf_4h_only_confirm: 0.3

    # ── ETH: eth_enhanced (will auto-degrade to Basis-only, no FR/OI) ──
    ETHUSDT:
      sub_strategies:
        - name: "tsmom_carry_v2"
          weight: 1.0
          params:
            combination_mode: "confirmatory"
            tier: "eth_enhanced"
            tsmom_lookback: 168
            tsmom_vol_target: 0.15
            tsmom_ema_fast: 20
            tsmom_ema_slow: 50
            tsmom_agree_weight: 1.0
            tsmom_disagree_weight: 0.3
            w_tsmom: 0.40
            w_oi: 0.25
            w_fr: 0.15
            w_basis: 0.20
            basis_ema_fast: 24
            basis_ema_slow: 168
            basis_tanh_scale: 50.0
            fr_rolling_window: 72
            oi_z_window: 168
            carry_agree_scale: 1.0
            carry_disagree_scale: 0.7
            carry_neutral_scale: 0.85
            carry_confirm_smoothing: 24
            composite_ema: 12
            position_step: 0.1
            min_change_threshold: 0.05
            htf_filter_enabled: true

    # ── LINK: tsmom_only (carry IC unstable) + HTF C_hard ──
    LINKUSDT:
      sub_strategies:
        - name: "tsmom_carry_v2"
          weight: 1.0
          params:
            tier: "tsmom_only"
            tsmom_lookback: 168
            tsmom_vol_target: 0.15
            tsmom_ema_fast: 20
            tsmom_ema_slow: 50
            tsmom_agree_weight: 1.0
            tsmom_disagree_weight: 0.3
            composite_ema: 12
            position_step: 0.1
            min_change_threshold: 0.05
            htf_filter_enabled: true

  # Overlay: DISABLED (no OI/LSR data for spot)
  overlay:
    enabled: false

backtest:
  initial_cash: 10000
  fee_bps: 10
  slippage_bps: 5
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: false
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.40

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.20
    ETHUSDT: 0.20
    BNBUSDT: 0.15
    ADAUSDT: 0.15
    LINKUSDT: 0.15
    DOGEUSDT: 0.15

output:
  report_dir: "./reports"
