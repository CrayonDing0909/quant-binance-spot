# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# RESEARCH â€” R2 + OI Exit Overlay (A: Conservative)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Base: prod_candidate_R2.yaml (unchanged strategy params)
# Overlay: conservative â€” hard to trigger, few interventions
#
# Philosophy:
#   Only intervene when OI is VERY extreme (z>2.5) and vol spike is extreme (z>3.0).
#   Small reduction (30%) + long cooldown (24 bars = 1 day).
#   This is the "do no harm" variant â€” expected minimal trade reduction
#   but also minimal alpha impact.
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

market:
  symbols: ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "tsmom_ema"
  params:
    lookback: 168
    vol_target: 0.15
    ema_fast: 20
    ema_slow: 50
    agree_weight: 1.0
    disagree_weight: 0.3
  symbol_overrides: {}

ensemble:
  enabled: true
  weight_mode: "fixed"
  fixed_weights:
    BTCUSDT: 0.34
    ETHUSDT: 0.33
    SOLUSDT: 0.33
  vol_parity:
    lookback: 720
    min_weight: 0.20
    max_weight: 0.50

  strategies:
    BTCUSDT:
      name: "breakout_vol_atr"
      params:
        channel_period: 336
        channel_multiplier: 2.5
        atr_period: 14
        vol_fast_period: 14
        vol_slow_period: 72
        expansion_ratio: 1.1
        fake_breakout_bars: 6
        min_hold_bars: 24
        trail_exit_mid: true
        stop_loss_atr: 3.5
        max_holding_bars: 72
        cooldown_bars: 24
        vol_scale_enabled: true
        vol_scale_target: 99.0
        vol_scale_lookback: 168
        vol_scale_floor: 0.7
        vol_scale_cap: 0.7
        volume_confirm_enabled: true
        volume_confirm_period: 20
        volume_confirm_ratio: 1.5

    ETHUSDT:
      name: "tsmom_multi_ema"
      params:
        lookbacks: [72, 168, 336, 720]
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3

    SOLUSDT:
      name: "tsmom_ema"
      params:
        lookback: 168
        vol_target: 0.15
        ema_fast: 20
        ema_slow: 50
        agree_weight: 1.0
        disagree_weight: 0.3

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# OI/Vol Overlay åƒæ•¸ (A: Conservative)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
oi_vol_overlay:
  enabled: true
  # OI ä¿¡è™Ÿè¨ˆç®—
  oi_lookback: 24          # OI è®ŠåŒ–ç‡å›çœ‹æœŸ (bars)
  oi_z_window: 168         # OI z-score æ»¾å‹•çª—å£ (bars)
  # è§¸ç™¼æ¢ä»¶
  oi_extreme_z: 2.5        # OI zscore è§¸ç™¼é–¾å€¼ (conservative: hard to trigger)
  oi_reversal_window: 6    # OI åè½‰ç¢ºèªå›çœ‹æœŸ (bars)
  reduce_pct: 0.3          # è§¸ç™¼æ™‚æ¸›å€‰æ¯”ä¾‹ (conservative: small reduction)
  # æ³¢å‹•ç‡
  atr_period: 14
  vol_z_window: 168
  vol_spike_z: 3.0         # Vol zscore è§¸ç™¼é–¾å€¼ (conservative: very high)
  trend_lookback: 20       # è¶¨å‹¢æ–¹å‘è¨ˆç®—å›çœ‹æœŸ
  # å†·å»æœŸ
  overlay_cooldown_bars: 24  # è§¸ç™¼å¾Œå†·å» (conservative: 1 day)

risk:
  max_drawdown_pct: 0.30

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.34
    ETHUSDT: 0.33
    SOLUSDT: 0.33

live:
  kline_cache: true
  flip_confirmation: false
  prefer_limit_order: true
  limit_order_timeout_s: 10

notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸ”¬ [R2-OI-A]"
  enabled: true

output:
  report_dir: "./reports"
