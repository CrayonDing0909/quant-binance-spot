# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# PRODUCTION CANDIDATE â€” Simplified (HTF Filter v2 + LSR, No Breakout)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Created: 2026-02-28
# Origin: config/research_simplified_prod_candidate.yaml (Config E)
# Baseline: config/prod_candidate_htf_lsr.yaml (current production, SR=3.77)
# Lineage: tsmom_carry_v2 â†’ meta_blend â†’ HTF Filter v2 â†’ HTF Filter v2 + LSR â†’ Simplified
#
# CHANGE vs BASELINE (prod_candidate_htf_lsr.yaml):
#   1. REMOVED: BTC breakout_vol_atr (20 params, negative contribution Î” SR=-0.03)
#   2. REMOVED: dead params (w_tsmom, w_basis_carry) â€” confirmatory mode doesn't read them
#   3. UNIFIED: SOL/AVAX from tsmom_heavy â†’ default (identical in confirmatory mode)
#   4. KEPT: BTC btc_enhanced (720h, 30/100) â€” academic support, +0.38 per-sym SR
#   5. KEPT: ETH eth_enhanced (OI/FR/Basis) â€” independent data sources
#   6. KEPT: LINK tsmom_only â€” regularization (removes unstable carry)
#   Parameter reduction: ~85 â†’ ~45 (47% fewer)
#
# STRATEGY SUMMARY:
#   meta_blend, per-symbol routing (3 meaningful tiers):
#     BTC:   100% tsmom_carry_v2 btc_enhanced (720h, 30/100) + HTF daily-dominant
#     ETH:   100% tsmom_carry_v2 eth_enhanced (OI/FR/Basis) + HTF C_hard
#     SOL/AVAX/BNB/DOGE/ADA: 100% tsmom_carry_v2 default + HTF C_hard
#     LINK:  100% tsmom_carry_v2 tsmom_only + HTF C_hard
#   Overlay chain: oi_vol (vol spike protection) â†’ lsr_confirmatory (alpha timing)
#
# VALIDATION RESULTS (2026-02-28):
#   Portfolio Sharpe:  3.85  (vs prod: 3.77, Î” +0.08)
#   Total Return:      +243.2%
#   Max Drawdown:      -3.67% (vs prod: -3.91%)
#   Calmar:            9.39  (vs prod: 9.11)
#   Sortino:           5.66
#   WFA:               8/8 OOS+, avg degradation 27.9%, max 45.2% (LINK)
#   CPCV:              PBO max 0.13 (SOL/DOGE/ADA), rest 0.07 â€” identical to prod
#                      4/8 symbols have NEGATIVE degradation (OOS > IS)
#   DSR:               1.42 (p<0.001) â†’ PASS
#   Cross-Asset LOAO:  robust, avg degradation -0.9%
#   Monte Carlo:       avg VaR95% = 0.19%
#   Pre-Deploy:        11 PASS / 3 WARN / 0 FAIL
#   Kelly:             8/8 PASS, all recommend 25% Kelly
#
# ABLATION EVIDENCE (2026-02-28, 5-config study):
#   A (prod, 5 tiers + breakout):  SR 3.77
#   B (all default):               SR 3.57 (Î” -0.20)
#   C (all tsmom_heavy):           SR 3.57 = B (confirms dead params)
#   D (BTC no breakout, default):  SR 3.66 (Î” -0.11)
#   E (this config):               SR 3.85 (Î” +0.08) â† BEST
#   Key finding: BTC breakout is negative alpha (SR 2.02â†’1.99 when added)
#   Key finding: BTC 720h lookback is real alpha (+0.38 per-sym SR)
#
# DEPLOYMENT:
#   Replaces: prod_candidate_htf_lsr.yaml in meta_blend_live tmux
#   Rollback L1: prod_candidate_htf_lsr.yaml (SR=3.77)
#   Rollback L2: prod_candidate_htf_filter.yaml (SR=2.75)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

market:
  symbols:
    - BTCUSDT
    - ETHUSDT
    - SOLUSDT
    - BNBUSDT
    - DOGEUSDT
    - ADAUSDT
    - AVAXUSDT
    - LINKUSDT
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"

futures:
  leverage: 3
  margin_type: "ISOLATED"
  position_mode: "ONE_WAY"
  direction: "both"

strategy:
  name: "meta_blend"
  display_name: "HTF Filter v2 + LSR (Simplified)"
  params:
    # â”€â”€ Default sub-strategy (SOL, AVAX, BNB, DOGE, ADA) â”€â”€
    # confirmatory mode: w_tsmom / w_basis_carry are dead params (not used)
    sub_strategies:
      - name: "tsmom_carry_v2"
        weight: 1.0
        params:
          combination_mode: "confirmatory"
          tier: "default"
          tsmom_lookback: 168
          tsmom_vol_target: 0.15
          tsmom_ema_fast: 20
          tsmom_ema_slow: 50
          tsmom_agree_weight: 1.0
          tsmom_disagree_weight: 0.3
          basis_ema_fast: 24
          basis_ema_slow: 168
          basis_tanh_scale: 50.0
          fr_rolling_window: 72
          oi_z_window: 168
          basis_carry_fr_weight: 0.7
          basis_carry_basis_weight: 0.3
          carry_agree_scale: 1.0
          carry_disagree_scale: 0.7
          carry_neutral_scale: 0.85
          carry_confirm_smoothing: 24
          composite_ema: 12
          position_step: 0.1
          min_change_threshold: 0.05
          htf_filter_enabled: true

  symbol_overrides:
    # â”€â”€ BTC: 100% tsmom_carry_v2 btc_enhanced (720h, 30/100) + HTF daily-dominant â”€â”€
    # Academic support: BTC has longer trend cycles due to institutional adoption
    # Ablation evidence: 720h lookback â†’ +0.38 per-sym SR (1.64â†’2.02)
    BTCUSDT:
      sub_strategies:
        - name: "tsmom_carry_v2"
          weight: 1.0
          params:
            combination_mode: "confirmatory"
            tier: "btc_enhanced"
            tsmom_lookback: 720
            tsmom_ema_fast: 30
            tsmom_ema_slow: 100
            tsmom_vol_target: 0.15
            tsmom_agree_weight: 1.0
            tsmom_disagree_weight: 0.3
            basis_ema_fast: 24
            basis_ema_slow: 168
            basis_tanh_scale: 50.0
            carry_agree_scale: 1.0
            carry_disagree_scale: 0.6
            carry_neutral_scale: 0.85
            carry_confirm_smoothing: 24
            composite_ema: 12
            position_step: 0.1
            min_change_threshold: 0.05
            htf_filter_enabled: true
            htf_4h_ema_fast: 30
            htf_4h_ema_slow: 100
            htf_no_confirm: 0.7
            htf_4h_only_confirm: 0.3

    # â”€â”€ ETH: 100% tsmom_carry_v2 eth_enhanced (OI/FR/Basis) + HTF C_hard â”€â”€
    # Uses independent derivatives data sources (low overfitting risk)
    ETHUSDT:
      sub_strategies:
        - name: "tsmom_carry_v2"
          weight: 1.0
          params:
            combination_mode: "confirmatory"
            tier: "eth_enhanced"
            tsmom_lookback: 168
            tsmom_vol_target: 0.15
            tsmom_ema_fast: 20
            tsmom_ema_slow: 50
            tsmom_agree_weight: 1.0
            tsmom_disagree_weight: 0.3
            w_tsmom: 0.40
            w_oi: 0.25
            w_fr: 0.15
            w_basis: 0.20
            basis_ema_fast: 24
            basis_ema_slow: 168
            basis_tanh_scale: 50.0
            fr_rolling_window: 72
            oi_z_window: 168
            carry_agree_scale: 1.0
            carry_disagree_scale: 0.7
            carry_neutral_scale: 0.85
            carry_confirm_smoothing: 24
            composite_ema: 12
            position_step: 0.1
            min_change_threshold: 0.05
            htf_filter_enabled: true

    # â”€â”€ LINK: 100% tsmom_carry_v2 tsmom_only (carry IC unstable) + HTF C_hard â”€â”€
    # Removing carry is regularization, not overfitting
    LINKUSDT:
      sub_strategies:
        - name: "tsmom_carry_v2"
          weight: 1.0
          params:
            tier: "tsmom_only"
            tsmom_lookback: 168
            tsmom_vol_target: 0.15
            tsmom_ema_fast: 20
            tsmom_ema_slow: 50
            tsmom_agree_weight: 1.0
            tsmom_disagree_weight: 0.3
            composite_ema: 12
            position_step: 0.1
            min_change_threshold: 0.05
            htf_filter_enabled: true

    # SOL, AVAX, BNB, DOGE, ADA â†’ inherit default (no overrides needed)

  # â”€â”€ Overlay: oi_vol + lsr_confirmatory (identical to prod) â”€â”€
  overlay:
    enabled: true
    mode: "oi_vol+lsr_confirmatory"
    params:
      oi_extreme_z: 999.0
      oi_reversal_window: 6
      reduce_pct: 0.5
      oi_lookback: 24
      oi_z_window: 168
      vol_spike_z: 2.0
      overlay_cooldown_bars: 12
      trend_lookback: 20
      atr_period: 14
      vol_z_window: 168
      lsr_type: "lsr"
      lsr_window: 168
      lsr_entry_pctile: 0.85
      lsr_scale_boost: 1.3
      lsr_scale_reduce: 0.3
      lsr_min_coverage: 0.3
      lsr_pos_threshold: 0.05
      oi_confirm_enabled: true
      fr_confirm_enabled: true

backtest:
  initial_cash: 10000
  fee_bps: 5
  slippage_bps: 3
  trade_on: "next_open"
  validate_data: true
  clean_data: true
  funding_rate:
    enabled: true
    default_rate_8h: 0.0001
    use_historical: true
  slippage_model:
    enabled: false

risk:
  max_drawdown_pct: 0.40

position_sizing:
  method: "fixed"
  position_pct: 1.0

portfolio:
  cash_reserve: 0
  allocation:
    BTCUSDT: 0.45
    ETHUSDT: 0.45
    SOLUSDT: 0.35
    BNBUSDT: 0.35
    DOGEUSDT: 0.35
    ADAUSDT: 0.35
    AVAXUSDT: 0.35
    LINKUSDT: 0.35

live:
  kline_cache: true
  flip_confirmation: false
  prefer_limit_order: true
  limit_order_timeout_s: 10

  rebalance_band:
    enabled: true
    threshold_pct: 0.03
    apply_on_same_direction_only: true

  symbol_governance:
    enabled: true
    review_frequency: "weekly"
    warmup_days: 14
    quarantine_min_days: 14
    consecutive_reviews_for_quarantine: 2
    consecutive_reviews_for_recovery: 2
    artifacts_dir: "reports/symbol_governance"

    thresholds:
      edge_sharpe_deweight: 0.3
      edge_sharpe_quarantine: 0.0
      edge_sharpe_recover_active: 0.8
      edge_sharpe_recover_from_quarantine: 0.5
      edge_per_turnover_min: 0.0
      slippage_ratio_deweight: 1.5
      slippage_ratio_quarantine: 1.8
      slippage_ratio_recover_active: 1.2
      slippage_ratio_recover_from_quarantine: 1.3
      consistency_min: 99.0
      consistency_recover: 99.5
      missed_signals_quarantine: 5.0
      dd_quarantine_pct: 25.0

    weights:
      active_multiplier: 1.0
      deweight_multiplier: 0.5
      quarantine_multiplier: 0.0
      min_weight: 0.03
      max_weight: 0.20

  watchdog:
    enabled: true
    interval_sec: 300
    alert_cooldown_sec: 1800
    startup_grace_sec: 300
    runner_ready_grace_sec: 180
    heartbeat_warn_sec: 90
    heartbeat_critical_sec: 180
    ws_msg_warn_sec: 180
    ws_msg_critical_sec: 300
    data_warn_age_sec:
      "1h": 7200
      "5m": 1800
    data_critical_age_sec:
      "1h": 14400
      "5m": 3600
    error_window_minutes: 15
    error_warn_count: 5
    error_critical_count: 12

notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ðŸš€ [SIMPLIFIED]"
  enabled: true

output:
  report_dir: "./reports"
