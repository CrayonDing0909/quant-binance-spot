# ============================================================
# RSI + ADX + ATR 策略 — 優化後參數 (2026-02-07)
# Grid Search 729 組合 → Walk-Forward 5-fold 驗證通過
# ============================================================
#
# BTCUSDT 最佳: Sharpe 3.71 → WF測試 Sharpe 3.84 (5/5 正收益)
# ETHUSDT 最佳: Sharpe 4.12 → WF測試 Sharpe 3.83 (5/5 正收益)
#
# 核心邏輯:
#   RSI < oversold 且 ADX > min_adx → 做多
#   止損 = entry - 1.5×ATR, 止盈 = entry + 4.0×ATR (RR 1:2.67)
# ============================================================

market:
  symbols: ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT"]
  interval: "1h"
  start: "2022-01-01"
  end: null

backtest:
  initial_cash: 10000
  fee_bps: 6
  slippage_bps: 5
  trade_on: "next_open"
  validate_data: true
  clean_data: true

strategy:
  name: "rsi_adx_atr"
  # ── 基礎參數（所有幣種共用）──
  params:
    rsi_period: 10
    overbought: 65
    min_adx: 15
    adx_period: 14
    stop_loss_atr: 1.5
    take_profit_atr: 4.0
    trailing_stop_atr: null
    atr_period: 14
    cooldown_bars: 1
    # ── 多時間框架趨勢過濾（可選）──
    # 4h EMA20>EMA50 = 上升趨勢才允許 1h 做多
    # 回測顯示：現有 ADX filter 已足夠，HTF 過濾器過度保守
    # 設為 null = 不啟用（推薦），設為 "4h" = 啟用
    htf_interval: null
    htf_ema_fast: 20
    htf_ema_slow: 50
  # ── 幣種專屬參數覆寫（合併到 params）──
  # 波動率過濾器測試結論：原始設定最佳，低波動整體 Sharpe=1.30 仍為正
  symbol_overrides:
    BTCUSDT:
      oversold: 30        # Sharpe 3.71, WF-test 3.84
    ETHUSDT:
      oversold: 35        # Sharpe 4.12, WF-test 3.83
    BNBUSDT:
      oversold: 30
    SOLUSDT:
      oversold: 30

# ── 風控 ──
# max_drawdown_pct: 最大回撤比例，超過則觸發熔斷
#   設置原則：歷史最大回撤 × 1.5~2 倍
#   本策略 BTC MDD=17%, ETH MDD=13.5% → 熔斷線設 30%
#   null = 不啟用熔斷
risk:
  max_drawdown_pct: 0.30

# ── 倉位計算 ──
# method: 倉位計算方法
#   - "fixed": 固定倉位（預設）
#   - "kelly": 根據歷史交易統計動態調整
#   - "volatility": 根據波動率調整
# 
# Kelly 參數說明:
#   - kelly_fraction: 比例因子，1.0=Full Kelly（風險高），0.25=Quarter Kelly（推薦）
#   - min_trades_for_kelly: 啟用 Kelly 前需要的最小交易數，不足時用固定倉位
#   - win_rate/avg_win/avg_loss: 手動設置，null 則自動從歷史交易計算
position_sizing:
  method: "fixed"  # 預設固定倉位，有足夠交易數據後可改為 "kelly"
  position_pct: 1.0
  kelly_fraction: 0.25
  min_trades_for_kelly: 20

# ── 多幣種倉位分配 ──
# cash_reserve: 現金保留比例（預設 0.2 = 20%）
# allocation: 手動分配（null = 自動等權分配）
#
# 自動分配邏輯：
#   每幣權重 = (1 - cash_reserve) / 幣種數量
#   例如：4 幣 + 20% 現金 → 每幣 20%
#        5 幣 + 20% 現金 → 每幣 16%
#
# 新增幣種只需修改 market.symbols，倉位會自動重新分配！
portfolio:
  cash_reserve: 0.20  # 保留 20% 現金緩衝
  allocation: null    # null = 自動等權分配

output:
  report_dir: "./reports"
