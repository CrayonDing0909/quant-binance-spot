# æ–°æ‰‹å®Œæ•´æ•™å­¸ï¼šå¾ç­–ç•¥ç™¼æƒ³åˆ°å¯¦ç›¤

æœ¬æ•™å­¸å°‡å¸¶ä½ å¾é›¶é–‹å§‹ï¼Œå®Œæ•´åœ°é–‹ç™¼ä¸€å€‹äº¤æ˜“ç­–ç•¥ï¼ŒåŒ…æ‹¬ç­–ç•¥ç™¼æƒ³ã€å¯¦ç¾ã€å›æ¸¬ã€å„ªåŒ–å’Œé©—è­‰ã€‚

**æ”¯æ´ç¾è²¨ (Spot) å’Œåˆç´„ (Futures) äº¤æ˜“ï¼** ğŸŸ¢ ğŸ”´

## ğŸ“‹ ç›®éŒ„

1. [å°ˆæ¡ˆåŠŸèƒ½æ¦‚è¦½](#å°ˆæ¡ˆåŠŸèƒ½æ¦‚è¦½)
2. [ç¬¬ä¸€æ­¥ï¼šç­–ç•¥ç™¼æƒ³](#ç¬¬ä¸€æ­¥ç­–ç•¥ç™¼æƒ³)
3. [ç¬¬äºŒæ­¥ï¼šå»ºç«‹ç­–ç•¥](#ç¬¬äºŒæ­¥å»ºç«‹ç­–ç•¥)
4. [ç¬¬ä¸‰æ­¥ï¼šå›æ¸¬ç­–ç•¥](#ç¬¬ä¸‰æ­¥å›æ¸¬ç­–ç•¥)
5. [ç¬¬å››æ­¥ï¼šå„ªåŒ–åƒæ•¸](#ç¬¬å››æ­¥å„ªåŒ–åƒæ•¸)
6. [ç¬¬äº”æ­¥ï¼šé©—è­‰ç­–ç•¥](#ç¬¬äº”æ­¥é©—è­‰ç­–ç•¥)
7. [ç¬¬å…­æ­¥ï¼šé¢¨éšªç®¡ç†](#ç¬¬å…­æ­¥é¢¨éšªç®¡ç†)
8. [ç¬¬ä¸ƒæ­¥ï¼šå³æ™‚äº¤æ˜“](#ç¬¬ä¸ƒæ­¥å³æ™‚äº¤æ˜“)ï¼ˆå« Telegram Botã€é›²ç«¯éƒ¨ç½²ï¼‰
9. [ç¬¬å…«æ­¥ï¼šç›£æ§èˆ‡ç¶­é‹](#ç¬¬å…«æ­¥ç›£æ§èˆ‡ç¶­é‹)
10. [åˆç´„äº¤æ˜“æ•™å­¸](#åˆç´„äº¤æ˜“æ•™å­¸)ï¼ˆå« SL/TP å»é‡ã€å€‰ä½åˆ†é…ã€API é™ç´šï¼‰
11. [å¢é‡ K ç·šå¿«å–](#å¢é‡-k-ç·šå¿«å–) â­ v2.8ï¼ˆè§£æ±ºå¯¦ç›¤ vs å›æ¸¬æ•¸æ“šä¸ä¸€è‡´ï¼‰
12. [å¤šæ•¸æ“šæºèˆ‡é•·æœŸæ­·å²æ•¸æ“š](#å¤šæ•¸æ“šæºèˆ‡é•·æœŸæ­·å²æ•¸æ“š)
13. [çµ„åˆå›æ¸¬](#çµ„åˆå›æ¸¬)
14. [RSI Exit ç­–ç•¥é…ç½®](#rsi-exit-ç­–ç•¥é…ç½®) â­ NEWï¼ˆç¶“é©—è­‰çš„æœ€ä½³é…ç½®ï¼‰
15. [ç­–ç•¥å‡ç´šï¼šDynamic RSI + Funding Filter](#ç­–ç•¥å‡ç´šdynamic-rsi--funding-filter) â­ v3.0
16. [åŸ·è¡Œå„ªåŒ–ï¼šMaker å„ªå…ˆä¸‹å–®](#åŸ·è¡Œå„ªåŒ–maker-å„ªå…ˆä¸‹å–®) â­ v3.0
17. [WebSocket äº‹ä»¶é©…å‹•](#websocket-äº‹ä»¶é©…å‹•) â­ v3.0ï¼ˆå»¶é² <1 ç§’ï¼‰
18. [SQLite äº¤æ˜“è³‡æ–™åº«](#sqlite-äº¤æ˜“è³‡æ–™åº«) â­ v3.0
19. [æ³¢å‹•ç‡éæ¿¾ + HTF è»Ÿè¶¨å‹¢éæ¿¾](#æ³¢å‹•ç‡éæ¿¾--htf-è»Ÿè¶¨å‹¢éæ¿¾) â­ v3.1
20. [æ³¢å‹•ç‡ç›®æ¨™å€‰ä½ç®¡ç†](#æ³¢å‹•ç‡ç›®æ¨™å€‰ä½ç®¡ç†) â­ v3.1
21. [Alpha Decay ç›£æ§](#alpha-decay-ç›£æ§) â­ v3.1
22. [ç­–ç•¥çµ„åˆ Ensemble](#ç­–ç•¥çµ„åˆ-ensemble) â­ v3.1
23. [å®Œæ•´ç¯„ä¾‹ï¼šRSI ç­–ç•¥](#å®Œæ•´ç¯„ä¾‹rsiç­–ç•¥)

---

## âš¡ å¿«é€Ÿç†è§£ï¼šå›æ¸¬å¦‚ä½•é‹ä½œï¼Ÿ

**é‡è¦æ¦‚å¿µ**ï¼šå›æ¸¬è…³æœ¬é€éè®€å–è¨­å®šæª”ä¾†ç¢ºå®šä½¿ç”¨å“ªå€‹ç­–ç•¥ã€‚

### å·¥ä½œæµç¨‹

```
1. ä½ å»ºç«‹ç­–ç•¥ç¨‹å¼ç¢¼ â†’ ç”¨ @register_strategy("ç­–ç•¥åç¨±") è¨»å†Š
                    â†“
2. ä½ åœ¨ config/base.yaml ä¸­è¨­å®š â†’ strategy.name = "ç­–ç•¥åç¨±"
                    â†“
3. ä½ åŸ·è¡Œ python scripts/run_backtest.py
                    â†“
4. è…³æœ¬è®€å–è¨­å®šæª” â†’ æ‰¾åˆ°ç­–ç•¥åç¨±
                    â†“
5. è…³æœ¬æ ¹æ“šåç¨±æ‰¾åˆ°ç­–ç•¥å‡½å¼ â†’ ä½¿ç”¨è¨­å®šçš„åƒæ•¸åŸ·è¡Œ
                    â†“
6. ç”¢ç”Ÿå›æ¸¬çµæœå’Œå ±å‘Š
```

### é—œéµé»

- âœ… **ç­–ç•¥åç¨±å¿…é ˆä¸€è‡´**ï¼šç¨‹å¼ç¢¼ä¸­çš„ `@register_strategy("my_strategy")` å’Œè¨­å®šæª”ä¸­çš„ `strategy.name: "my_strategy"` å¿…é ˆå®Œå…¨ä¸€è‡´
- âœ… **åƒæ•¸åœ¨è¨­å®šæª”ä¸­**ï¼šç­–ç•¥çš„åƒæ•¸åœ¨ `config/base.yaml` çš„ `strategy.params` ä¸­è¨­å®š
- âœ… **åˆ‡æ›ç­–ç•¥å¾ˆç°¡å–®**ï¼šåªéœ€è¦ä¿®æ”¹è¨­å®šæª”ï¼Œç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼
- âœ… **å›æ¸¬çµæœæ¨™æº–åŒ–**ï¼š`run_symbol_backtest()` å›å‚³ `BacktestResult` dataclassï¼Œæ‰€æœ‰è…³æœ¬å…±ç”¨åŒä¸€å¥—æˆæœ¬é‚è¼¯
- âœ… **æˆæœ¬æ¨¡å‹è‡ªå‹•å¥—ç”¨**ï¼šåˆç´„æ¨¡å¼ä¸‹ `funding_rate` å’Œ `slippage_model` æœªé–‹å•Ÿæœƒè‡ªå‹•è­¦å‘Š

### ç¯„ä¾‹

**ç¨‹å¼ç¢¼ä¸­è¨»å†Šç­–ç•¥**ï¼š
```python
@register_strategy("my_rsi_strategy")  # â† ç­–ç•¥åç¨±
def generate_positions(df, ctx, params):
    # ç­–ç•¥é‚è¼¯
    ...
```

**è¨­å®šæª”ä¸­æŒ‡å®šç­–ç•¥**ï¼š
```yaml
strategy:
  name: "my_rsi_strategy"  # â† å¿…é ˆèˆ‡ä¸Šé¢çš„åç¨±ä¸€è‡´
  params:
    period: 14
```

**åŸ·è¡Œå›æ¸¬**ï¼š
```bash
python scripts/run_backtest.py  # è‡ªå‹•è®€å–è¨­å®šï¼Œä½¿ç”¨ my_rsi_strategy
```

---

## å°ˆæ¡ˆåŠŸèƒ½æ¦‚è¦½

é€™å€‹å°ˆæ¡ˆæä¾›äº†å®Œæ•´çš„é‡åŒ–äº¤æ˜“ç­–ç•¥é–‹ç™¼å·¥å…·ï¼Œ**æ”¯æ´ç¾è²¨å’Œåˆç´„äº¤æ˜“**ï¼š

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

1. **ç­–ç•¥é–‹ç™¼**
   - å¿«é€Ÿå»ºç«‹ç­–ç•¥ç¯„æœ¬
   - çµ±ä¸€çš„æŒ‡æ¨™åº«ï¼ˆRSIã€MACDã€å¸ƒæ—å¸¶ç­‰ï¼‰
   - ç­–ç•¥è¨»å†Šç³»çµ±
   - **Dynamic RSI**ï¼ˆRolling Percentile è‡ªé©æ‡‰é–¾å€¼ï¼Œå°æŠ— Alpha Decayï¼‰â­ v3.0
   - **Funding Rate éæ¿¾å™¨**ï¼ˆç¨ç«‹å› å­ï¼Œéæ¿¾æ“æ“ äº¤æ˜“ï¼‰â­ v3.0
   - **æ³¢å‹•ç‡éæ¿¾å™¨**ï¼ˆATR/Price ä½æ–¼é–¾å€¼æ™‚ä¸é–‹å€‰ï¼Œéæ¿¾ä½æ³¢å‹•ç£¨è€—ï¼‰â­ v3.1
   - **HTF è»Ÿè¶¨å‹¢éæ¿¾**ï¼ˆå¤šæ™‚é–“æ¡†æ¶é€£çºŒæ¬Šé‡ï¼ŒéäºŒå…ƒé–˜é–€ï¼‰â­ v3.1
   - **ç­–ç•¥çµ„åˆ Ensemble**ï¼ˆRSI+MACD ä½ç›¸é—œé…å°ï¼Œä¿¡è™Ÿå¹³å‡ï¼‰â­ v3.1

2. **è³‡æ–™ç®¡ç†**
   - è‡ªå‹•ä¸‹è¼‰å¹£å®‰è³‡æ–™ï¼ˆç¾è²¨/åˆç´„ï¼‰
   - **å¤šæ•¸æ“šæºæ”¯æ´** â­ NEWï¼ˆYahoo Financeã€CCXTã€Binance Visionï¼‰
   - **é•·æœŸæ­·å²æ•¸æ“š**ï¼ˆBTC 2014 å¹´èµ·ï¼‰
   - è³‡æ–™å“è³ªæª¢æŸ¥
   - è³‡æ–™æ¸…æ´—

3. **å›æ¸¬ç³»çµ±**
   - å‘é‡åŒ–å›æ¸¬ï¼ˆå¿«é€Ÿï¼‰
   - æ”¯æ´æ‰‹çºŒè²»å’Œæ»‘é»
   - è‡ªå‹•ç”¢ç”Ÿå ±å‘Šå’Œåœ–è¡¨
   - **æ”¯æ´åšç©ºæ¨¡æ“¬ï¼ˆåˆç´„ï¼‰** â­ NEW
   - **çµ„åˆå›æ¸¬**ï¼ˆå¤šå¹£ç¨®æ¬Šé‡é…ç½®ï¼‰â­ NEW
   - **`BacktestResult` dataclass**ï¼ˆæ¨™æº–åŒ–å›æ¸¬è¼¸å‡ºï¼Œé˜²æ­¢è·¯å¾‘ä¸ä¸€è‡´ï¼‰â­ v3.2
   - **`validate_backtest_config`**ï¼ˆåˆç´„æ¨¡å¼è‡ªå‹•è­¦å‘Šæœªé–‹æˆæœ¬æ¨¡å‹ï¼‰â­ v3.2

4. **ç­–ç•¥å„ªåŒ–**
   - åƒæ•¸ç¶²æ ¼æœå°‹
   - å¤šæŒ‡æ¨™å„ªåŒ–
   - **ç¶œåˆå›æ¸¬**ï¼ˆå¸‚å ´éšæ®µ + å€‰ä½ç®¡ç† + å‡ºå ´ç­–ç•¥ï¼‰â­ NEW

5. **ç­–ç•¥é©—è­‰**
   - éæ“¬åˆæª¢æ¸¬
   - æ»¾å‹•è¦–çª—é©—è­‰
   - åƒæ•¸æ•æ„Ÿæ€§åˆ†æ
   - **Kelly å…¬å¼é©—è­‰** â­ NEW
   - **Live/Backtest ä¸€è‡´æ€§é©—è­‰** â­ NEW
   - **Pre-Deploy ä¸€è‡´æ€§æª¢æŸ¥** â­ NEWï¼ˆä¸Šæ¶å‰å¿…è·‘ï¼‰
   - **Alpha Decay ç›£æ§**ï¼ˆRolling IC + å¹´åº¦ IC è¡°é€€åµæ¸¬ + Telegram è­¦å ±ï¼‰â­ v3.1

6. **é¢¨éšªç®¡ç†**
   - å€‰ä½ç®¡ç†
   - é¢¨éšªé™åˆ¶
   - çµ„åˆé¢¨éšªç®¡ç†
   - **Kelly å€‰ä½è¨ˆç®—** â­ NEW
   - **æ³¢å‹•ç‡ç›®æ¨™å€‰ä½**ï¼ˆç›®æ¨™å¹´åŒ–æ³¢å‹•ç‡ï¼Œè‡ªå‹•èª¿æ•´æŒå€‰å¤§å°ï¼‰â­ v3.1

7. **å³æ™‚äº¤æ˜“** â­ NEW
   - Paper Tradingï¼ˆæ¨¡æ“¬äº¤æ˜“ï¼‰
   - Real Tradingï¼ˆçœŸå¯¦äº¤æ˜“ï¼‰
   - **BaseRunner åŸºé¡**ï¼ˆ14 å€‹å…±äº«å®‰å…¨æ©Ÿåˆ¶ï¼ŒLiveRunner + WebSocketRunner çµ±ä¸€ç¹¼æ‰¿ï¼‰â­ v3.2
   - **SignalResult dataclass**ï¼ˆå‹åˆ¥å®‰å…¨ä¿¡è™Ÿå‚³éï¼Œå–ä»£ raw dictï¼‰â­ v3.2
   - **è‡ªå‹• SL/TP æ›å–®**ï¼ˆæ¨™æº– API + Algo Order è‡ªå‹•é™ç´šï¼‰â­ NEW
   - **Adaptive SL**ï¼ˆEfficiency Ratio å‹•æ…‹èª¿æ•´æ­¢æå¯¬åº¦ï¼‰â­ v3.2
   - **SL/TP å»é‡ + æŒä¹…åŒ–å¿«å–**ï¼ˆé˜²æ­¢é‡è¤‡æ›å–®ï¼‰â­ NEW
   - **SL/TP è‡ªå‹•è£œæ›**ï¼ˆreconciliationï¼‰â­ NEW
   - **SL/TP è§¸ç™¼å†·å»æ©Ÿåˆ¶**ï¼ˆcooldownï¼‰â­ NEW
   - **å¤šå¹£ç¨®å€‰ä½åˆ†é…** + é˜²éœ‡ç›ªæ©Ÿåˆ¶ â­ NEW
   - **å¢é‡ K ç·šå¿«å–**ï¼ˆè§£æ±ºå¯¦ç›¤ vs å›æ¸¬æ•¸æ“šä¸ä¸€è‡´ï¼‰â­ v2.8
   - **æ–¹å‘åˆ‡æ›ç¢ºèªæ©Ÿåˆ¶**ï¼ˆå¯é¸ 2-tick ç¢ºèªï¼‰â­ v2.8
   - **æ”¯æ´ç¾è²¨ ğŸŸ¢ å’Œåˆç´„ ğŸ”´** â­ NEW
   - **Maker å„ªå…ˆä¸‹å–®**ï¼ˆçœä¸€åŠæ‰‹çºŒè²»ï¼š0.04% â†’ 0.02%ï¼‰â­ v3.0
   - **WebSocket äº‹ä»¶é©…å‹•**ï¼ˆå»¶é² <1 ç§’ï¼ŒOracle Cloud 1GB RAM å¯è·‘ï¼‰â­ v3.0
   - **SQLite äº¤æ˜“è³‡æ–™åº«**ï¼ˆçµæ§‹åŒ–äº¤æ˜“ç´€éŒ„ + CLI æŸ¥è©¢ï¼‰â­ v3.0

8. **Telegram Bot äº’å‹•** â­ NEW
   - **å‘½ä»¤é¸å–®æç¤º**ï¼ˆè¼¸å…¥ `/` ç›´æ¥é¸ï¼‰â­ NEW
   - å¸³æˆ¶ç‹€æ…‹ã€æŒå€‰ã€äº¤æ˜“è¨˜éŒ„æŸ¥è©¢
   - **SL/TP æ‘˜è¦ + é ä¼°ç›ˆè™§**ï¼ˆ`/status`ï¼‰â­ NEW
   - å³æ™‚ä¿¡è™Ÿç”Ÿæˆï¼ˆ`/signals`ï¼‰+ **ä¿¡è™Ÿå¿«å–**ï¼ˆèˆ‡ cron ä¿¡è™Ÿä¸€è‡´ï¼‰â­ v2.8
   - ä»Šæ—¥ç›ˆè™§æ˜ç´°ï¼ˆ`/pnl`ï¼‰â­ NEW
   - äº¤æ˜“çµ±è¨ˆï¼ˆ`/stats`ï¼‰â­ NEW

9. **ç›£æ§èˆ‡ç¶­é‹** â­ NEW
   - ç³»çµ±å¥åº·æª¢æŸ¥
   - æ¯æ—¥ç¸¾æ•ˆå ±è¡¨
   - å¿ƒè·³ç›£æ§
   - **é›²ç«¯éƒ¨ç½²æ•™å­¸**ï¼ˆOracle Cloudï¼‰â­ NEW

---

## ç¬¬ä¸€æ­¥ï¼šç­–ç•¥ç™¼æƒ³

### ä»€éº¼æ˜¯äº¤æ˜“ç­–ç•¥ï¼Ÿ

äº¤æ˜“ç­–ç•¥å°±æ˜¯ä¸€å¥—è¦å‰‡ï¼Œå‘Šè¨´ä½ åœ¨ä»€éº¼æ™‚å€™è²·å…¥ã€ä»€éº¼æ™‚å€™è³£å‡ºã€‚

### å¸¸è¦‹çš„ç­–ç•¥æ€è·¯

#### 1. è¶¨å‹¢è·Ÿè¹¤ç­–ç•¥
**æ€è·¯**ï¼šè·Ÿéš¨å¸‚å ´è¶¨å‹¢ï¼Œä¸Šæ¼²æ™‚è²·å…¥ï¼Œä¸‹è·Œæ™‚è³£å‡º
- **ç¯„ä¾‹**ï¼šç§»å‹•å¹³å‡ç·šäº¤å‰ç­–ç•¥
  - ç•¶çŸ­æœŸå‡ç·šä¸Šç©¿é•·æœŸå‡ç·š â†’ è²·å…¥è¨Šè™Ÿ
  - ç•¶çŸ­æœŸå‡ç·šä¸‹ç©¿é•·æœŸå‡ç·š â†’ è³£å‡ºè¨Šè™Ÿ

#### 2. å‡å€¼å›æ­¸ç­–ç•¥
**æ€è·¯**ï¼šåƒ¹æ ¼åé›¢å‡å€¼å¾Œæœƒå›æ­¸
- **ç¯„ä¾‹**ï¼šRSI è¶…è²·è¶…è³£ç­–ç•¥
  - RSI < 30ï¼ˆè¶…è³£ï¼‰â†’ è²·å…¥
  - RSI > 70ï¼ˆè¶…è²·ï¼‰â†’ è³£å‡º

#### 3. çªç ´ç­–ç•¥
**æ€è·¯**ï¼šåƒ¹æ ¼çªç ´é—œéµä½ç½®æ™‚å…¥å ´
- **ç¯„ä¾‹**ï¼šå¸ƒæ—å¸¶çªç ´
  - åƒ¹æ ¼çªç ´ä¸Šè»Œ â†’ è²·å…¥
  - åƒ¹æ ¼è·Œç ´ä¸‹è»Œ â†’ è³£å‡º

### ç­–ç•¥ç™¼æƒ³æ­¥é©Ÿ

1. **è§€å¯Ÿå¸‚å ´**ï¼šçœ‹çœ‹åƒ¹æ ¼èµ°å‹¢æœ‰ä»€éº¼è¦å¾‹
2. **å½¢æˆå‡è¨­**ï¼šæ¯”å¦‚ã€ŒRSI ä½æ–¼ 30 æ™‚ï¼Œåƒ¹æ ¼å¯èƒ½æœƒåå½ˆã€
3. **è¨­è¨ˆè¦å‰‡**ï¼šæŠŠå‡è¨­è½‰åŒ–ç‚ºå…·é«”çš„è²·è³£è¦å‰‡
4. **æ¸¬è©¦é©—è­‰**ï¼šç”¨æ­·å²è³‡æ–™å›æ¸¬ï¼Œçœ‹æ˜¯å¦æœ‰æ•ˆ

### ç¯„ä¾‹ï¼šæˆ‘å€‘è¦é–‹ç™¼çš„ç­–ç•¥

**ç­–ç•¥åç¨±**ï¼šRSI è¶…è²·è¶…è³£ç­–ç•¥

**ç­–ç•¥æ€è·¯**ï¼š
- RSIï¼ˆç›¸å°å¼·å¼±æŒ‡æ¨™ï¼‰è¡¡é‡åƒ¹æ ¼å‹•é‡
- RSI < 30ï¼šå¸‚å ´è¶…è³£ï¼Œå¯èƒ½åå½ˆ â†’ è²·å…¥
- RSI > 70ï¼šå¸‚å ´è¶…è²·ï¼Œå¯èƒ½å›èª¿ â†’ è³£å‡º

**å…·é«”è¦å‰‡**ï¼š
1. è¨ˆç®— RSIï¼ˆé€±æœŸ 14ï¼‰
2. ç•¶ RSI < 30 æ™‚ï¼Œè²·å…¥ï¼ˆæŒå€‰ 100%ï¼‰
3. ç•¶ RSI > 70 æ™‚ï¼Œè³£å‡ºï¼ˆæŒå€‰ 0%ï¼‰
4. å…¶ä»–æƒ…æ³ä¿æŒç•¶å‰æŒå€‰

---

## ç¬¬äºŒæ­¥ï¼šå»ºç«‹ç­–ç•¥

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç¯„æœ¬ç”¢ç”Ÿå™¨ï¼ˆæ¨è–¦æ–°æ‰‹ï¼‰

å°ˆæ¡ˆæä¾›äº†ç­–ç•¥ç¯„æœ¬ç”¢ç”Ÿå™¨ï¼Œå¯ä»¥å¿«é€Ÿå»ºç«‹ç­–ç•¥æª”æ¡ˆï¼š

```bash
# å»ºç«‹ RSI ç­–ç•¥
python scripts/create_strategy.py --name my_rsi_strategy --type rsi
```

é€™æœƒè‡ªå‹•å»ºç«‹ç­–ç•¥æª”æ¡ˆï¼Œä½ åªéœ€è¦ä¿®æ”¹åƒæ•¸å³å¯ã€‚

### æ–¹æ³•äºŒï¼šæ‰‹å‹•å»ºç«‹ç­–ç•¥

#### 2.1 å»ºç«‹ç­–ç•¥æª”æ¡ˆ

åœ¨ `src/qtrade/strategy/` ç›®éŒ„ä¸‹å»ºç«‹æ–°æª”æ¡ˆï¼Œä¾‹å¦‚ `my_rsi_strategy.py`ï¼š

```python
"""
æˆ‘çš„ RSI ç­–ç•¥

ç­–ç•¥é‚è¼¯ï¼š
- RSI < 30ï¼šè²·å…¥
- RSI > 70ï¼šè³£å‡º
"""
from __future__ import annotations
import pandas as pd
from .base import StrategyContext
from . import register_strategy
from ..indicators import calculate_rsi


@register_strategy("my_rsi_strategy")
def generate_positions(df: pd.DataFrame, ctx: StrategyContext, params: dict) -> pd.Series:
    """
    ç”¢ç”ŸæŒå€‰è¨Šè™Ÿ
    
    Args:
        df: K ç·šè³‡æ–™ï¼ˆåŒ…å« open, high, low, close, volumeï¼‰
        ctx: ç­–ç•¥ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«äº¤æ˜“å°è³‡è¨Šï¼‰
        params: ç­–ç•¥åƒæ•¸
    
    Returns:
        æŒå€‰æ¯”ä¾‹åºåˆ— [0, 1]ï¼Œ0 è¡¨ç¤ºç©ºå€‰ï¼Œ1 è¡¨ç¤ºæ»¿å€‰
    """
    # 1. å–å¾—åƒæ•¸ï¼ˆå¦‚æœæ²’æœ‰æä¾›ï¼Œä½¿ç”¨é è¨­å€¼ï¼‰
    period = params.get("period", 14)      # RSI é€±æœŸï¼Œé è¨­ 14
    oversold = params.get("oversold", 30)   # è¶…è³£é–¾å€¼ï¼Œé è¨­ 30
    overbought = params.get("overbought", 70)  # è¶…è²·é–¾å€¼ï¼Œé è¨­ 70
    
    # 2. å–å¾—æ”¶ç›¤åƒ¹
    close = df["close"]
    
    # 3. è¨ˆç®— RSI
    rsi = calculate_rsi(close, period=period)
    
    # 4. ç”¢ç”Ÿè¨Šè™Ÿ
    # RSI < 30ï¼šè²·å…¥è¨Šè™Ÿï¼ˆæŒå€‰ = 1ï¼‰
    # RSI > 70ï¼šè³£å‡ºè¨Šè™Ÿï¼ˆæŒå€‰ = 0ï¼‰
    # å…¶ä»–æƒ…æ³ï¼šä¿æŒç•¶å‰ç‹€æ…‹ï¼ˆé€™è£¡ç°¡åŒ–è™•ç†ï¼Œå¯¦éš›å¯ä»¥ç”¨æ›´è¤‡é›œçš„é‚è¼¯ï¼‰
    
    pos = pd.Series(0.0, index=df.index)  # åˆå§‹åŒ–ç‚ºç©ºå€‰
    
    # è²·å…¥æ¢ä»¶
    buy_signal = rsi < oversold
    pos[buy_signal] = 1.0
    
    # è³£å‡ºæ¢ä»¶
    sell_signal = rsi > overbought
    pos[sell_signal] = 0.0
    
    # 5. é‡è¦ï¼šé¿å…æœªä¾†è³‡è¨Šæ´©æ¼
    # åœ¨ t æ™‚åˆ»çš„è¨Šè™Ÿï¼Œæ‡‰è©²åœ¨ t+1 æ™‚åˆ»åŸ·è¡Œ
    pos = pos.shift(1).fillna(0.0)
    
    return pos
```

#### 2.2 è¨»å†Šç­–ç•¥

åœ¨ `src/qtrade/strategy/__init__.py` ä¸­åŒ¯å…¥ä½ çš„ç­–ç•¥ï¼š

```python
from . import my_rsi_strategy  # noqa: E402
```

#### 2.3 è¨­å®šç­–ç•¥åƒæ•¸

åœ¨ `config/base.yaml` ä¸­è¨­å®šç­–ç•¥ï¼š

```yaml
strategy:
  name: "my_rsi_strategy"  # ç­–ç•¥åç¨±ï¼ˆå¿…é ˆèˆ‡ @register_strategy ä¸­çš„åç¨±ä¸€è‡´ï¼‰
  params:
    period: 14        # RSI é€±æœŸ
    oversold: 30      # è¶…è³£é–¾å€¼
    overbought: 70    # è¶…è²·é–¾å€¼
```

### ç­–ç•¥é–‹ç™¼è¦é»

1. **é¿å…æœªä¾†è³‡è¨Šæ´©æ¼**ï¼šå¿…é ˆä½¿ç”¨ `shift(1)` å°‡è¨Šè™Ÿå‘å¾Œç§»å‹•
2. **å›å‚³å€¼**ï¼šæŒå€‰æ¯”ä¾‹å¿…é ˆåœ¨ [0, 1] ç¯„åœå…§
3. **ä½¿ç”¨æŒ‡æ¨™åº«**ï¼šä¸è¦é‡è¤‡å¯¦ä½œæŒ‡æ¨™ï¼Œä½¿ç”¨ `qtrade.indicators` ä¸­çš„å‡½å¼

---

## ç¬¬ä¸‰æ­¥ï¼šå›æ¸¬ç­–ç•¥

### 3.1 æº–å‚™è³‡æ–™

é¦–å…ˆéœ€è¦ä¸‹è¼‰æ­·å²è³‡æ–™ï¼š

```bash
# ä¸‹è¼‰ BTCUSDT çš„ 1 å°æ™‚ K ç·šè³‡æ–™
python scripts/download_data.py --symbol BTCUSDT --interval 1h --start 2022-01-01
```

### 3.2 è¨­å®šç­–ç•¥ï¼ˆé‡è¦ï¼ï¼‰

**åœ¨åŸ·è¡Œå›æ¸¬ä¹‹å‰ï¼Œå¿…é ˆå…ˆè¨­å®šè¦ä½¿ç”¨çš„ç­–ç•¥ã€‚**

ç·¨è¼¯ `config/base.yaml` æª”æ¡ˆï¼š

```yaml
strategy:
  name: "my_rsi_strategy"  # é€™è£¡æŒ‡å®šè¦ä½¿ç”¨çš„ç­–ç•¥åç¨±
  params:
    period: 14
    oversold: 30
    overbought: 70
```

**é‡è¦èªªæ˜**ï¼š
- `strategy.name` å¿…é ˆèˆ‡ä½ åœ¨ç¨‹å¼ç¢¼ä¸­ `@register_strategy("ç­–ç•¥åç¨±")` çš„åç¨±ä¸€è‡´
- `strategy.params` æ˜¯ç­–ç•¥çš„åƒæ•¸ï¼Œä¸åŒç­–ç•¥éœ€è¦çš„åƒæ•¸ä¸åŒ
- ä¿®æ”¹è¨­å®šå¾Œï¼Œç›´æ¥åŸ·è¡Œå›æ¸¬å³å¯ï¼Œç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼

### 3.3 åŸ·è¡Œå›æ¸¬

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è¨­å®šæª”ï¼ˆæ¨è–¦æ–°æ‰‹ï¼‰

```bash
# åŸ·è¡Œå›æ¸¬ï¼ˆæœƒè‡ªå‹•è®€å– config/base.yaml ä¸­çš„ç­–ç•¥è¨­å®šï¼‰
python scripts/run_backtest.py
```

#### æ–¹æ³•äºŒï¼šä½¿ç”¨å‘½ä»¤åˆ—åƒæ•¸ï¼ˆæ¨è–¦é€²éšç”¨æˆ¶ï¼‰

```bash
# ç›´æ¥æŒ‡å®šç­–ç•¥ï¼ˆè¦†è“‹è¨­å®šæª”ä¸­çš„ç­–ç•¥ï¼‰
python scripts/run_backtest.py -s my_rsi_strategy

# æŒ‡å®šè¨­å®šæª”
python scripts/run_backtest.py -c config/my_rsi.yaml

# åªå›æ¸¬æŒ‡å®šäº¤æ˜“å°
python scripts/run_backtest.py -s my_rsi_strategy --symbol BTCUSDT
```

**å›æ¸¬è…³æœ¬æœƒ**ï¼š
1. è®€å–è¨­å®šæª”ï¼ˆæˆ–ä½¿ç”¨å‘½ä»¤åˆ—åƒæ•¸ï¼‰
2. æ‰¾åˆ°å°æ‡‰çš„ç­–ç•¥å‡½å¼
3. ä½¿ç”¨è¨­å®šçš„åƒæ•¸åŸ·è¡Œå›æ¸¬
4. ç”¢ç”Ÿå ±å‘Šå’Œåœ–è¡¨

**è¼¸å‡ºç›®éŒ„çµ„ç¹”**ï¼š

å ±å‘Šæœƒè‡ªå‹•æŒ‰ **å¸‚å ´é¡å‹ â†’ ç­–ç•¥åç¨± â†’ åŸ·è¡Œé¡å‹ â†’ æ™‚é–“æˆ³** åˆ†é¡ï¼š

```
reports/
â”œâ”€â”€ spot/                          â† ç¾è²¨
â”‚   â””â”€â”€ rsi_adx_atr/              â† ç­–ç•¥åç¨±
â”‚       â”œâ”€â”€ backtest/             â† å›æ¸¬çµæœ
â”‚       â”‚   â””â”€â”€ 20260213_114901/  â† æ™‚é–“æˆ³
â”‚       â”œâ”€â”€ portfolio/            â† çµ„åˆå›æ¸¬
â”‚       â”œâ”€â”€ validation/           â† é©—è­‰å ±å‘Š
â”‚       â””â”€â”€ live/                 â† Paper/Real ç‹€æ…‹
â”‚
â””â”€â”€ futures/                       â† åˆç´„
    â””â”€â”€ rsi_adx_atr/
        â”œâ”€â”€ backtest/
        â”œâ”€â”€ portfolio/
        â”œâ”€â”€ validation/
        â””â”€â”€ live/
```

è·¯å¾‘è¦å‰‡ï¼š`reports/{market_type}/{strategy}/{run_type}/{timestamp}/`

> ğŸ’¡ **ä¸ç”¨æ‰‹å‹•è¨­å®šè·¯å¾‘**ï¼ç³»çµ±æœƒè‡ªå‹•å¾ config çš„ `market_type` å’Œ `strategy.name` çµ„åˆå‡ºæ­£ç¢ºçš„ç›®éŒ„ã€‚YAML è£¡çš„ `output.report_dir` åªéœ€è¦è¨­æˆ `"./reports"`ï¼ˆæˆ–å®Œå…¨ä¸å¯«ï¼Œé è¨­å°±æ˜¯ï¼‰ã€‚

### 3.4 æŸ¥çœ‹çµæœ

å›æ¸¬å®Œæˆå¾Œï¼Œæœƒåœ¨ `reports/{market_type}/{strategy}/backtest/{timestamp}/` ç›®éŒ„ç”¢ç”Ÿï¼š

1. **çµ±è¨ˆå ±å‘Š** (`stats_BTCUSDT.csv`)
   - ç¸½æ”¶ç›Šç‡
   - æœ€å¤§å›æ’¤
   - å¤æ™®æ¯”ç‡
   - å‹ç‡
   - ç¸½äº¤æ˜“æ¬¡æ•¸

2. **è³‡é‡‘æ›²ç·šåœ–** (`equity_curve_BTCUSDT.png`)
   - åƒ¹æ ¼èµ°å‹¢
   - è²·è³£è¨Šè™Ÿ
   - è³‡é‡‘æ›²ç·š
   - å›æ’¤åœ–

### 3.5 ç†è§£å›æ¸¬çµæœ

#### é—œéµæŒ‡æ¨™èªªæ˜

- **ç¸½æ”¶ç›Šç‡ (Total Return)**ï¼šç­–ç•¥çš„ç¸½æ”¶ç›Šç™¾åˆ†æ¯”
  - æ­£æ•¸ = ç›ˆåˆ©
  - è² æ•¸ = è™§æ

- **æœ€å¤§å›æ’¤ (Max Drawdown)**ï¼šå¾æœ€é«˜é»åˆ°æœ€ä½é»çš„æœ€å¤§è·Œå¹…
  - è¶Šå°è¶Šå¥½
  - è¶…é 50% é€šå¸¸é¢¨éšªè¼ƒå¤§

- **å¤æ™®æ¯”ç‡ (Sharpe Ratio)**ï¼šé¢¨éšªèª¿æ•´å¾Œçš„æ”¶ç›Š
  - > 1.0ï¼šä¸éŒ¯
  - > 2.0ï¼šå¾ˆå¥½
  - < 0ï¼šç­–ç•¥è¡¨ç¾å·®

- **å‹ç‡ (Win Rate)**ï¼šç›ˆåˆ©äº¤æ˜“ä½”ç¸½äº¤æ˜“çš„æ¯”ä¾‹
  - é€šå¸¸ 50% ä»¥ä¸Šè¼ƒå¥½

- **ç¸½äº¤æ˜“æ¬¡æ•¸ (Total Trades)**ï¼šäº¤æ˜“é »ç‡
  - å¤ªå°‘ï¼šå¯èƒ½éŒ¯éæ©Ÿæœƒ
  - å¤ªå¤šï¼šæ‰‹çºŒè²»æˆæœ¬é«˜

### 3.6 åˆ†æè³‡é‡‘æ›²ç·š

æŸ¥çœ‹ `equity_curve_BTCUSDT.png`ï¼š

1. **åƒ¹æ ¼å’Œè¨Šè™Ÿåœ–**ï¼š
   - ç¶ é»ï¼šè²·å…¥è¨Šè™Ÿ
   - ç´…é»ï¼šè³£å‡ºè¨Šè™Ÿ
   - æª¢æŸ¥è¨Šè™Ÿæ˜¯å¦åˆç†

2. **è³‡é‡‘æ›²ç·šåœ–**ï¼š
   - æ˜¯å¦ç©©å®šä¸Šå‡ï¼Ÿ
   - æ˜¯å¦æœ‰å¤§å¹…å›æ’¤ï¼Ÿ
   - æ˜¯å¦é•·æœŸè™§æï¼Ÿ

3. **å›æ’¤åœ–**ï¼š
   - å›æ’¤æ˜¯å¦åœ¨å¯æ¥å—ç¯„åœå…§ï¼Ÿ

---

## ç¬¬å››æ­¥ï¼šå„ªåŒ–åƒæ•¸

å¦‚æœå›æ¸¬çµæœä¸ç†æƒ³ï¼Œå¯ä»¥å˜—è©¦å„ªåŒ–åƒæ•¸ã€‚

### 4.1 æ‰‹å‹•æ¸¬è©¦ä¸åŒåƒæ•¸

ä¿®æ”¹ `config/base.yaml`ï¼š

```yaml
strategy:
  name: "my_rsi_strategy"
  params:
    period: 14        # è©¦è©¦ 10, 14, 20
    oversold: 30      # è©¦è©¦ 25, 30, 35
    overbought: 70    # è©¦è©¦ 65, 70, 75
```

ç„¶å¾Œé‡æ–°åŸ·è¡Œå›æ¸¬ï¼Œæ¯”è¼ƒçµæœã€‚

### 4.2 ä½¿ç”¨è‡ªå‹•å„ªåŒ–å·¥å…·ï¼ˆæ¨è–¦ï¼‰

å°ˆæ¡ˆæä¾›äº†åƒæ•¸å„ªåŒ–å·¥å…·ï¼Œå¯ä»¥è‡ªå‹•æ¸¬è©¦å¤šå€‹åƒæ•¸çµ„åˆï¼š

```bash
# å„ªåŒ– RSI ç­–ç•¥åƒæ•¸
python scripts/optimize_params.py --strategy my_rsi_strategy --metric "Sharpe Ratio"
```

é€™æœƒï¼š
1. æ¸¬è©¦æ‰€æœ‰åƒæ•¸çµ„åˆ
2. æ‰¾åˆ°è¡¨ç¾æœ€å¥½çš„åƒæ•¸
3. ç”¢ç”Ÿå„ªåŒ–å ±å‘Š

### 4.3 ç¶œåˆå›æ¸¬å·¥å…· â­ NEW

ä½¿ç”¨ `comprehensive_backtest.py` å¯ä»¥ä¸€æ¬¡æ¸¬è©¦å¤šå€‹ç¶­åº¦ï¼š

```bash
# å®Œæ•´æ¸¬è©¦ï¼ˆå¸‚å ´éšæ®µ + å€‰ä½ç®¡ç† + å‡ºå ´ç­–ç•¥ + ç­–ç•¥åƒæ•¸ï¼‰
python scripts/comprehensive_backtest.py --symbol BTCUSDT

# åªæ¸¬è©¦ç‰¹å®šç¶­åº¦
python scripts/comprehensive_backtest.py --symbol BTCUSDT --test position_sizing exit_strategy

# Futures æ¨¡å¼
python scripts/comprehensive_backtest.py --symbol BTCUSDT --market-type futures
```

**æ¸¬è©¦ç¶­åº¦**ï¼š
| ç¶­åº¦ | æ¸¬è©¦é …ç›® |
|------|---------|
| market_regime | ç‰›å¸‚ã€ç†Šå¸‚ã€éœ‡ç›ªå¸‚ã€é«˜/ä½æ³¢å‹• |
| position_sizing | å›ºå®šå€‰ä½ã€Kelly å…¬å¼ï¼ˆå…¨/åŠ/å››åˆ†ä¹‹ä¸€ï¼‰ |
| exit_strategy | ATR SL/TPã€Trailing Stopã€RSI Exit |
| strategy_params | é è¨­ã€ç©æ¥µã€ä¿å®ˆ |

### 4.4 å„ªåŒ–æŒ‡æ¨™é¸æ“‡

å¯ä»¥é¸æ“‡ä¸åŒçš„å„ªåŒ–æŒ‡æ¨™ï¼š

- `Total Return [%]`ï¼šç¸½æ”¶ç›Šç‡
- `Sharpe Ratio`ï¼šå¤æ™®æ¯”ç‡ï¼ˆæ¨è–¦ï¼‰
- `Max Drawdown [%]`ï¼šæœ€å¤§å›æ’¤ï¼ˆè¶Šå°è¶Šå¥½ï¼‰

```bash
# å„ªåŒ–å¤æ™®æ¯”ç‡
python scripts/optimize_params.py --strategy my_rsi_strategy --metric "Sharpe Ratio"

# å„ªåŒ–ç¸½æ”¶ç›Šç‡
python scripts/optimize_params.py --strategy my_rsi_strategy --metric "Total Return [%]"
```

### 4.4 æŸ¥çœ‹å„ªåŒ–çµæœ

å„ªåŒ–å®Œæˆå¾Œï¼Œæœƒç”¢ç”Ÿ `reports/{market_type}/{strategy}/optimize/optimization_BTCUSDT.csv`ï¼ŒåŒ…å«ï¼š
- æ‰€æœ‰åƒæ•¸çµ„åˆ
- å°æ‡‰çš„è¡¨ç¾æŒ‡æ¨™
- æœ€ä½³åƒæ•¸çµ„åˆ

### âš ï¸ é¿å…éåº¦å„ªåŒ–

**é‡è¦**ï¼šä¸è¦éåº¦å„ªåŒ–åƒæ•¸ï¼

- éåº¦å„ªåŒ–æœƒå°è‡´éæ“¬åˆ
- åœ¨æ­·å²è³‡æ–™ä¸Šè¡¨ç¾å¥½ï¼Œä¸ä»£è¡¨æœªä¾†ä¹Ÿæœƒå¥½
- æ‡‰è©²é¸æ“‡åœ¨å¤šå€‹æ™‚é–“è¦–çª—éƒ½è¡¨ç¾ç©©å®šçš„åƒæ•¸

---

## ç¬¬äº”æ­¥ï¼šé©—è­‰ç­–ç•¥

åœ¨å¯¦ç›¤å‰ï¼Œå¿…é ˆé©—è­‰ç­–ç•¥æ˜¯å¦éæ“¬åˆã€‚

### 5.1 çµ±ä¸€é©—è­‰å…¥å£

æ‰€æœ‰é©—è­‰åŠŸèƒ½å·²æ•´åˆåˆ° `validate.py`ï¼Œ**è·‘å®Œæœƒç›´æ¥åœ¨çµ‚ç«¯ç”¨ç™½è©±å‘Šè¨´ä½ æ¯é …çµæœ**ï¼Œä¸ç”¨è‡ªå·±çœ‹æ•¸å­—æŸ¥æ¨™æº–ï¼š

```bash
# åŸ·è¡Œæ¨™æº–é©—è­‰å¥—ä»¶ï¼ˆWalk-Forward + Monte Carlo + Cross-Asset + Kellyï¼‰
# â­ æ¨è–¦ï¼šæ–°æ‰‹ç›´æ¥è·‘é€™å€‹ï¼Œä¸ç”¨åŠ ä»»ä½•åƒæ•¸
python scripts/validate.py -c config/rsi_adx_atr_rsi_exit.yaml

# å¿«é€Ÿé©—è­‰ï¼ˆè·³éè€—æ™‚æ¸¬è©¦ï¼‰
python scripts/validate.py -c config/rsi_adx_atr_rsi_exit.yaml --quick

# å®Œæ•´é©—è­‰ï¼ˆåŒ…æ‹¬ä¸€è‡´æ€§æª¢æŸ¥ï¼‰
python scripts/validate.py -c config/rsi_adx_atr_rsi_exit.yaml --full

# åªåŸ·è¡Œç‰¹å®šé©—è­‰
python scripts/validate.py -c config/rsi_adx_atr_rsi_exit.yaml --only walk_forward
python scripts/validate.py -c config/rsi_adx_atr_rsi_exit.yaml --only walk_forward,monte_carlo
```

> ğŸ’¡ **ä¸ç”¨èƒŒæŒ‡æ¨™**ï¼è·‘å®Œä¹‹å¾Œçµ‚ç«¯æœƒè‡ªå‹•é¡¯ç¤ºæ¯é …æ¸¬è©¦çš„ã€Œç™½è©±ç¿»è­¯ + æ¨™æº– + åˆ¤æ–·ã€ï¼ŒYAML å ±å‘Šè£¡ä¹Ÿæœ‰ `meaning` æ¬„ä½è§£é‡‹ã€‚è©³è¦‹ [Â§5.6 ç†è§£é©—è­‰çµæœ](#56-ç†è§£é©—è­‰çµæœ)ã€‚

**å¯ç”¨çš„é©—è­‰é¡å‹**ï¼š

| é©—è­‰é¡å‹ | ç”¨é€”ï¼ˆç™½è©±ï¼‰ | å¤§ç´„è€—æ™‚ |
|----------|-------------|---------|
| `walk_forward` | ç­–ç•¥åœ¨æ–°æ•¸æ“šä¸Šé‚„è¡Œå—ï¼Ÿ | ~30s |
| `monte_carlo` | æœ€å£æƒ…æ³æœƒè™§å¤šå°‘ï¼Ÿ | ~10s |
| `loao` | å»æ‰ä¸€å€‹å¹£é‚„è¡Œå—ï¼Ÿ | ~20s |
| `regime` | é«˜/ä½æ³¢å‹•å¸‚å ´éƒ½è¡Œå—ï¼Ÿ | ~10s |
| `dsr` | Sharpe æ˜¯çœŸçš„é‚„æ˜¯ç¢°å·§ï¼Ÿ | ~5s |
| `pbo` | éæ“¬åˆæ©Ÿç‡å¤šé«˜ï¼Ÿ | ~5s |
| `kelly` | æ¯æ¬¡è©²æŠ•å¤šå°‘ï¼Ÿ | ~15s |
| `consistency` | å¯¦ç›¤è·Ÿå›æ¸¬ä¸€è‡´å—ï¼Ÿ | ~30s |

### 5.2 Walk-Forward Analysis

æ»¾å‹•è¦–çª—é©—è­‰æœƒè‡ªå‹•åŸ·è¡Œï¼Œå°‡è³‡æ–™åˆ†æˆå¤šå€‹è¨“ç·´/æ¸¬è©¦è¦–çª—ï¼š
- åœ¨è¨“ç·´é›†ä¸Šå„ªåŒ–åƒæ•¸
- åœ¨æ¸¬è©¦é›†ä¸Šé©—è­‰è¡¨ç¾

**å¦‚ä½•åˆ¤æ–·éæ“¬åˆ**ï¼š
- âœ… æ¸¬è©¦é›†è¡¨ç¾æ¥è¿‘è¨“ç·´é›† â†’ ç­–ç•¥ç©©å®š
- âŒ æ¸¬è©¦é›†è¡¨ç¾é å·®æ–¼è¨“ç·´é›† â†’ å¯èƒ½éæ“¬åˆ

### 5.3 Kelly å…¬å¼é©—è­‰

é©—è­‰ç­–ç•¥æ˜¯å¦é©åˆä½¿ç”¨ Kelly å€‰ä½ç®¡ç†ï¼š

```bash
# åªåŸ·è¡Œ Kelly é©—è­‰
python scripts/validate.py -c config/rsi_adx_atr.yaml --only kelly
```

**é©—è­‰å…§å®¹**ï¼š
- æª¢æŸ¥çµ±è¨ˆç©©å®šæ€§ï¼ˆå‹ç‡ã€ç›ˆè™§æ¯”æ˜¯å¦ç©©å®šï¼‰
- æ¯”è¼ƒä¸åŒ Kelly fraction çš„å›æ¸¬è¡¨ç¾
- çµ¦å‡ºæ˜¯å¦ä½¿ç”¨ Kelly çš„å»ºè­°

**ç¯„ä¾‹è¼¸å‡º**ï¼š
```
======================================================================
  ğŸ’° Kelly Formula Validation
======================================================================

  BTCUSDT:
    å‹ç‡: 55.2% (120/217)
    ç›ˆè™§æ¯”: 1.45
    Full Kelly: 12.3%
    ç©©å®šæ€§ (CV): 0.35
    æ¨è–¦å€‰ä½: 25% Kelly
    åŸå› : Calmar ratio æœ€å„ª (2.15)
    âœ… æ¨è–¦ä½¿ç”¨ 25% Kelly = 3.1% å€‰ä½
```

### 5.4 Live/Backtest ä¸€è‡´æ€§é©—è­‰

é©—è­‰å³æ™‚äº¤æ˜“è¨Šè™Ÿèˆ‡å›æ¸¬æ˜¯å¦ä¸€è‡´ï¼ˆæª¢æ¸¬ look-ahead biasï¼‰ï¼š

```bash
# åŸ·è¡Œä¸€è‡´æ€§é©—è­‰ï¼ˆéœ€è¦å…ˆé‹è¡Œ Paper Trading ä¸€æ®µæ™‚é–“ï¼‰
python scripts/validate.py -c config/rsi_adx_atr.yaml --only consistency

# å®Œæ•´é©—è­‰ï¼ˆåŒ…å«ä¸€è‡´æ€§ï¼‰
python scripts/validate.py -c config/rsi_adx_atr.yaml --full
```

**å»ºè­°æ’ç¨‹ï¼ˆcronï¼‰**ï¼š
```bash
# æ¯é€±æ—¥ 00:00 åŸ·è¡Œä¸€è‡´æ€§é©—è­‰
0 0 * * 0 cd /path/to/quant-binance-spot && python scripts/validate.py -c config/rsi_adx_atr.yaml --only consistency
```

### 5.5 â­ Pre-Deploy ä¸€è‡´æ€§æª¢æŸ¥ï¼ˆä¸Šæ¶å‰å¿…è·‘ï¼‰

**æ¯æ¬¡éƒ¨ç½²ç­–ç•¥åˆ°å¯¦ç›¤ä¹‹å‰ï¼Œå‹™å¿…è·‘é€™å€‹è…³æœ¬ï¼** å®ƒæœƒè‡ªå‹•æ¯”å°å›æ¸¬å’Œå¯¦ç›¤çš„æ‰€æœ‰è·¯å¾‘ï¼Œ13 é …å…¨éæ‰æ”¾å¿ƒä¸Šç·šã€‚

```bash
# æ¨™æº–æª¢æŸ¥ï¼ˆå»ºè­°æ¯æ¬¡éƒ¨ç½²å‰å¿…è·‘ï¼‰
python scripts/validate_live_consistency.py -c config/futures_rsi_adx_atr.yaml

# è©³ç´°æ¨¡å¼ï¼ˆé¡¯ç¤ºæ¯å€‹é …ç›®çš„ç´°ç¯€ï¼‰
python scripts/validate_live_consistency.py -c config/futures_rsi_adx_atr.yaml -v

# åªæª¢æŸ¥ç‰¹å®šé …ç›®
python scripts/validate_live_consistency.py -c config/futures_rsi_adx_atr.yaml --only signal,sltp
```

**æª¢æŸ¥æ¸…å–®ï¼ˆ13 é …ï¼‰**ï¼š

| # | æª¢æŸ¥é … | èªªæ˜ |
|---|--------|------|
| 1 | `config_passthrough` | YAML â†’ backtest_dict â†’ live åƒæ•¸å‚³ééˆå®Œæ•´ |
| 2 | `strategy_context` | StrategyContext (market_type, direction) ä¸€è‡´ |
| 3 | `strategy_function` | å›æ¸¬å’Œå¯¦ç›¤ä½¿ç”¨åŒä¸€å€‹ç­–ç•¥å‡½æ•¸ |
| 4 | `signal_consistency` | ç›¸åŒæ•¸æ“šç”¢ç”Ÿç›¸åŒä¿¡è™Ÿ |
| 5 | `signal_clip` | ä¿¡è™Ÿ clip é‚è¼¯ä¸€è‡´ï¼ˆspot [0,1] / futures [-1,1]ï¼‰|
| 6 | `entry_price` | close[N-1] vs open[N] å·®è· < 0.5% |
| 7 | `sltp_formula` | SL/TP æ–¹å‘å…¬å¼æ­£ç¢ºï¼ˆå¤šå€‰ SL åœ¨ä¸‹æ–¹ç­‰ï¼‰|
| 8 | `sltp_price_base` | SL/TP åŸºæº–åƒ¹å…§éƒ¨ä¸€è‡´ |
| 9 | `position_sizing` | å€‰ä½è¨ˆç®—éˆè·¯æ­£ç¢º |
| 10 | `fee_match` | æ‰‹çºŒè²»è¨­å®š = äº¤æ˜“æ‰€è²»ç‡ |
| 11 | `date_filter` | start/end æ—¥æœŸæ­£ç¢ºå¥—ç”¨ |
| 12 | `cooldown` | å†·å»æœŸè¨­å®šä¸€è‡´ |
| 13 | `funding_rate_warning` | åˆç´„è³‡é‡‘è²»ç‡æœªå»ºæ¨¡æé†’ |

**çµæœè§£è®€**ï¼š
- âœ… `PASS` â€” å®Œå…¨ä¸€è‡´
- âš ï¸ `WARN` â€” å¯æ¥å—å·®ç•°ï¼ˆéœ€äº†è§£å½±éŸ¿ï¼‰
- ğŸ”´ `FAIL` â€” ä¸ä¸€è‡´ï¼Œå¿…é ˆä¿®å¾©å¾Œæ‰èƒ½ä¸Šç·š

**ç¯„ä¾‹è¼¸å‡º**ï¼š
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“‹ å›æ¸¬â†”å¯¦ç›¤ä¸€è‡´æ€§æª¢æŸ¥å ±å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ… [PASS] config_passthrough    YAML â†’ backtest_dict() éˆè·¯å®Œæ•´
  âœ… [PASS] strategy_context      market=futures, dir=both
  âœ… [PASS] signal_consistency    æœ€å¾Œä¿¡è™Ÿä¸€è‡´: 0.00
  âœ… [PASS] fee_match             fee=4bps = Binance Taker
  âš ï¸  [WARN] funding_rate_warning  Futures 5x â€” å›æ¸¬ä¸è¨ˆå…¥ funding
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  çµæœ: 12 PASS / 1 WARN / 0 FAIL (å…± 13 é …)
  âš ï¸  æœ‰è­¦å‘Šé …ç›®ï¼Œå»ºè­°äº†è§£å¾Œå†éƒ¨ç½²ã€‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**å¯ç”¨çš„ `--only` åˆ†çµ„**ï¼š
| åˆ†çµ„ | åŒ…å«é …ç›® |
|------|----------|
| `params` | config_passthrough, strategy_context |
| `strategy` | strategy_function |
| `signal` | signal_consistency, signal_clip |
| `entry` | entry_price |
| `sltp` | sltp_formula, sltp_price_base |
| `sizing` | position_sizing |
| `fee` | fee_match |
| `date` | date_filter |
| `cooldown` | cooldown |
| `funding` | funding_rate_warning |

### 5.6 ç†è§£é©—è­‰çµæœ

#### çµ‚ç«¯è¼¸å‡º

è·‘å®Œé©—è­‰å¾Œï¼Œçµ‚ç«¯æœƒç›´æ¥é¡¯ç¤º**ç™½è©±ç¸½çµ**ï¼Œå‘Šè¨´ä½ æ¯é …æ¸¬è©¦åšäº†ä»€éº¼ã€æ•¸å€¼å¤šå°‘ã€æ¨™æº–æ˜¯ä»€éº¼ï¼š

```
========================================================================
  ğŸ“‹ Validation Summary â€” ç­–ç•¥é©—è­‰ç¸½çµ
========================================================================

  æ¯é …æ¸¬è©¦æª¢æŸ¥ç­–ç•¥çš„ä¸åŒé¢å‘ï¼Œå¹«åŠ©ä½ åˆ¤æ–·ç­–ç•¥æ˜¯å¦å¯ä»¥ä¸Šç·šã€‚
  âœ… PASS = é€šé   âš ï¸ CHECK = éœ€æ³¨æ„   âŒ FAIL = ä¸å»ºè­°ä¸Šç·š

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ… PASS  Walk-Forwardï¼ˆå‰ç»é©—è­‰ï¼‰
         æ¸¬è©¦æ–¹æ³•: ç”¨æ­·å²è¨“ç·´ â†’ åœ¨æ–°æ•¸æ“šä¸Šé©—è­‰ï¼Œæ¨¡æ“¬çœŸå¯¦ä½¿ç”¨å ´æ™¯
         ç¸¾æ•ˆè¡°é€€: -9.3%ï¼ˆæ¨™æº–: < 50% ç‚ºä½³ï¼‰
           BTCUSDT: è¨“ç·´ SR=3.79 â†’ æ¸¬è©¦ SR=4.20 (è¡°é€€ -10.7%)
           ETHUSDT: è¨“ç·´ SR=4.95 â†’ æ¸¬è©¦ SR=5.35 (è¡°é€€ -7.9%)

  âœ… PASS  Monte Carloï¼ˆå£“åŠ›æ¸¬è©¦ï¼‰
         æ¸¬è©¦æ–¹æ³•: éš¨æ©Ÿæ¨¡æ“¬ 10000 ç¨®å¸‚å ´æƒ…å¢ƒï¼Œçœ‹æœ€å·®æƒ…æ³è™§å¤šå°‘
         å¹³å‡ VaR 95%: 0.62%ï¼ˆæ„æ€ï¼š95% çš„æƒ…æ³ä¸‹å–®æ—¥è™§æ < æ­¤å€¼ï¼‰

  âœ… PASS  DSRï¼ˆæ ¡æ­£ Sharpe Ratioï¼‰
         æ¸¬è©¦æ–¹æ³•: æŠŠå›æ¸¬è£¡ã€Œèª¿äº†å¾ˆå¤šåƒæ•¸ã€çš„å› ç´ æ‰£é™¤ï¼Œçœ‹ Sharpe æ˜¯å¦ä»é¡¯è‘—
         æ ¡æ­£ SR: 4.77, p-value: 0.0000ï¼ˆæ¨™æº–: p < 0.05ï¼‰

  âœ… PASS  PBOï¼ˆéæ“¬åˆæ©Ÿç‡ï¼‰
         æ¸¬è©¦æ–¹æ³•: ç”¨æ’åˆ—çµ„åˆè¨ˆç®—ã€Œå›æ¸¬å¥½ä½†å¯¦ç›¤å·®ã€çš„æ©Ÿç‡
         éæ“¬åˆæ©Ÿç‡: 30.0%ï¼ˆæ¨™æº–: < 50%ï¼‰

  âœ… PASS  Kellyï¼ˆæœ€ä½³å€‰ä½é©—è­‰ï¼‰
         æ¸¬è©¦æ–¹æ³•: ç”¨æ­·å²å‹ç‡+ç›ˆè™§æ¯”ç®—æœ€ä½³å€‰ä½ï¼Œä¸¦æª¢æŸ¥ç©©å®šæ€§
           BTCUSDT: å‹ç‡=54.1%, ç›ˆè™§æ¯”=1.55, å»ºè­°=25% Kelly = 6.1%
           ETHUSDT: å‹ç‡=56.0%, ç›ˆè™§æ¯”=1.89, å»ºè­°=25% Kelly = 8.2%

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ğŸ‰ Overall: âœ… ç­–ç•¥é©—è­‰é€šé â€” å¯ä»¥è€ƒæ…®ä¸Šç·šï¼

  ğŸ’¡ æç¤ºï¼šé©—è­‰é€šéâ‰ ä¿è­‰è³ºéŒ¢ï¼Œåªæ˜¯è¡¨ç¤ºç­–ç•¥åœ¨çµ±è¨ˆä¸Šæœ‰åˆç†æ€§ã€‚
           å¯¦ç›¤æœƒå—æ»‘åƒ¹ã€funding rateã€æµå‹•æ€§ç­‰å› ç´ å½±éŸ¿ã€‚
========================================================================
```

> ğŸ’¡ ä¸éœ€è¦è¨˜ä½æ¯å€‹æŒ‡æ¨™çš„æ„æ€ï¼Œçµ‚ç«¯è¼¸å‡ºå·²ç¶“å¹«ä½ å¯«å¥½äº†ã€‚

#### YAML å ±å‘Š

å ±å‘Šæœƒä¿å­˜åœ¨ `reports/{market_type}/{strategy}/validation/{timestamp}/validation_summary.yaml`ã€‚

**æ–°ç‰ˆ YAML æ¯å€‹é …ç›®éƒ½é™„æœ‰ `threshold`ï¼ˆåˆ¤æ–·æ¨™æº–ï¼‰å’Œ `meaning`ï¼ˆç™½è©±è§£é‡‹ï¼‰**ï¼Œæ‰“é–‹å°±çœ‹å¾—æ‡‚ï¼š

```yaml
timestamp: '2026-02-13T12:01:49'
tests:
  walk_forward:
    passed: true
    avg_degradation: -9.3%
    threshold: < 50%               # â† åˆ¤æ–·æ¨™æº–
    meaning: è¨“ç·´æœŸâ†’æ¸¬è©¦æœŸçš„ç¸¾æ•ˆè¡°é€€å¹…åº¦ï¼Œè¶Šä½ä»£è¡¨ç­–ç•¥è¶Šç©©å¥
    per_symbol:
      BTCUSDT:
        train_sharpe: 3.79
        test_sharpe: 4.20
        degradation: -10.7%
        splits_completed: 5        # â† 5 æŠ˜å…¨éƒ¨æˆåŠŸ
      ETHUSDT:
        train_sharpe: 4.95
        test_sharpe: 5.35
        degradation: -7.9%
        splits_completed: 5

  monte_carlo:
    passed: true
    avg_var_95: 0.62%
    threshold: æ—¥ VaR 95% < 30%
    meaning: æ¨¡æ“¬ 10000 æ¬¡éš¨æ©Ÿæƒ…å¢ƒï¼Œä¼°è¨ˆæœ€å·®æƒ…æ³çš„å–®æ—¥è™§æ

  dsr:
    passed: true
    deflated_sharpe: 4.77
    p_value: 0.0
    threshold: p-value < 0.05 (çµ±è¨ˆé¡¯è‘—)
    meaning: è€ƒæ…®äº†ã€è©¦äº†å¾ˆå¤šåƒæ•¸æ‰æ‰¾åˆ°é€™å€‹çµæœã€çš„æƒ…æ³å¾Œï¼ŒSharpe æ˜¯å¦ä»ç„¶é¡¯è‘—ï¼Ÿ

  pbo:
    passed: true
    pbo_pct: 30.0%
    threshold: PBO < 50%
    meaning: ç”¨äº¤å‰é©—è­‰ä¼°è¨ˆç­–ç•¥æ˜¯ã€çœŸçš„å¥½ã€é‚„æ˜¯ã€ç¢°å·§å¥½ã€çš„æ©Ÿç‡

  kelly:
    passed: true
    suitable_assets: 2/2
    threshold: æ‰€æœ‰å¹£ç¨®éƒ½é©åˆä½¿ç”¨ Kelly
    meaning: æ ¹æ“šæ­·å²å‹ç‡å’Œç›ˆè™§æ¯”ï¼Œè¨ˆç®—æœ€ä½³å€‰ä½å¤§å°ä¸¦æª¢é©—å…¶ç©©å®šæ€§
    per_symbol:
      BTCUSDT: { win_rate: 54.1%, win_loss_ratio: 1.55, recommended: '25% Kelly = 6.1%' }
      ETHUSDT: { win_rate: 56.0%, win_loss_ratio: 1.89, recommended: '25% Kelly = 8.2%' }

overall_passed: true
```

#### ç”¢å‡ºçš„å ±å‘Šæ–‡ä»¶

```
reports/{market_type}/{strategy}/validation/{timestamp}/
â”œâ”€â”€ validation_summary.yaml   # ç¸½çµï¼ˆä¸Šé¢çš„ YAMLï¼‰
â”œâ”€â”€ walk_forward_BTCUSDT.csv  # Walk-Forward æ¯æŠ˜è©³ç´°æ•¸æ“š
â”œâ”€â”€ walk_forward_ETHUSDT.csv
â”œâ”€â”€ regime_results.csv        # é«˜/ä½æ³¢å‹•å¸‚å ´è¡¨ç¾æ¯”è¼ƒ
â”œâ”€â”€ kelly_BTCUSDT.txt         # Kelly è©³ç´°åˆ†æå ±å‘Š
â”œâ”€â”€ kelly_ETHUSDT.txt
â””â”€â”€ kelly_summary.csv         # Kelly å€‰ä½å»ºè­°å½™ç¸½
```

#### å¿«é€Ÿåˆ¤æ–·è¡¨

| æ¸¬è©¦é …ç›® | åœ¨çœ‹ä»€éº¼ï¼Ÿ | âœ… å¥½ | âŒ å·® |
|----------|-----------|-------|-------|
| Walk-Forward | ç­–ç•¥åœ¨æ–°æ•¸æ“šä¸Šé‚„è¡Œå—ï¼Ÿ | è¡°é€€ < 30% | è¡°é€€ > 50% |
| Monte Carlo | æœ€å£æƒ…æ³è™§å¤šå°‘ï¼Ÿ | VaR 95% åˆç† | VaR æ¥µç«¯ |
| DSR | Sharpe æ˜¯çœŸçš„å—ï¼Ÿ | p-value < 0.05 | p > 0.05 |
| PBO | æ˜¯ä¸æ˜¯ç¢°å·§èª¿å‡ºä¾†çš„ï¼Ÿ | PBO < 50% | PBO > 50% |
| Kelly | æ¯æ¬¡è©²ä¸‹å¤šå¤§æ³¨ï¼Ÿ | é©åˆ + ç©©å®š | ä¸é©åˆ |

#### PBOï¼ˆéæ“¬åˆæ©Ÿç‡ï¼‰ç™½è©±è§£é‡‹

PBO è¡¡é‡ã€Œè¨“ç·´è¡¨ç¾æœ€å¥½çš„ç­–ç•¥åœ¨æ¸¬è©¦æ™‚è¡¨ç¾å·®ã€çš„æ©Ÿç‡ï¼š

```
ç°¡å–®æ¯”å–»ï¼š
ä½ è€ƒäº† 20 æ¬¡æ¨¡æ“¬è€ƒï¼ˆ= 20 çµ„åƒæ•¸ï¼‰ï¼Œé¸äº†åˆ†æ•¸æœ€é«˜çš„å»è€ƒçœŸçš„ã€‚
PBO å°±æ˜¯åœ¨å•ï¼šã€Œæ¨¡æ“¬è€ƒç¬¬ä¸€åï¼ŒçœŸæ­£è€ƒè©¦æœƒä¸æœƒè€ƒç ¸ï¼Ÿã€

PBO = 30% â†’ åªæœ‰ 30% çš„æ©Ÿæœƒè€ƒç ¸ï¼Œç­–ç•¥è »ç©©çš„
PBO = 70% â†’ 70% çš„æ©Ÿæœƒè€ƒç ¸ï¼Œå¾ˆå¯èƒ½æ˜¯é‹æ°£å¥½
```

**PBO é«˜ä½†ç­–ç•¥ä»å¯ç”¨çš„æƒ…æ³**ï¼š
- æ‰€æœ‰ Test Sharpe éƒ½ > 0ï¼ˆä»ç„¶ç›ˆåˆ©ï¼‰
- Walk-Forward è¡°é€€ < 30%
- Paper Trading è¡¨ç¾èˆ‡å›æ¸¬ä¸€è‡´

#### å¦‚æœé©—è­‰æ²’éæ€éº¼è¾¦ï¼Ÿ

1. **ç°¡åŒ–ç­–ç•¥** â€” åƒæ•¸è¶Šå°‘ï¼Œè¶Šä¸å®¹æ˜“éæ“¬åˆ
2. **æ¸›å°‘åƒæ•¸æ•¸é‡** â€” åªç•™æœ€é—œéµçš„ 3-5 å€‹
3. **ä½¿ç”¨æ›´ä¿å®ˆçš„åƒæ•¸** â€” ä¸è¦è¿½æ±‚æœ€é«˜å›æ¸¬ç¸¾æ•ˆ
4. **å¢åŠ æ­·å²è³‡æ–™** â€” æ•¸æ“šè¶Šé•·ï¼Œçµ±è¨ˆè¶Šå¯é 
5. **å…ˆè·‘ Paper Trading** â€” ç”¨çœŸå¯¦å¸‚å ´é©—è­‰ 2 é€±ä»¥ä¸Š

---

## ç¬¬å…­æ­¥ï¼šé¢¨éšªç®¡ç†

åœ¨å¯¦ç›¤å‰ï¼Œæ‡‰è©²æ–°å¢é¢¨éšªç®¡ç†ã€‚

### 6.1 è³‡æ–™å“è³ªæª¢æŸ¥

å°ˆæ¡ˆæœƒè‡ªå‹•æª¢æŸ¥è³‡æ–™å“è³ªï¼Œä½†ä½ å¯ä»¥æ‰‹å‹•é©—è­‰ï¼š

```python
from qtrade.data import validate_data_quality

report = validate_data_quality(df)
if not report.is_valid:
    print("è³‡æ–™æœ‰å•é¡Œï¼Œéœ€è¦æ¸…æ´—")
```

### 6.2 è¨­å®šé¢¨éšªé™åˆ¶

åœ¨ `config/base.yaml` ä¸­è¨­å®šï¼š

```yaml
risk:
  max_position_pct: 1.0      # æœ€å¤§å€‰ä½ 100%
  max_drawdown_pct: 0.5     # æœ€å¤§å›æ’¤é™åˆ¶ 50%
  max_leverage: 1.0          # æœ€å¤§æ§“æ¡¿ï¼ˆç¾è²¨ç‚º 1.0ï¼‰
```

### 6.3 å€‰ä½ç®¡ç†

å¯ä»¥ä½¿ç”¨ä¸åŒçš„å€‰ä½ç®¡ç†æ–¹æ³•ï¼š

```python
from qtrade.risk import FixedPositionSizer, KellyPositionSizer

# å›ºå®šå€‰ä½ï¼ˆ80%ï¼‰
sizer = FixedPositionSizer(position_pct=0.8)

# Kelly å…¬å¼ï¼ˆæ›´ç§‘å­¸ï¼Œä½†éœ€è¦æ­·å²è³‡æ–™ï¼‰
sizer = KellyPositionSizer(
    win_rate=0.6,      # å‹ç‡ 60%
    avg_win=0.05,      # å¹³å‡ç›ˆåˆ© 5%
    avg_loss=0.03,     # å¹³å‡è™§æ 3%
    kelly_fraction=0.5  # ä½¿ç”¨ 50% Kellyï¼ˆä¿å®ˆï¼‰
)
```

### 6.4 Kelly å€‰ä½è¨­å®š â­ NEW

å¦‚æœ Kelly é©—è­‰é€šéï¼Œå¯ä»¥åœ¨è¨­å®šæª”ä¸­å•Ÿç”¨ï¼š

```yaml
position_sizing:
  method: "kelly"
  kelly_fraction: 0.25  # Quarter Kellyï¼ˆä¿å®ˆæ¨è–¦ï¼‰
  min_trades_for_kelly: 30  # è‡³å°‘ 30 ç­†äº¤æ˜“æ‰å•Ÿç”¨
```

**Kelly Fraction å»ºè­°**ï¼š
- `0.25`ï¼ˆQuarter Kellyï¼‰ï¼šæœ€ä¿å®ˆï¼Œæ¨è–¦æ–°æ‰‹
- `0.5`ï¼ˆHalf Kellyï¼‰ï¼šä¸­ç­‰é¢¨éšª
- `1.0`ï¼ˆFull Kellyï¼‰ï¼šæœ€æ¿€é€²ï¼Œä¸æ¨è–¦

è©³ç´°åƒæ•¸èªªæ˜è«‹åƒè€ƒ `config/futures_rsi_adx_atr.yaml` ä¸­çš„è¨»è§£ã€‚

---

## ç¬¬ä¸ƒæ­¥ï¼šå³æ™‚äº¤æ˜“ â­ NEW

é©—è­‰é€šéå¾Œï¼Œå¯ä»¥é–‹å§‹å³æ™‚äº¤æ˜“ã€‚

### 7.1 Paper Tradingï¼ˆæ¨¡æ“¬äº¤æ˜“ï¼‰

**æ¨è–¦å…ˆç”¨ Paper Trading è§€å¯Ÿç­–ç•¥è¡¨ç¾è‡³å°‘ 1-2 é€±**ã€‚

```bash
# å•Ÿå‹• Paper Tradingï¼ˆæ¨è–¦ä½¿ç”¨ç¶“é©—è­‰çš„ RSI Exit é…ç½®ï¼‰
python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --paper

# åªäº¤æ˜“ BTCUSDT
python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --paper --symbol BTCUSDT

# ç«‹å³åŸ·è¡Œä¸€æ¬¡ï¼ˆä¸ç­‰å¾… K ç·šæ”¶ç›¤ï¼‰
python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --paper --once

# æŸ¥çœ‹å¸³æˆ¶ç‹€æ…‹
python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --status
```

**Paper Trading ç‰¹é»**ï¼š
- ä¸éœ€è¦ API Key
- æ¨¡æ“¬å¸³æˆ¶ï¼Œä¸æœƒè™§çœŸéŒ¢
- ç‹€æ…‹å„²å­˜åœ¨ `reports/{market_type}/{strategy}/live/paper_state.json`

### 7.2 Telegram é€šçŸ¥è¨­å®š

åœ¨ `.env` ä¸­è¨­å®šä»¥ä¸‹è®Šæ•¸å³å¯è‡ªå‹•å•Ÿç”¨é€šçŸ¥ï¼š

```bash
TELEGRAM_BOT_TOKEN=123456:ABC-DEF
TELEGRAM_CHAT_ID=987654321
```

**å¦‚ä½•å–å¾—**ï¼š
1. åœ¨ Telegram æœå°‹ `@BotFather`ï¼Œå»ºç«‹æ–° Bot å–å¾— Token
2. æœå°‹ `@userinfobot`ï¼Œå–å¾—ä½ çš„ Chat ID

### 7.2.1 Telegram Command Bot â­ NEW

é™¤äº†è¢«å‹•é€šçŸ¥ï¼Œé‚„æ”¯æ´**äº’å‹•å¼æŒ‡ä»¤**æŸ¥è©¢å¸³æˆ¶ç‹€æ…‹ã€‚Bot å•Ÿå‹•æ™‚æœƒè‡ªå‹•å‘ Telegram è¨»å†Šå‘½ä»¤é¸å–®ï¼Œè¼¸å…¥ `/` å³å¯çœ‹åˆ°å‘½ä»¤æç¤ºç›´æ¥é»é¸ã€‚

#### å•Ÿå‹•æ–¹å¼

Telegram Bot æ˜¯ä¸€å€‹**å¸¸é§æœå‹™**ï¼Œèˆ‡ cron å®šæ™‚äº¤æ˜“æ­é…ä½¿ç”¨ï¼š
- **cron** è² è²¬æ¯å°æ™‚è·‘ä¸€æ¬¡äº¤æ˜“ï¼ˆ`run_live.py --once`ï¼‰
- **Telegram Bot** è² è²¬ 24/7 æ¥æ”¶ä½ çš„æŸ¥è©¢å‘½ä»¤

```bash
# å•Ÿå‹• Telegram Botï¼ˆéœ€è¦ Binance API Key æ‰èƒ½æŸ¥è©¢å¸³æˆ¶ï¼‰
python scripts/run_telegram_bot.py -c config/futures_rsi_adx_atr.yaml --real

# èƒŒæ™¯é‹è¡Œï¼ˆæ­£å¼ç’°å¢ƒï¼ŒSSH æ–·ç·šä¹Ÿä¸æœƒåœï¼‰
nohup python scripts/run_telegram_bot.py -c config/futures_rsi_adx_atr.yaml --real > logs/telegram_bot.log 2>&1 &

# ç´”æ¸¬è©¦ï¼ˆä¸é€£ Binanceï¼Œåªæ¸¬ /ping /helpï¼‰
python scripts/run_telegram_bot.py
```

> ğŸ’¡ **èªªæ˜**ï¼š`--real` ä¸ä»£è¡¨æœƒä¸‹å–®ã€‚Telegram Bot æ°¸é æ˜¯ **dry-run æ¨¡å¼**ï¼ˆåªæŸ¥è©¢ã€ä¸ä¸‹å–®ï¼‰ï¼Œ`--real` åªæ˜¯è®“å®ƒé€£æ¥ Binance API ä¾†è®€å–å¸³æˆ¶è³‡è¨Šã€‚

#### å¯ç”¨æŒ‡ä»¤

| æŒ‡ä»¤ | èªªæ˜ | éœ€è¦ Broker |
|------|------|:-----------:|
| `/help` | æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤ | âŒ |
| `/ping` | æ¸¬è©¦ Bot é€£ç·š | âŒ |
| `/status` | å¸³æˆ¶ç¸½è¦½ + æŒå€‰ + SL/TP æ‘˜è¦ | âœ… |
| `/balance` | æŸ¥çœ‹å¸³æˆ¶é¤˜é¡ | âœ… |
| `/positions` | ç•¶å‰æŒå€‰è©³ç´°è³‡è¨Šï¼ˆå« SL/TP åƒ¹æ ¼èˆ‡é ä¼°ç›ˆè™§ï¼‰| âœ… |
| `/trades` | æœ€è¿‘ 10 ç­†æˆäº¤è¨˜éŒ„ | âœ… |
| `/pnl` | ä»Šæ—¥ç›ˆè™§ï¼ˆå·²å¯¦ç¾ + è³‡é‡‘è²»ç‡ + æ‰‹çºŒè²»ï¼‰| âœ… |
| `/signals` | äº¤æ˜“ä¿¡è™Ÿï¼ˆå„ªå…ˆè®€ cron å¿«ç…§ï¼Œç¢ºä¿ä¸€è‡´ï¼‰| âœ… |
| `/stats` | äº¤æ˜“çµ±è¨ˆï¼ˆå‹ç‡ã€ç´¯ç© PnLï¼‰| âœ… |

#### æŒ‡ä»¤è¼¸å‡ºç¯„ä¾‹

**`/status`** â€” ä¸€çœ¼çœ‹æ¸…å¸³æˆ¶ç‹€æ…‹ï¼š
```
ğŸ’¼ å¸³æˆ¶ç‹€æ…‹
ğŸ’° ç¸½æ¬Šç›Š: $1,472.36
ğŸ’µ å¯ç”¨é¤˜é¡: $1,219.80
ğŸ“ˆ æœªå¯¦ç¾ç›ˆè™§: $+12.07

ğŸ“‹ æŒå€‰ (1)
ğŸŸ¢ ETHUSDT [SHORT] +12.03
   ğŸ›¡ï¸ SL: $2,050.00 (-$48.20)
   ğŸ¯ TP: $1,780.00 (+$45.60)
```

**`/pnl`** â€” ä»Šæ—¥ç›ˆè™§æ˜ç´°ï¼š
```
ğŸ“ˆ ä»Šæ—¥ç›ˆè™§ (02-12 UTC)
ğŸ’° ç¸½è¨ˆ: $+87.55
âœ… å·²å¯¦ç¾: $+89.96
ğŸ§‘â€ğŸ’¼ æœªå¯¦ç¾: $+0.00
ğŸ’¸ æ‰‹çºŒè²»: $-2.38
ğŸ”„ è³‡é‡‘è²»ç‡: $-0.02
```

**é€šçŸ¥å…§å®¹ç¯„ä¾‹**ï¼ˆè‡ªå‹•æ¨æ’­ï¼‰ï¼š
```
ğŸŸ¢ é–‹å€‰ BTCUSDT
æ–¹å‘: LONG
æ•¸é‡: 0.015 BTC
å…¥å ´åƒ¹: $67,500
æ­¢æ: $66,000 (-2.2%, -$22.50)
æ­¢ç›ˆ: $72,000 (+6.7%, +$67.50)
```

### 7.3 Real Tradingï¼ˆçœŸå¯¦äº¤æ˜“ï¼‰

âš ï¸ **è­¦å‘Šï¼šçœŸå¯¦äº¤æ˜“æœƒä½¿ç”¨çœŸé‡‘ç™½éŠ€ï¼Œè«‹è¬¹æ…æ“ä½œï¼**

**å‰ç½®æº–å‚™**ï¼š
1. åœ¨ Binance å»ºç«‹ API Key
2. è¨­å®šç’°å¢ƒè®Šæ•¸

```bash
# .env
BINANCE_API_KEY=your_api_key
BINANCE_API_SECRET=your_api_secret
```

**æª¢æŸ¥é€£ç·š**ï¼š
```bash
python scripts/run_live.py -c config/rsi_adx_atr.yaml --check
```

**Dry-run æ¸¬è©¦**ï¼ˆä¸ä¸‹å–®ï¼Œåªçœ‹è¨Šè™Ÿï¼‰ï¼š
```bash
python scripts/run_live.py -c config/rsi_adx_atr.yaml --real --dry-run --once
```

**çœŸå¯¦äº¤æ˜“**ï¼š
```bash
python scripts/run_live.py -c config/rsi_adx_atr.yaml --real --once
```

### 7.4 ä½¿ç”¨ Cron è‡ªå‹•åŸ·è¡Œ

```bash
# ç·¨è¼¯ crontab
crontab -e

# æ¯å°æ™‚ç¬¬ 5 åˆ†é˜åŸ·è¡Œï¼ˆé…åˆ 1h K ç·šï¼‰
# â­ å»ºè­°åœ¨ :05 è€Œé :00 åŸ·è¡Œï¼Œè®“ K ç·šæ•¸æ“šç©©å®š
5 * * * * cd /path/to/quant-binance-spot && python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --paper --once >> logs/live.log 2>&1

# æ¯ 4 å°æ™‚åŸ·è¡Œï¼ˆé…åˆ 4h K ç·šï¼‰
5 */4 * * * cd /path/to/quant-binance-spot && python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --paper --once >> logs/live.log 2>&1
```

**é‡è¦**ï¼š
- `--once`ï¼šåŸ·è¡Œä¸€æ¬¡å¾Œç«‹å³é€€å‡ºï¼Œ**cron å¿…é ˆåŠ é€™å€‹åƒæ•¸**
- ä¸åŠ  `--once` æœƒé€²å…¥ daemon æ¨¡å¼ï¼ŒæŒçºŒç­‰å¾…ä¸‹ä¸€æ ¹ K ç·š
- è¨­åœ¨ `:05` è€Œé `:00`ï¼šè®“ K ç·šæ•¸æ“šç©©å®šï¼Œé¿å…å‡ä¿¡è™Ÿ
- **v2.8**ï¼šå¦‚æœ `live.kline_cache: true`ï¼Œcron è‡ªå‹•ä½¿ç”¨å¢é‡å¿«å–ï¼ˆé¦–æ¬¡æœƒå»ºç«‹ç¨®å­ï¼Œå¾ŒçºŒåªæ‹‰å¢é‡ï¼‰

### 7.5 éƒ¨ç½²åˆ°é›²ç«¯ä¼ºæœå™¨ï¼ˆOracle Cloudï¼‰â­ NEW

å»ºè­°ä½¿ç”¨ Oracle Cloud å…è²»æ–¹æ¡ˆè·‘ Botï¼Œ24 å°æ™‚ä¸é–“æ–·ã€‚

#### 7.5.1 é¦–æ¬¡éƒ¨ç½²

```bash
# 1. SSH é€£é€²ä¼ºæœå™¨
ssh ubuntu@<ä½ çš„ Oracle Cloud IP>

# 2. å®‰è£ Python ç’°å¢ƒ
sudo apt update && sudo apt install -y python3.11 python3.11-venv git

# 3. æ‹‰å°ˆæ¡ˆ
git clone https://github.com/<ä½ çš„å¸³è™Ÿ>/quant-binance-spot.git
cd quant-binance-spot

# 4. å»ºç«‹è™›æ“¬ç’°å¢ƒä¸¦å®‰è£ä¾è³´
python3.11 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

# 5. è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env   # æˆ–æ‰‹å‹•å»ºç«‹
nano .env              # å¡«å…¥ API Keyã€Telegram Token ç­‰

# 6. ä¸‹è¼‰æ‰€æœ‰å¹£ç¨®çš„ K ç·š + Funding Rate
PYTHONPATH=src python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml
PYTHONPATH=src python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml --funding-rate

# 7. ç”¨ tmux å•Ÿå‹• WebSocket Runnerï¼ˆæ¨è–¦ï¼Œå«è‡ªå‹•é‡å•Ÿï¼‰
mkdir -p logs
tmux new -d -s trading 'while true; do
  cd ~/quant-binance-spot && source .venv/bin/activate && git pull &&
  PYTHONPATH=src python scripts/run_websocket.py -c config/futures_rsi_adx_atr.yaml --real;
  echo "âš ï¸ Runner é€€å‡ºï¼Œ10ç§’å¾Œè‡ªå‹•é‡å•Ÿ..."; sleep 10;
done'

# 8. è¨­å®š cronï¼ˆè¼”åŠ©ä»»å‹™ï¼Œä¸å«äº¤æ˜“ â€” äº¤æ˜“ç”± WebSocket è² è²¬ï¼‰
crontab -e
# è©³è¦‹ä¸‹æ–¹ cron è¨­å®šç¯„ä¾‹
```

#### 7.5.2 æ›´æ–°ä»£ç¢¼ & é‡å•Ÿ

ç•¶ä½ åœ¨æœ¬æ©Ÿæ”¹å®Œ code ä¸¦ `git push` å¾Œï¼Œåœ¨ä¼ºæœå™¨ä¸ŠåŸ·è¡Œï¼š

```bash
# SSH é€£é€²ä¼ºæœå™¨
ssh ubuntu@<ä½ çš„ Oracle Cloud IP>

# é€²å…¥å°ˆæ¡ˆ
cd ~/quant-binance-spot
source .venv/bin/activate

# æ‹‰æœ€æ–°ä»£ç¢¼
git pull

# â­ é—œéµï¼šæ¸…é™¤ Python å¿«å–ï¼ˆé¿å…èˆŠ .pyc å°è‡´æ–°åŠŸèƒ½ä¸ç”Ÿæ•ˆï¼‰
./scripts/setup_cron.sh --update
# æˆ–æ‰‹å‹•ï¼š
# find . -name "*.pyc" -delete && find . -name "__pycache__" -exec rm -rf {} +

# æ‰¾åˆ°èˆŠçš„ bot é€²ç¨‹ä¸¦åœæ‰
ps aux | grep run_telegram_bot
kill <PID>

# é‡æ–°å•Ÿå‹•
nohup python scripts/run_telegram_bot.py -c config/futures_rsi_adx_atr.yaml --real > logs/telegram_bot.log 2>&1 &

# ç¢ºèªæœ‰è·‘èµ·ä¾†
tail -f logs/telegram_bot.log
# çœ‹åˆ°ã€Œâœ… å·²è¨»å†Š X å€‹å‘½ä»¤åˆ° Telegram é¸å–®ã€å°±ä»£è¡¨æˆåŠŸ
# æŒ‰ Ctrl+C é€€å‡º tailï¼ˆbot ç¹¼çºŒåœ¨èƒŒæ™¯è·‘ï¼‰
```

> âš ï¸ **é‡è¦ï¼š`git pull` å¾Œå¿…é ˆæ¸…é™¤ `.pyc` å¿«å–ï¼** Python æœƒå„ªå…ˆè®€å–å·²ç·¨è­¯çš„ `.pyc` è€Œéæœ€æ–°çš„ `.py` åŸå§‹ç¢¼ã€‚å¦‚æœä¸æ¸…é™¤ï¼Œæ–°åŠŸèƒ½ï¼ˆå¦‚ `kline_cache`ï¼‰å¯èƒ½**å®Œå…¨ä¸ç”Ÿæ•ˆ**ï¼Œä¸”ä¸æœƒå ±éŒ¯ã€‚ç”¨ `./scripts/setup_cron.sh --update` ä¸€éµå®Œæˆã€‚

> ğŸ’¡ **å°æŠ€å·§**ï¼šcron äº¤æ˜“ä¸éœ€è¦é‡å•Ÿï¼Œ`git pull` + æ¸… `.pyc` å¾Œä¸‹ä¸€è¼ª cron è‡ªå‹•ç”¨æ–°ä»£ç¢¼ã€‚åªæœ‰ Telegram Bot å¸¸é§æœå‹™éœ€è¦æ‰‹å‹•é‡å•Ÿã€‚

> âš ï¸ **v2.8 æ³¨æ„**ï¼šK ç·šå¿«å–ï¼ˆ`kline_cache/`ï¼‰æœƒåœ¨ `git pull` å¾Œä¿ç•™ã€‚å¦‚æœä½ æ”¹äº†ç­–ç•¥é‚è¼¯ï¼Œå»ºè­°åˆªé™¤å¿«å–è®“å®ƒé‡æ–°å»ºç«‹ï¼š`rm -rf reports/futures/*/live/kline_cache/`

#### 7.5.3 æŸ¥çœ‹ Log

```bash
# æŸ¥çœ‹ Telegram Bot log
tail -100 logs/telegram_bot.log

# æŸ¥çœ‹äº¤æ˜“ logï¼ˆcron è¼¸å‡ºï¼‰
tail -100 logs/live.log

# å³æ™‚è¿½è¹¤
tail -f logs/telegram_bot.log
```

---

## ç¬¬å…«æ­¥ï¼šç›£æ§èˆ‡ç¶­é‹ â­ NEW

### 8.1 ç³»çµ±å¥åº·æª¢æŸ¥

```bash
# åŸ·è¡Œæª¢æŸ¥ä¸¦è¼¸å‡ºçµæœ
python scripts/health_check.py

# åªåœ¨ç•°å¸¸æ™‚ç™¼é€ Telegram é€šçŸ¥
python scripts/health_check.py --notify

# ç¸½æ˜¯ç™¼é€é€šçŸ¥ï¼ˆåŒ…æ‹¬æ­£å¸¸æ™‚ï¼‰
python scripts/health_check.py --notify --notify-on-ok

# æŒ‡å®šè¨­å®šæª”
python scripts/health_check.py --config config/rsi_adx_atr.yaml

# æª¢æŸ¥çœŸå¯¦äº¤æ˜“ç‹€æ…‹ï¼ˆè€Œé Paper Tradingï¼‰â­ NEW
python scripts/health_check.py --config config/rsi_adx_atr.yaml --real

# è¼¸å‡º JSON æ ¼å¼
python scripts/health_check.py --json
```

**æª¢æŸ¥é …ç›®**ï¼š
- ğŸ“ ç£ç¢Ÿç©ºé–“ä½¿ç”¨ç‡
- ğŸ’¾ è¨˜æ†¶é«”ä½¿ç”¨ç‡
- ğŸ“Š äº¤æ˜“ç‹€æ…‹æª”æ¡ˆæ˜¯å¦éæœŸï¼ˆPaper æˆ– Realï¼‰
- ğŸ”„ ç³»çµ±åŸ·è¡Œç‹€æ…‹

**å»ºè­° cron è¨­å®š**ï¼š
```bash
# æ¯ 30 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼Œç•°å¸¸æ™‚é€šçŸ¥
*/30 * * * * cd /path/to/quant-binance-spot && python scripts/health_check.py --notify >> logs/health.log 2>&1
```

### 8.2 æ¯æ—¥ç¸¾æ•ˆå ±è¡¨

```bash
# æ‰‹å‹•åŸ·è¡Œ
python scripts/daily_report.py -c config/rsi_adx_atr.yaml

# åªåˆ—å°ä¸ç™¼é€ Telegram
python scripts/daily_report.py -c config/rsi_adx_atr.yaml --print-only
```

**å ±è¡¨å…§å®¹**ï¼š
- ğŸ“Š å¸³æˆ¶æ¬Šç›Šã€æ”¶ç›Šç‡ã€æœ€å¤§å›æ’¤
- ğŸ“‹ ç•¶å‰æŒå€‰æ˜ç´°
- ğŸ“ˆ ä»Šæ—¥äº¤æ˜“è¨˜éŒ„
- ğŸ“‰ éå» 7 å¤©æ”¶ç›Šè¶¨å‹¢

**å»ºè­° cron è¨­å®š**ï¼š
```bash
# æ¯å¤© UTC 00:05 åŸ·è¡Œ
5 0 * * * cd /path/to/quant-binance-spot && python scripts/daily_report.py -c config/rsi_adx_atr.yaml >> logs/daily_report.log 2>&1
```

### 8.3 å®Œæ•´ç”Ÿç”¢ç’°å¢ƒè¨­å®šç¯„ä¾‹

ä¸€å°é›²ç«¯ä¼ºæœå™¨ä¸Šï¼Œä½ éœ€è¦è·‘é€™äº›æ±è¥¿ï¼š

| å…ƒä»¶ | åŸ·è¡Œæ–¹å¼ | èªªæ˜ |
|------|---------|------|
| **äº¤æ˜“å¼•æ“** | tmux å¸¸é§ | WebSocket Runnerï¼ˆå³æ™‚è§¸ç™¼ï¼Œå»¶é² <1sï¼Œç¹¼æ‰¿ BaseRunnerï¼‰ |
| **Telegram Bot** | WebSocket Runner å…§å»º | è‡ªå‹•å•Ÿç”¨ï¼Œä¸éœ€é¡å¤–å•Ÿå‹• |
| **è¼”åŠ©ä»»å‹™** | cron å®šæ™‚ | å ±è¡¨ã€å¥åº·æª¢æŸ¥ã€æ•¸æ“šæ›´æ–°ã€Alpha ç›£æ§ |

> ğŸ’¡ **æ¶æ§‹èªªæ˜**ï¼š`WebSocketRunner` å’Œ `LiveRunner`ï¼ˆPollingï¼‰éƒ½ç¹¼æ‰¿è‡ª `BaseRunner` åŸºé¡ï¼Œå…±äº« 14 å€‹å®‰å…¨æ©Ÿåˆ¶ï¼ˆç†”æ–·ã€Adaptive SLã€å€‰ä½è¨ˆç®—ã€é˜²éœ‡ç›ªç­‰ï¼‰ã€‚äº¤æ˜“ä¿¡è™Ÿä½¿ç”¨ `SignalResult` dataclass å‚³éï¼Œç¢ºä¿å‹åˆ¥å®‰å…¨ã€‚

#### äº¤æ˜“å¼•æ“ï¼ˆtmux WebSocketï¼Œå«è‡ªå‹•é‡å•Ÿï¼‰

```bash
# å•Ÿå‹•ï¼ˆæˆ–é‡å•Ÿï¼‰
tmux kill-session -t trading 2>/dev/null
tmux new -d -s trading 'while true; do
  cd ~/quant-binance-spot && source .venv/bin/activate && git pull &&
  PYTHONPATH=src python scripts/run_websocket.py -c config/futures_rsi_adx_atr.yaml --real;
  echo "âš ï¸ Runner é€€å‡ºï¼Œ10ç§’å¾Œè‡ªå‹•é‡å•Ÿ..."; sleep 10;
done'
```

#### Cron Jobs è¨­å®šï¼ˆè¼”åŠ©ä»»å‹™ï¼‰

```bash
# ç·¨è¼¯ crontab
crontab -e

# âš ï¸ äº¤æ˜“ç”± WebSocket Runner è² è²¬ï¼Œcron è£¡çš„ run_live.py è¦è¨»è§£æ‰ï¼

# === æ•¸æ“šæ›´æ–° ===
# æ¯ 8 å°æ™‚ä¸‹è¼‰ Funding Rate
10 */8 * * * cd ~/quant-binance-spot && source .venv/bin/activate && python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml --funding-rate >> logs/download_data.log 2>&1

# === ç›£æ§ ===
# æ¯ 30 åˆ†é˜å¥åº·æª¢æŸ¥
*/30 * * * * cd ~/quant-binance-spot && source .venv/bin/activate && python scripts/health_check.py -c config/futures_rsi_adx_atr.yaml --real --notify >> logs/health.log 2>&1

# === å ±è¡¨ ===
# æ¯å¤© 00:05 UTC ç™¼é€æ—¥å ±
5 0 * * * cd ~/quant-binance-spot && source .venv/bin/activate && python scripts/daily_report.py -c config/futures_rsi_adx_atr.yaml >> logs/daily_report.log 2>&1

# === é©—è­‰ ===
# æ¯é€±æ—¥ 01:00 UTC ä¸€è‡´æ€§é©—è­‰
0 1 * * 0 cd ~/quant-binance-spot && source .venv/bin/activate && python scripts/validate.py -c config/futures_rsi_adx_atr.yaml --quick >> logs/validation.log 2>&1

# === Alpha Decay ç›£æ§ ===
# æ¯é€±æ—¥ 01:00 UTC åŸ·è¡Œ IC åˆ†æ + Telegram é€šçŸ¥
0 1 * * 0 cd ~/quant-binance-spot && source .venv/bin/activate && bash scripts/cron_alpha_monitor.sh >> logs/alpha_monitor.log 2>&1

# === Log æ¸…ç† ===
# æ¯é€±ä¸€ 04:00ï¼Œä¿ç•™ 7 å¤©
0 4 * * 1 find ~/quant-binance-spot/logs -name "*.log" -mtime +7 -delete
```

#### Telegram Bot

WebSocket Runner å·²å…§å»º Telegram Botï¼Œä¸éœ€é¡å¤–å•Ÿå‹•ã€‚å¦‚éœ€ç¨ç«‹é‹è¡Œï¼ˆä¾‹å¦‚ cron æ¨¡å¼ä¸‹ï¼‰ï¼š

```bash
# ç¨ç«‹å•Ÿå‹•ï¼ˆåƒ…åœ¨ä¸ä½¿ç”¨ WebSocket Runner æ™‚éœ€è¦ï¼‰
cd ~/quant-binance-spot && source .venv/bin/activate
nohup python scripts/run_telegram_bot.py -c config/futures_rsi_adx_atr.yaml --real > logs/telegram_bot.log 2>&1 &

# ç¢ºèªå•Ÿå‹•æˆåŠŸ
sleep 3 && tail -5 logs/telegram_bot.log
```

**âš ï¸ å¸¸è¦‹éŒ¯èª¤**ï¼š
- âŒ cron å¿˜è¨˜åŠ  `--once`ï¼Œå°è‡´å¤šå€‹ daemon åŒæ™‚é‹è¡Œ
- âŒ cron è¨­åœ¨ `:00` æ•´é»ï¼ŒK ç·šæ•¸æ“šå¯èƒ½é‚„ä¸ç©©å®š
- âŒ cron å¿˜è¨˜ `source .venv/bin/activate`ï¼Œæ‰¾ä¸åˆ° Python å¥—ä»¶
- âŒ `git pull` å¾Œå¿˜è¨˜é‡å•Ÿ Telegram Botï¼ˆcron æœƒè‡ªå‹•ç”¨æ–°ä»£ç¢¼ï¼Œä½† Bot ä¸æœƒï¼‰
- âŒ `git pull` å¾Œæ²’æ¸… `.pyc` å¿«å–ï¼ˆæ–°åŠŸèƒ½å¯èƒ½ä¸ç”Ÿæ•ˆï¼Œè¦‹ [Q13](#q13-git-pull-å¾Œ-kline_cache-æ²’æœ‰ç”Ÿæ•ˆ-new)ï¼‰
- âŒ æ”¹äº†ç­–ç•¥é‚è¼¯å¾Œæ²’åˆª K ç·šå¿«å–ï¼ˆèˆŠå¿«å–çš„æ­·å²æ•¸æ“šå¯èƒ½èˆ‡æ–°é‚è¼¯ä¸åŒ¹é…ï¼‰

---

## åˆç´„äº¤æ˜“æ•™å­¸ â­ NEW

æœ¬å°ˆæ¡ˆæ”¯æ´ç¾è²¨ (Spot) å’Œåˆç´„ (Futures) äº¤æ˜“ï¼Œä½¿ç”¨ç›¸åŒçš„é–‹ç™¼æµç¨‹ã€‚

### ç¾è²¨ vs åˆç´„

| åŠŸèƒ½ | ç¾è²¨ ğŸŸ¢ | åˆç´„ ğŸ”´ |
|------|---------|---------|
| åšå¤š | âœ… | âœ… |
| åšç©º | âŒ | âœ… |
| æ§“æ¡¿ | 1x | 1x-125x |
| ä¿¡è™Ÿç¯„åœ | [0, 1] | [-1, 1] |
| é¢¨éšª | è¼ƒä½ | è¼ƒé«˜ |

### 10.1 é…ç½®åˆç´„ç­–ç•¥

å»ºç«‹åˆç´„ç­–ç•¥é…ç½®æª”ï¼ˆä¾‹å¦‚ `config/futures_rsi_adx_atr.yaml`ï¼‰ï¼š

```yaml
# åˆç´„ç­–ç•¥é…ç½®
market:
  symbols: ["ETHUSDT", "SOLUSDT"]  # åš´æ ¼å›æ¸¬ç¯©é¸å¾Œçš„é›™å¹£çµ„åˆ
  interval: "1h"
  start: "2022-01-01"
  end: null
  market_type: "futures"  # â­ é—œéµï¼šè¨­å®šç‚º futures

# åˆç´„å°ˆå±¬é…ç½®
futures:
  leverage: 5             # æ§“æ¡¿å€æ•¸ï¼ˆå»ºè­° 1-5 å€ï¼‰
  margin_type: "ISOLATED" # ISOLATEDï¼ˆé€å€‰ï¼‰æˆ– CROSSEDï¼ˆå…¨å€‰ï¼‰
  position_mode: "ONE_WAY" # ONE_WAYï¼ˆå–®å‘ï¼‰æˆ– HEDGEï¼ˆé›™å‘ï¼‰
  direction: "both"       # äº¤æ˜“æ–¹å‘: "both"=å¤šç©ºéƒ½åš

strategy:
  name: "rsi_adx_atr"
  params:
    rsi_mode: "dynamic"   # Dynamic RSIï¼ˆå°æŠ— Alpha Decayï¼‰
    rsi_period: 10
    oversold: 30           # RSI < 30 â†’ åšå¤š
    overbought: 80         # RSI > 80 â†’ åšç©ºï¼ˆåˆç´„å°ˆç”¨ï¼‰
    min_adx: 15            # åšå¤š ADX é–€æª»
    short_min_adx: 20      # åšç©º ADX é–€æª»ï¼ˆåŠ å¯†å¤šé ­åå·®ï¼Œæ›´åš´æ ¼ï¼‰
    adaptive_sl: true      # â­ è‡ªé©æ‡‰æ­¢æï¼ˆER å‹•æ…‹èª¿æ•´ SL å¯¬åº¦ï¼‰
    min_hold_bars: 2       # å…¥å ´å¾Œè‡³å°‘æŒå€‰ 2hï¼Œé˜²æ­¢ RSI éœ‡ç›ªå¿«é€²å¿«å‡º
    # ...å…¶ä»–åƒæ•¸

backtest:
  initial_cash: 10000
  fee_bps: 4              # åˆç´„æ‰‹çºŒè²»è¼ƒä½
  slippage_bps: 3
  trade_on: "next_open"
  funding_rate:
    enabled: true          # â­ å¿…é ˆé–‹å•Ÿï¼Œå¦å‰‡æœƒç”¢ç”Ÿã€Œå¿«æ¨‚è¡¨ã€
  slippage_model:
    enabled: true          # â­ Volume-based æ»‘é»æ¨¡å‹

# é¢¨æ§ï¼ˆåˆç´„å»ºè­°æ›´ä¿å®ˆï¼‰
risk:
  max_drawdown_pct: 0.65  # 65% ç†”æ–·ï¼ˆ5x æ§“æ¡¿å»ºè­°ï¼‰

# å€‰ä½è¨ˆç®—
position_sizing:
  method: "fixed"          # fixedï¼ˆÃ— allocation æ¬Šé‡ï¼‰

# å¤šå¹£ç¨®å€‰ä½åˆ†é…ï¼ˆåš´æ ¼å›æ¸¬ç¯©é¸å¾Œï¼‰
portfolio:
  cash_reserve: 0
  allocation:
    ETHUSDT: 1.00          # ETHï¼ˆåš´æ ¼ç‰ˆ Sharpe 0.65ï¼‰
    SOLUSDT: 1.00          # SOLï¼ˆåš´æ ¼ç‰ˆ Sharpe 1.30ï¼‰
    # ç¸½æ›éšª 200%ï¼Œ5x æ§“æ¡¿ä¸‹ä¿è­‰é‡‘ä½” 40%

# å¯¦ç›¤å°ˆå±¬é…ç½®
live:
  kline_cache: true           # å¢é‡ K ç·šå¿«å–ï¼ˆç­–ç•¥å¾ bar 0 è·‘åˆ°æœ€æ–°ï¼Œèˆ‡å›æ¸¬ä¸€è‡´ï¼‰
  flip_confirmation: false    # æ–¹å‘åˆ‡æ› 2-tick ç¢ºèªï¼ˆå¿«å–æ¨¡å¼ä¸‹ä¸éœ€è¦ï¼‰
  prefer_limit_order: true    # Maker å„ªå…ˆï¼ˆ0.02% vs 0.04%ï¼‰

# Telegram é€šçŸ¥ï¼ˆå¯èˆ‡ç¾è²¨ä½¿ç”¨ä¸åŒ Botï¼‰
notification:
  telegram_bot_token: ${FUTURES_TELEGRAM_BOT_TOKEN}
  telegram_chat_id: ${FUTURES_TELEGRAM_CHAT_ID}
  prefix: "ğŸ”´ [FUTURES]"
  enabled: true

output:
  report_dir: "./reports"   # è·¯å¾‘æœƒè‡ªå‹•çµ„åˆç‚º reports/futures/rsi_adx_atr/...
```

> ğŸ’¡ **`live` å€æ®µæ˜¯ v2.8 æ–°å¢çš„**ã€‚è©³è¦‹ [Â§11 å¢é‡ K ç·šå¿«å–](#å¢é‡-k-ç·šå¿«å–)ã€‚

### 10.2 ç­–ç•¥åšç©ºä¿¡è™Ÿ

ç­–ç•¥å¯ä»¥è¼¸å‡º [-1, 1] ç¯„åœçš„ä¿¡è™Ÿï¼š
- `1.0`ï¼šæ»¿å€‰åšå¤š
- `0.0`ï¼šç©ºå€‰
- `-1.0`ï¼šæ»¿å€‰åšç©º

```python
@register_strategy("my_futures_strategy")
def generate_positions(df: pd.DataFrame, ctx: StrategyContext, params: dict) -> pd.Series:
    rsi = calculate_rsi(df["close"], period=14)
    
    pos = pd.Series(0.0, index=df.index)
    
    # åšå¤šæ¢ä»¶
    pos[rsi < 30] = 1.0
    
    # åšç©ºæ¢ä»¶ï¼ˆåƒ…åˆç´„æœ‰æ•ˆï¼‰
    if ctx.supports_short:  # â­ æª¢æŸ¥æ˜¯å¦æ”¯æ´åšç©º
        pos[rsi > 70] = -1.0
    
    return pos.shift(1).fillna(0.0)
```

**æ³¨æ„**ï¼šç¾è²¨æ¨¡å¼ä¸‹ï¼Œè² æ•¸ä¿¡è™Ÿæœƒè‡ªå‹• clip åˆ° 0ï¼Œç­–ç•¥ç¨‹å¼ç¢¼ä¸éœ€è¦ç‰¹åˆ¥è™•ç†ã€‚

### 10.3 ä¸‹è¼‰åˆç´„è³‡æ–™

```bash
# ä¸‹è¼‰åˆç´„ K ç·šè³‡æ–™
python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml

# è³‡æ–™æœƒå„²å­˜åˆ° data/binance/futures/1h/
```

### 10.4 å›æ¸¬åˆç´„ç­–ç•¥

```bash
# åŸ·è¡Œåˆç´„å›æ¸¬ï¼ˆæ”¯æ´åšç©ºæ¨¡æ“¬ï¼‰
python scripts/run_backtest.py -c config/futures_rsi_adx_atr.yaml
```

### 10.5 Paper Tradingï¼ˆåˆç´„ï¼‰

```bash
# å•Ÿå‹•åˆç´„ Paper Trading
python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --paper --once

# æŸ¥çœ‹ç‹€æ…‹
python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --status
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
ğŸ”´ Paper Trading [FUTURES]
   æ§“æ¡¿: 3x

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  BTCUSDT: SHORT 50%, price=67404.28, RSI=75.5, ADX=34.48
  ETHUSDT: LONG 30%, price=1974.45, RSI=25.2, ADX=25.0

==================================================
  Paper Trading å¸³æˆ¶æ‘˜è¦ ğŸ”´ [FUTURES (3x)]
==================================================
  åˆå§‹è³‡é‡‘:   $10,000.00
  ç•¶å‰ç¾é‡‘:   $5,000.00
  ç¸½æ¬Šç›Š:     $10,500.00
  ç¸½æ”¶ç›Š:     +5.00%
  äº¤æ˜“ç­†æ•¸:   5
  BTCUSDT [SHORT]: 0.100000 @ 68000.00 (PnL: +$600.00 ğŸ“ˆ)
==================================================
```

### 10.6 æ¸¬è©¦åˆç´„åŠŸèƒ½

åŸ·è¡Œæ¸¬è©¦è…³æœ¬é©—è­‰åŠŸèƒ½ï¼š

```bash
# åŸ·è¡Œåˆç´„åŠŸèƒ½æ¸¬è©¦
python scripts/test_futures_manual.py
```

### 10.7 åˆç´„ Cron è¨­å®š

ç¾è²¨å’Œåˆç´„å¯ä»¥åŒæ™‚é‹è¡Œï¼Œäº’ä¸å¹²æ“¾ï¼š

```bash
# === ç¾è²¨ç­–ç•¥ï¼ˆPaper Tradingï¼‰===
5 * * * * cd /opt/qtrade && python scripts/run_live.py -c config/rsi_adx_atr.yaml --paper --once >> logs/spot_live.log 2>&1

# === åˆç´„ç­–ç•¥ï¼ˆReal Tradingï¼‰===
5 * * * * cd /opt/qtrade && python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --real --once >> logs/futures_live.log 2>&1
```

**æ³¨æ„**ï¼š
- è¨­åœ¨ `:05` è€Œé `:00`ï¼Œè®“ K ç·šæ•¸æ“šç©©å®š
- `--once` æ˜¯å¿…é ˆçš„ï¼Œå¦å‰‡æœƒé€²å…¥ daemon æ¨¡å¼
- ç¾è²¨ç”¨ `--paper`ï¼Œåˆç´„ç¢ºèªç©©å®šå¾Œç”¨ `--real`

### 10.8 è‡ªå‹•æ­¢ææ­¢ç›ˆ (SL/TP) â­ NEW

åˆç´„äº¤æ˜“æ”¯æ´**è‡ªå‹•æ›æ­¢ææ­¢ç›ˆå–®**ï¼Œä¸éœ€æ‰‹å‹•ç›£æ§ã€‚

#### å·¥ä½œåŸç†

```
é–‹å€‰ â†’ è‡ªå‹•è¨ˆç®— SL/TP åƒ¹æ ¼ï¼ˆåŸºæ–¼ ATRï¼‰
     â†’ é€é Binance Algo Order API æ›æ¢ä»¶å–®
     â†’ æ¯æ¬¡ cron åŸ·è¡Œæ™‚æª¢æŸ¥ä¸¦è£œæ›éºæ¼çš„å–®ï¼ˆreconciliationï¼‰
```

**æ¢ä»¶å–® API è‡ªå‹•é¸æ“‡**

Binance æœ‰å…©ç¨®æ¢ä»¶å–® APIï¼Œ**ç³»çµ±æœƒè‡ªå‹•é¸æ“‡å¯ç”¨çš„é‚£å€‹**ï¼Œä½ ä¸ç”¨ç®¡ï¼š

| API | ç«¯é» | èªªæ˜ |
|-----|------|------|
| æ¨™æº–æ¢ä»¶å–® | `POST /fapi/v1/order` | `STOP_MARKET`ã€`TAKE_PROFIT_MARKET`ï¼Œ**å„ªå…ˆä½¿ç”¨** |
| Algo Order | `POST /fapi/v1/algo/futures/newOrderVp` | ç•¶æ¨™æº– API å›å‚³ `-4120` æ™‚**è‡ªå‹•é™ç´š** |

> ğŸ’¡ **ç™½è©±**ï¼šæœ‰äº›äº¤æ˜“å°ï¼ˆå¦‚ ETHUSDTï¼‰åœ¨æŸäº›å¸³æˆ¶ä¸Šä¸æ”¯æ´æ¨™æº–æ¢ä»¶å–®ï¼ŒBinance æœƒå›å‚³ `-4120` éŒ¯èª¤ã€‚ç³»çµ±åµæ¸¬åˆ°å¾Œæœƒè‡ªå‹•æ”¹ç”¨ Algo Order APIï¼Œ**å…¨è‡ªå‹•ï¼Œä¸éœ€è¦ä»»ä½•è¨­å®š**ã€‚å¦‚æœä½ åœ¨ log ä¸­çœ‹åˆ° `-4120` éŒ¯èª¤ï¼Œä¸ç”¨æ“”å¿ƒã€‚

#### é…ç½®ç¯„ä¾‹

```yaml
strategy:
  params:
    stop_loss_atr: 1.5    # æ­¢æ = å…¥å ´åƒ¹ Â± 1.5Ã—ATR
    take_profit_atr: 4.0  # æ­¢ç›ˆ = å…¥å ´åƒ¹ Â± 4.0Ã—ATR
```

| æ–¹å‘ | æ­¢æ (SL) | æ­¢ç›ˆ (TP) |
|------|-----------|-----------|
| LONG | å…¥å ´åƒ¹ - 1.5Ã—ATR | å…¥å ´åƒ¹ + 4.0Ã—ATR |
| SHORT | å…¥å ´åƒ¹ + 1.5Ã—ATR | å…¥å ´åƒ¹ - 4.0Ã—ATR |

#### SL/TP è‡ªå‹•è£œæ›ï¼ˆReconciliationï¼‰

æ¯æ¬¡ cron åŸ·è¡Œæ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•æª¢æŸ¥ä¸¦ä¿®å¾© SL/TPï¼š

| ç‹€æ³ | ç³»çµ±è¡Œç‚º |
|------|---------|
| æœ‰æŒå€‰ä½†æ²’æœ‰ SL | è‡ªå‹•è£œæ› SL |
| æœ‰æŒå€‰ä½†æ²’æœ‰ TP | è‡ªå‹•è£œæ› TP |
| å¹³å€‰äº†ä½†é‚„æœ‰ SL/TP | è‡ªå‹•å–æ¶ˆ + æ¸…ç†å¿«å– |
| SL/TP è¢«æ‰‹å‹•å–æ¶ˆ | ä¸‹æ¬¡ cron è‡ªå‹•è£œæ› |
| SL/TP è¢«äº¤æ˜“æ‰€è§¸ç™¼ | åµæ¸¬åˆ°ç„¡æŒå€‰ â†’ æ¸…ç†å¿«å– |

> ğŸ’¡ ç°¡å–®èªªï¼š**ä½ ä¸ç”¨ç®¡ SL/TP**ï¼Œç³»çµ±æ¯å°æ™‚è‡ªå‹•å¹«ä½ ç¢ºèªã€è£œæ›ã€æ¸…ç†ã€‚

#### SL/TP å»é‡æ©Ÿåˆ¶ â­ NEW

ç³»çµ±æœƒ**è‡ªå‹•æª¢æŸ¥æ˜¯å¦å·²æœ‰ç›¸åŒçš„ SL/TP æ›å–®**ï¼Œé¿å…é‡è¤‡ä¸‹å–®ï¼š

1. **è§¸ç™¼åƒ¹æ¯”å°**ï¼šæ–° SL/TP èˆ‡ç¾æœ‰æ›å–®çš„è§¸ç™¼åƒ¹å·®è· < 0.2% â†’ è·³é
2. **æ–¹å‘æ¯”å°**ï¼šåªæ¯”å°ç›¸åŒæŒå€‰æ–¹å‘çš„æ›å–®
3. **è·¨ API æ¯”å°**ï¼šåŒæ™‚æª¢æŸ¥æ¨™æº– API å’Œ Algo Order API çš„æ›å–®

**å¸¸è¦‹å ´æ™¯**ï¼š
- cron æ¯å°æ™‚è·‘ä¸€æ¬¡ â†’ ATR å¾®èª¿å°è‡´ SL/TP åƒ¹æ ¼å°å¹…è®Šå‹• â†’ å·®è· < 0.2%ï¼Œ**ä¸æœƒé‡è¤‡æ›å–®**
- bot é‡å•Ÿå¾Œ â†’ è®€å–å¿«å– â†’ çŸ¥é“å·²ç¶“æ›äº†å“ªäº›å–® â†’ **ä¸æœƒé‡è¤‡æ›å–®**

#### SL/TP æŒä¹…åŒ–å¿«å– â­ NEW

SL/TP è¨‚å–®è³‡è¨Šä¿å­˜åœ¨ `reports/{market_type}/{strategy}/live/algo_orders_cache.json`ï¼Œ**å³ä½¿ bot é‡å•Ÿä¹Ÿä¸æœƒéºå¤±**ã€‚

å®Œæ•´ç”Ÿå‘½é€±æœŸï¼š

```
é–‹å€‰ â†’ æ› SL + TP â†’ å¯«å…¥å¿«å–æª”
  â†“
æ¯æ¬¡ cron â†’ è®€å¿«å– â†’ å»é‡æª¢æŸ¥ â†’ è£œæ›ç¼ºå¤±çš„
  â†“
å¹³å€‰ â†’ å–æ¶ˆ SL + TP â†’ æ¸…ç†å¿«å–
  â†“
SL/TP è¢«è§¸ç™¼ï¼ˆäº¤æ˜“æ‰€ç«¯ï¼‰ â†’ ä¸‹æ¬¡ cron åµæ¸¬ç„¡æŒå€‰ â†’ è‡ªå‹•æ¸…ç†å¿«å–
```

> âš ï¸ **æ³¨æ„**ï¼šå¦‚æœä½ åœ¨ Binance æ‰‹å‹•å–æ¶ˆäº† SL/TPï¼Œä¸‹æ¬¡ cron æœƒè‡ªå‹•é‡æ–°æ›ä¸Šï¼ˆå› ç‚ºç³»çµ±åµæ¸¬åˆ°ã€Œæœ‰æŒå€‰ä½†ç„¡ SL/TPã€ï¼‰ã€‚å¦‚æœä½ çœŸçš„ä¸æƒ³è¦ SL/TPï¼Œéœ€è¦åœ¨ YAML ä¸­æŠŠ `stop_loss_atr` å’Œ `take_profit_atr` è¨­æˆ `null`ã€‚

#### Telegram é€šçŸ¥ç¯„ä¾‹

é–‹å€‰æ™‚è‡ªå‹•æ¨æ’­ï¼š
```
ğŸŸ¢ é–‹å€‰ BTCUSDT
æ–¹å‘: LONG
å…¥å ´åƒ¹: $67,500
æ­¢æ: $66,000 (-2.2%, -$22.50)  â† é ä¼°è™§æ
æ­¢ç›ˆ: $72,000 (+6.7%, +$67.50)  â† é ä¼°ç›ˆåˆ©
```

ç”¨ `/status` å‘½ä»¤ä¹Ÿèƒ½çœ‹åˆ°æ¯å€‹æŒå€‰çš„ SL/TP å’Œé ä¼°ç›ˆè™§ï¼š
```
ğŸ“‹ æŒå€‰ (1)
ğŸŸ¢ ETHUSDT [SHORT] +12.03
   ğŸ›¡ï¸ SL: $2,050.00 (-$48.20)
   ğŸ¯ TP: $1,780.00 (+$45.60)
```

#### SL/TP è§¸ç™¼å¾Œçš„å†·å»æ©Ÿåˆ¶

ç•¶ SL/TP è¢«è§¸ç™¼å¾Œï¼Œç³»çµ±æœ‰**å†·å»æ©Ÿåˆ¶**ï¼ˆcooldownï¼‰é˜²æ­¢ç«‹å³åå‘é–‹å€‰ï¼š

```yaml
strategy:
  params:
    cooldown_bars: 4  # SL/TP è§¸ç™¼å¾Œç­‰å¾… 4 æ ¹ K ç·šæ‰èƒ½é‡æ–°é–‹å€‰
```

**æ³¨æ„**ï¼š
- å¹³å€‰æ™‚æœƒè‡ªå‹•å–æ¶ˆ **SL å’Œ TP**ï¼Œä¸¦æ¸…ç†å¿«å–
- å¦‚æœ SL/TP è¢«å–æ¶ˆï¼Œä¸‹æ¬¡ cron æœƒè‡ªå‹•è£œæ›
- Paper Trading ä¸æœƒçœŸçš„æ›å–®ï¼Œåªæ˜¯æ¨¡æ“¬
- å»é‡æ©Ÿåˆ¶å®¹å·® 0.2%ï¼šATR å¾®èª¿ä¸æœƒç”¢ç”Ÿé‡è¤‡å–®

### 10.9 ç†”æ–·æ©Ÿåˆ¶ (Circuit Breaker) â­ NEW

ç•¶å›æ’¤è¶…éè¨­å®šé–¾å€¼æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•åœæ­¢äº¤æ˜“ï¼š

```yaml
risk:
  max_drawdown_pct: 0.65  # 65% å›æ’¤è§¸ç™¼ç†”æ–·ï¼ˆ5x æ§“æ¡¿å»ºè­°ï¼‰
```

**å·¥ä½œåŸç†**ï¼š
1. æ¯æ¬¡ cron åŸ·è¡Œæ™‚è¨ˆç®—ç•¶å‰å›æ’¤
2. å¦‚æœå›æ’¤ > `max_drawdown_pct`ï¼Œåœæ­¢é–‹æ–°å€‰
3. ç™¼é€ Telegram è­¦å‘Šé€šçŸ¥
4. å¯æ‰‹å‹•é‡ç½®æˆ–ç­‰å¾…å›æ’¤æ¢å¾©

**æ§“æ¡¿èˆ‡ç†”æ–·å»ºè­°**ï¼š
| æ§“æ¡¿ | å»ºè­°ç†”æ–·ç·š | èªªæ˜ |
|------|-----------|------|
| 1x | 30% | ç¾è²¨ä¿å®ˆ |
| 3x | 45% | ä½æ§“æ¡¿ |
| 5x | 65% | ä¸­æ§“æ¡¿ |
| 10x+ | ä¸å»ºè­° | é¢¨éšªæ¥µé«˜ |

### 10.9.1 åˆç´„é¢¨éšªæé†’ âš ï¸

1. **æ§“æ¡¿é¢¨éšª**ï¼šé«˜æ§“æ¡¿æœƒæ”¾å¤§ç›ˆè™§ï¼Œå»ºè­°æ–°æ‰‹ç”¨ 1-3 å€
2. **å¼·å¹³é¢¨éšª**ï¼šåƒ¹æ ¼åŠ‡çƒˆæ³¢å‹•å¯èƒ½è§¸ç™¼å¼·åˆ¶å¹³å€‰
3. **è³‡é‡‘è²»ç‡**ï¼šåˆç´„æŒå€‰éœ€è¦æ”¯ä»˜/æ”¶å–è³‡é‡‘è²»ç‡ï¼ˆå›æ¸¬ä¸å«æ­¤æˆæœ¬ï¼‰
4. **å»ºè­°**ï¼š
   - å…ˆç”¨ Paper Trading æ¸¬è©¦è‡³å°‘ 2 é€±
   - åˆç´„ max_drawdown_pct è¨­å®šæ›´ä¿å®ˆï¼ˆå¦‚ 10-15%ï¼‰
   - æ–°æ‰‹å…ˆç”¨ `allocation: 0.35`ï¼Œç†Ÿæ‚‰å¾Œå†åŠ å¤§
   - ç¸½æ›éšª > 100% å‰å…ˆçœ‹æ‡‚ [Â§10.12 å¤šå¹£ç¨®å€‰ä½åˆ†é…](#1012-å¤šå¹£ç¨®å€‰ä½åˆ†é…--new)
   - âš ï¸ åŠ å¹£å‰å‹™å¿…è·‘åš´æ ¼å›æ¸¬ï¼ˆå« `funding_rate` + `slippage_model`ï¼‰ï¼Œé¿å…ã€Œå¿«æ¨‚è¡¨ã€

### 10.10 Binance å¸³æˆ¶æ¨¡å¼èªªæ˜

Binance Futures æœ‰å…©ç¨®æŒå€‰æ¨¡å¼ï¼š

| æ¨¡å¼ | èªªæ˜ | ç‰¹é» |
|------|------|------|
| **One-Way Mode** | åŒä¸€äº¤æ˜“å°åªèƒ½å–®å‘æŒå€‰ | åšå¤šå†åšç©ºæœƒäº’ç›¸æŠµæ¶ˆ |
| **Hedge Mode** | å¯åŒæ™‚æŒæœ‰å¤šç©ºå€‰ä½ | éœ€è¦æŒ‡å®š `positionSide` |

**å¦‚ä½•æŸ¥çœ‹/åˆ‡æ›**ï¼š
- Binance App â†’ Futures â†’ è¨­å®š âš™ï¸ â†’ Position Mode

**æ³¨æ„**ï¼šå¦‚æœä½ çš„å¸³æˆ¶æ˜¯ **Hedge Mode**ï¼Œæœ¬å°ˆæ¡ˆå·²è‡ªå‹•æ”¯æ´ï¼Œç„¡éœ€é¡å¤–è¨­å®šã€‚

### 10.11 å›æ¸¬æ•¸å­—çš„ç¾å¯¦é æœŸ

âš ï¸ **å›æ¸¬å ±é…¬ä¸ç­‰æ–¼å¯¦éš›å ±é…¬ï¼**

| å½±éŸ¿å› ç´  | å›æ¸¬å‡è¨­ | å¯¦éš›æƒ…æ³ |
|----------|----------|----------|
| æ»‘åƒ¹ | 0.03% | å¯èƒ½ 0.1-0.5% |
| å¸‚å ´è¡æ“Š | ç„¡ | å¤§å–®æœƒå½±éŸ¿åƒ¹æ ¼ |
| æµå‹•æ€§ | éš¨æ™‚æˆäº¤ | å¯èƒ½ç„¡æ³•æˆäº¤ |
| è³‡é‡‘å®¹é‡ | ç„¡é™ | æœ‰ä¸Šé™ |

**ç¶“é©—æ³•å‰‡**ï¼š
```
å¯¦éš›å ±é…¬ â‰ˆ å›æ¸¬å ±é…¬ Ã· 3~5

å›æ¸¬å¹´åŒ– 400% â†’ å¯¦éš›é æœŸ 80-130%
å›æ¸¬å¹´åŒ– 100% â†’ å¯¦éš›é æœŸ 20-35%
```

**å›æ¸¬çš„æ­£ç¢ºç”¨æ³•**ï¼š
- âœ… æ¯”è¼ƒä¸åŒç­–ç•¥çš„å„ªåŠ£
- âœ… é©—è­‰ç­–ç•¥é‚è¼¯æ˜¯å¦åˆç†
- âŒ ç›´æ¥ç•¶ä½œæ”¶ç›Šé æ¸¬
- âŒ è¿½æ±‚æœ€é«˜å›æ¸¬å ±é…¬

### 10.12 å¤šå¹£ç¨®å€‰ä½åˆ†é… â­ NEW

#### å€‰ä½å¤§å°ç”±ä»€éº¼æ±ºå®šï¼Ÿ

å¾ˆå¤šäººä»¥ç‚ºã€ŒåŠ å¤§æ§“æ¡¿ = åŠ å¤§å€‰ä½ã€ï¼Œ**é€™æ˜¯éŒ¯çš„**ã€‚

| åƒæ•¸ | ä½œç”¨ | åœ¨å“ªè£¡è¨­å®š |
|------|------|-----------|
| `portfolio.allocation` | æ¯å€‹å¹£åˆ†é…å¤šå°‘ % æ¬Šç›Š | `config/*.yaml` |
| `portfolio.cash_reserve` | ä¿ç•™å¤šå°‘ % ç¾é‡‘ä¸å‹• | `config/*.yaml` |
| `futures.leverage` | åªå½±éŸ¿ä¿è­‰é‡‘éœ€æ±‚ | `config/*.yaml` |

```
âš ï¸ æ§“æ¡¿ â‰  å€‰ä½å¤§å°ï¼

5x æ§“æ¡¿ã€åˆ†é… 100% æ¬Šç›Š â†’ å€‰ä½ = $1,000ï¼Œä¿è­‰é‡‘ = $200
10x æ§“æ¡¿ã€åˆ†é… 100% æ¬Šç›Š â†’ å€‰ä½ = $1,000ï¼Œä¿è­‰é‡‘ = $100
                                    â†‘ å€‰ä½ä¸è®Š    â†‘ ä¿è­‰é‡‘è®Šå°‘
```

æƒ³è¦åŠ å¤§å€‰ä½ï¼Ÿèª¿ `allocation`ï¼Œä¸æ˜¯èª¿ `leverage`ã€‚

#### é…ç½®ç¯„ä¾‹

```yaml
# å¤šå¹£ç¨®å€‰ä½åˆ†é…ï¼ˆåš´æ ¼å›æ¸¬ç¯©é¸å¾Œï¼‰
portfolio:
  cash_reserve: 0           # ä¸ä¿ç•™ç¾é‡‘
  allocation:
    ETHUSDT: 1.00           # 100% æ¬Šç›Šåˆ†é…çµ¦ ETHï¼ˆåš´æ ¼ç‰ˆ Sharpe 0.65ï¼‰
    SOLUSDT: 1.00           # 100% æ¬Šç›Šåˆ†é…çµ¦ SOLï¼ˆåš´æ ¼ç‰ˆ Sharpe 1.30ï¼‰
    # ç¸½æ›éšª 200%ï¼ˆé›™å¹£å„ 100%ï¼‰ï¼Œ5x æ§“æ¡¿ä¸‹ä¿è­‰é‡‘ä½” 40%
    # âš ï¸ BTC/AVAX/LINK/XRP/BNB åœ¨åš´æ ¼ç‰ˆï¼ˆå« Funding Rate + Volume Slippageï¼‰å…¨éƒ¨çˆ†è™§
```

**è¨ˆç®—å…¬å¼**ï¼š

```
æŸå¹£ç¨®å€‰ä½é‡‘é¡ = ç¸½æ¬Šç›Š Ã— allocation Ã— |ä¿¡è™Ÿå¼·åº¦|

ä¾‹å¦‚ï¼š
  ç¸½æ¬Šç›Š = $1,000
  BTCUSDT allocation = 1.00
  ä¿¡è™Ÿ = -100%ï¼ˆåšç©ºï¼‰
  â†’ å€‰ä½åç¾©åƒ¹å€¼ = $1,000 Ã— 1.00 Ã— 100% = $1,000
  â†’ 5x æ§“æ¡¿ä¸‹ï¼Œä¿è­‰é‡‘éœ€æ±‚ = $1,000 / 5 = $200
```

#### å¸¸è¦‹é…ç½®

| é¢¨æ ¼ | cash_reserve | allocation | ç¸½æ›éšª | MDD é ä¼° |
|------|-------------|------------|--------|----------|
| ä¿å®ˆ | 0.30 | è‡ªå‹•å¹³å‡ï¼ˆä¸å¯« allocationï¼‰ | ~70% | ~10% |
| å¹³è¡¡ | 0.10 | ETH 0.45 + SOL 0.45 | ~90% | ~15% |
| æ¿€é€² | 0.00 | ETH 1.00 + SOL 1.00 | 200% | ~40% |

> âš ï¸ **ç¸½æ›éšª > 100%** ä»£è¡¨ä½ åœ¨ç”¨æ§“æ¡¿æ”¾å¤§å€‰ä½ã€‚MDD ä¹Ÿæœƒç­‰æ¯”æ”¾å¤§ã€‚200% æ›éšªä¸‹ 5x æ§“æ¡¿ä¿è­‰é‡‘ä½” 40%ï¼Œå›æ’¤æœ€å¤§åˆ° 40%ï¼ˆé›¢ 65% ç†”æ–·ç·šé‚„æœ‰ 25% ç·©è¡ï¼‰ã€‚

**æ²’å¯« `allocation` æ™‚**ï¼šç³»çµ±è‡ªå‹•å¹³å‡åˆ†é…ã€‚2 å€‹å¹£ + 30% ç¾é‡‘ = æ¯å€‹å¹£ 35%ã€‚

#### å¤šå¹£ç¨®é˜²éœ‡ç›ªï¼ˆAnti-Rebalancingï¼‰â­ NEW

åŒæ™‚äº¤æ˜“å¤šå€‹å¹£æ™‚ï¼ŒA å¹£çš„ PnL æ³¢å‹•æœƒæ”¹è®Šç¸½æ¬Šç›Šï¼Œå°è‡´ B å¹£çš„ã€Œç•¶å‰å€‰ä½ %ã€é£„ç§»ã€‚
ç³»çµ±æœ‰**é˜²è­·æ©Ÿåˆ¶**ï¼Œé¿å…å› ç‚ºå¾®å°æ³¢å‹•è§¸ç™¼ä¸å¿…è¦çš„äº¤æ˜“å’Œæ‰‹çºŒè²»ï¼š

```
                  å¡«å……ç‡ = |ç•¶å‰å€‰ä½%| / |ç›®æ¨™å€‰ä½%|

ç›®æ¨™: SHORT 100%
ç•¶å‰: SHORT -95%ï¼ˆå› ç‚ºå…¶ä»–å¹£ PnL æ³¢å‹•ï¼‰
å¡«å……ç‡ = 95% â‰¥ 80% â†’ âœ… è·³éï¼ˆè¦–ç‚ºæ­£å¸¸æ³¢å‹•ï¼‰

ç›®æ¨™: SHORT 100%
ç•¶å‰: SHORT -32%ï¼ˆå‰›é–‹å€‰ï¼Œé‚„æ²’åˆ°ä½ï¼‰
å¡«å……ç‡ = 32% < 80% â†’ âš¡ åŸ·è¡ŒåŠ å€‰
```

> ğŸ’¡ **80% é–€æª»**ï¼šå€‰ä½å·²é”ç›®æ¨™çš„ 80% ä»¥ä¸Š â†’ ä¸å‹•ã€‚ä½æ–¼ 80% â†’ åŠ å€‰åˆ°ç›®æ¨™ã€‚é€™é¿å…äº†æ¯å°æ™‚å› ç‚º PnL å¾®èª¿è€Œä¸æ–·åŠ æ¸›å€‰ã€‚

---

## å¢é‡ K ç·šå¿«å– â­ v2.8

### å•é¡Œï¼šå›æ¸¬ vs å¯¦ç›¤çš„æ•¸æ“šå·®ç•°

| | å›æ¸¬ | å¯¦ç›¤ï¼ˆèˆŠç‰ˆï¼‰ |
|---|------|-------------|
| æ•¸æ“š | å®Œæ•´æ­·å²ï¼Œå¾ç¬¬ 1 bar åˆ°æœ€å¾Œ | æ¯æ¬¡åªçœ‹æœ€è¿‘ 300 bar |
| ç­–ç•¥è¡Œç‚º | ç‹€æ…‹æ©Ÿå¾ bar 0 é–‹å§‹èµ° | æ¯æ¬¡å¾ bar N-300 é‡æ–°é–‹å§‹ |
| ç©©å®šæ€§ | ç¢ºå®šæ€§çµæœ | çª—å£åç§» 1 bar å°±å¯èƒ½å°è‡´ä¿¡è™Ÿç¿»è½‰ |

**ç‚ºä»€éº¼æœƒä¸ä¸€è‡´ï¼Ÿ**

ç­–ç•¥ï¼ˆå¦‚ RSI + ADXï¼‰æœ¬è³ªæ˜¯ã€Œç‹€æ…‹æ©Ÿã€ï¼šæ¯ä¸€æ ¹ K ç·šçš„è¨ˆç®—ä¾è³´å‰é¢æ‰€æœ‰ bar çš„æ­·å²ã€‚
å›æ¸¬å¾ bar 0 è·‘åˆ°æœ€å¾Œï¼Œçµæœæ˜¯ç¢ºå®šçš„ã€‚
ä½†å¯¦ç›¤æ¯æ¬¡åªæ‹‰æœ€è¿‘ 300 barï¼Œ**çª—å£èµ·é»æ¯å°æ™‚åç§» 1 bar**ï¼Œå°±åƒè®“ç‹€æ…‹æ©Ÿå¾ä¸åŒçš„åˆå§‹ç‹€æ…‹é–‹å§‹èµ°â€”â€”å³ä½¿åªå·® 1 barï¼Œå¾ŒçºŒ RSI/ADX çš„å€¼å¯èƒ½èµ°å‘å®Œå…¨ä¸åŒçš„è·¯å¾‘ã€‚

```
å›æ¸¬:   [bar 0] [bar 1] [bar 2] ... [bar 8000] â†’ ä¿¡è™Ÿ SHORT
å¯¦ç›¤ T: [bar 7700] ... [bar 8000] â†’ ä¿¡è™Ÿ SHORT âœ…
å¯¦ç›¤ T+1: [bar 7701] ... [bar 8001] â†’ ä¿¡è™Ÿ LONG âŒ â† èµ·é»åç§» 1 barï¼
```

### è§£æ±ºæ–¹æ¡ˆï¼šå¢é‡ K ç·šå¿«å–

**åŸç†**ï¼šé¦–æ¬¡å•Ÿå‹•æ‹‰å– 300 æ ¹ç¨®å­ K ç·šï¼Œå¾ŒçºŒæ¯æ¬¡ cron åªæ‹‰ã€Œæ–°çš„ K ç·šã€ä¸¦ append åˆ°å¿«å–ã€‚ç­–ç•¥å§‹çµ‚å¾ bar 0 è·‘åˆ°æœ€æ–° barï¼Œèˆ‡å›æ¸¬è¡Œç‚ºä¸€è‡´ã€‚

```
é¦–æ¬¡ cronï¼š
  æ‹‰å– 300 bar ç¨®å­ â†’ å­˜å…¥ kline_cache/BTCUSDT.parquet
  ç­–ç•¥è·‘ [bar 0 ~ bar 300] â†’ ä¿¡è™Ÿ SHORT

ç¬¬ 2 æ¬¡ cronï¼š
  å¢é‡æ‹‰ +1 bar â†’ append åˆ° parquet
  ç­–ç•¥è·‘ [bar 0 ~ bar 301] â†’ ä¿¡è™Ÿ SHORT âœ… ç©©å®š

ç¬¬ 1000 æ¬¡ cronï¼š
  å¿«å–å·²æœ‰ 1300 bar
  ç­–ç•¥è·‘ [bar 0 ~ bar 1300] â†’ èˆ‡å›æ¸¬è¡Œç‚ºä¸€è‡´ âœ…
```

### 11.1 é…ç½®æ–¹å¼

åœ¨ YAML ä¸­æ–°å¢ `live` å€æ®µï¼š

```yaml
# å¯¦ç›¤å°ˆå±¬é…ç½®
live:
  kline_cache: true           # å•Ÿç”¨å¢é‡ K ç·šå¿«å–ï¼ˆæ¨è–¦ï¼‰
  flip_confirmation: false    # æ–¹å‘åˆ‡æ› 2-tick ç¢ºèªï¼ˆå¿«å–æ¨¡å¼ä¸‹ä¸éœ€è¦ï¼‰
```

| åƒæ•¸ | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| `kline_cache` | `true` | å•Ÿç”¨å¢é‡å¿«å–ï¼Œç­–ç•¥å¾ bar 0 è·‘åˆ°æœ€æ–° bar |
| `flip_confirmation` | `false` | æ–¹å‘ç¿»è½‰éœ€é€£çºŒ 2 æ¬¡ cron ç¢ºèªæ‰åŸ·è¡Œ |

**å»ºè­°çµ„åˆ**ï¼š

| æƒ…å¢ƒ | `kline_cache` | `flip_confirmation` | èªªæ˜ |
|------|:---:|:---:|------|
| æ­£å¼ç’°å¢ƒï¼ˆæ¨è–¦ï¼‰| `true` | `false` | å¿«å–è§£æ±ºæ ¹æœ¬å•é¡Œï¼Œä¸éœ€é¡å¤–ç¢ºèª |
| å¿«å– + ä¿å®ˆ | `true` | `true` | é›™é‡ä¿éšªï¼Œä½†æœƒå»¶é² 1 tick æ‰ç¿»è½‰ |
| èˆŠç‰ˆç›¸å®¹ | `false` | `true` | æ»‘å‹•çª—å£ + ç¢ºèªæ©Ÿåˆ¶é˜²æ­¢é »ç¹ç¿»è½‰ |
| ä¸å»ºè­° | `false` | `false` | å®¹æ˜“å› æ•¸æ“šåç§»å°è‡´é »ç¹ç¿»è½‰ |

### 11.2 å¿«å–å„²å­˜

å¿«å–æª”æ¡ˆä½æ–¼ `reports/{market_type}/{strategy}/live/kline_cache/`ï¼š

```
reports/futures/rsi_adx_atr/live/
â”œâ”€â”€ kline_cache/
â”‚   â”œâ”€â”€ BTCUSDT.parquet    # BTC K ç·šå¿«å–
â”‚   â””â”€â”€ ETHUSDT.parquet    # ETH K ç·šå¿«å–
â”œâ”€â”€ last_signals.json      # ä¿¡è™Ÿå¿«ç…§ï¼ˆä¾› Telegram Bot è®€å–ï¼‰
â”œâ”€â”€ signal_state.json      # ä¿¡è™Ÿæ–¹å‘ç‹€æ…‹ï¼ˆä¾›ç¿»è½‰ç¢ºèªç”¨ï¼‰
â””â”€â”€ algo_orders_cache.json # SL/TP æ›å–®å¿«å–
```

**ç©ºé–“ä½”ç”¨**ï¼š
- 1h K ç·š Ã— 1 å¹´ â‰ˆ 8,760 bar Ã— ~50 bytes â‰ˆ **430 KB**ï¼ˆå¯å¿½ç•¥ï¼‰
- å¿«å–åªå¢ä¸æ¸›ï¼Œä¸æœƒè¢«æˆªæ–·

### 11.3 å·¥ä½œæµç¨‹

```
[é¦–æ¬¡ cron]
  IncrementalKlineCache.get_klines("BTCUSDT")
  â†’ æ‹‰å– 300 æ ¹ç¨®å­ K ç·š
  â†’ å­˜å…¥ kline_cache/BTCUSDT.parquet
  â†’ å‚³çµ¦ generate_signal()

[å¾ŒçºŒæ¯æ¬¡ cron]
  IncrementalKlineCache.get_klines("BTCUSDT")
  â†’ è¼‰å…¥ parquet (è¨˜æ†¶é«”å¿«å–åŠ é€Ÿ)
  â†’ åªæ‹‰æœ€å¾Œä¸€æ ¹ä¹‹å¾Œçš„æ–° K ç·š (å¢é‡)
  â†’ append + å»é‡ + ä¸Ÿæ£„æœªæ”¶ç›¤
  â†’ å­˜å› parquet
  â†’ å‚³çµ¦ generate_signal()

[Telegram /signals å‘½ä»¤]
  â†’ å„ªå…ˆè®€å– last_signals.jsonï¼ˆèˆ‡ cron ä¿¡è™Ÿä¸€è‡´ï¼‰
  â†’ è‹¥ç„¡å¿«ç…§ï¼Œfallback åˆ°å³æ™‚ç”Ÿæˆï¼ˆä¹Ÿä½¿ç”¨å¿«å–æ•¸æ“šï¼‰
```

### 11.4 æ–¹å‘åˆ‡æ›ç¢ºèªï¼ˆFlip Confirmationï¼‰

ç•¶ `flip_confirmation: true` æ™‚ï¼Œæ–¹å‘ç¿»è½‰ï¼ˆå¦‚ SHORT â†’ LONGï¼‰éœ€è¦é€£çºŒ 2 æ¬¡ cron ç¢ºèªï¼š

```
T=0: ä¿¡è™Ÿ SHORT â†’ æ­£å¸¸åŸ·è¡Œ
T=1: ä¿¡è™Ÿ LONG  â†’ â¸ï¸ ç¬¬ 1 æ¬¡ç¿»è½‰ï¼Œæš«ä¸åŸ·è¡Œï¼Œç­‰ä¸‹ä¸€ tick ç¢ºèª
T=2: ä¿¡è™Ÿ LONG  â†’ âœ… é€£çºŒ 2 æ¬¡ LONGï¼Œç¢ºèªç¿»è½‰ï¼ŒåŸ·è¡Œè²·å…¥
```

```
T=0: ä¿¡è™Ÿ SHORT â†’ æ­£å¸¸åŸ·è¡Œ
T=1: ä¿¡è™Ÿ LONG  â†’ â¸ï¸ ç¬¬ 1 æ¬¡ç¿»è½‰
T=2: ä¿¡è™Ÿ SHORT â†’ âŒ ç¿»å›ä¾†äº†ï¼Œå–æ¶ˆç¿»è½‰ï¼Œç¶­æŒ SHORT
```

> ğŸ’¡ **ä»€éº¼æ™‚å€™éœ€è¦ï¼Ÿ** å¦‚æœä½ æ²’æœ‰å•Ÿç”¨ `kline_cache`ï¼ˆæ»‘å‹•çª—å£æ¨¡å¼ï¼‰ï¼Œå»ºè­°é–‹å•Ÿ `flip_confirmation` ä¾†é¿å…æ•¸æ“šå¾®å°å·®ç•°å°è‡´çš„é »ç¹å¤šç©ºç¿»è½‰ã€‚å¦‚æœå·²å•Ÿç”¨å¿«å–ï¼Œé€šå¸¸ä¸éœ€è¦ã€‚

### 11.5 æ³¨æ„äº‹é …

1. **é¦–æ¬¡ cron ç¨æ…¢**ï¼šéœ€è¦æ‹‰å– 300 æ ¹ç¨®å­ K ç·šï¼Œä¹‹å¾Œæ¯æ¬¡åªæ‹‰å¢é‡ï¼ˆé€šå¸¸ 1 æ ¹ï¼‰
2. **å¿«å–æå£**ï¼šå¦‚æœ parquet æª”æå£ï¼Œç³»çµ±æœƒè‡ªå‹•é‡æ–°åˆå§‹åŒ–ï¼ˆç­‰åŒé¦–æ¬¡å•Ÿå‹•ï¼‰
3. **åˆªé™¤å¿«å–**ï¼šå¦‚æœä½ æƒ³è®“ç­–ç•¥ã€Œå¾é›¶é–‹å§‹ã€ï¼Œåˆªé™¤ `kline_cache/` ç›®éŒ„å³å¯
4. **ä¸å½±éŸ¿ cron è¨­å®š**ï¼š`run_live.py --real --once` æœƒè‡ªå‹•åµæ¸¬ `live.kline_cache` è¨­å®š
5. **Telegram Bot å…±äº«å¿«å–**ï¼šBot çš„ `/signals` fallback æœƒä½¿ç”¨åŒä¸€ä»½å¿«å–æ•¸æ“š

---

## å¤šæ•¸æ“šæºèˆ‡é•·æœŸæ­·å²æ•¸æ“š â­ NEW

å°ˆæ¡ˆæ”¯æ´å¾å¤šå€‹æ•¸æ“šæºä¸‹è¼‰æ­·å²æ•¸æ“šï¼Œè®“ä½ å¯ä»¥å›æ¸¬æ›´é•·çš„æ™‚é–“ç¯„åœã€‚

### 11.1 å¯ç”¨æ•¸æ“šæº

| æ•¸æ“šæº | æœ€æ—©æ•¸æ“š | æ”¯æ´é€±æœŸ | èªªæ˜ |
|--------|----------|----------|------|
| **Binance** | 2017-08 | 1m-1M | é è¨­ï¼Œæœ€ç©©å®š |
| **Yahoo Finance** | 2014-09 | 1d ç‚ºä¸» | BTC/ETH æ—¥ç·šæ•¸æ“š |
| **CCXT (Bitfinex)** | 2014-01 | 1h-1d | æ—©æœŸ 1h æ•¸æ“š |
| **CCXT (Bitstamp)** | 2011-08 | 1d ç‚ºä¸» | BTC æœ€æ—©æ•¸æ“š |
| **Binance Vision** | 2017-08 | å…¨éƒ¨ | æ‰¹é‡ä¸‹è¼‰ï¼Œæœ€å¿« |

### 11.2 ä¸‹è¼‰é•·æœŸæ­·å²æ•¸æ“š

```bash
# æŸ¥çœ‹å¯ç”¨æ•¸æ“šæº
python scripts/download_data.py --list-sources

# ä¸‹è¼‰ BTC æ—¥ç·š (2014 å¹´èµ·ï¼ŒYahoo Finance)
python scripts/download_data.py --source yfinance --symbol BTCUSDT --start 2014-09-17 --interval 1d --full

# ä¸‹è¼‰ BTC 1h (2014 å¹´èµ·ï¼ŒBitfinex via CCXT)
python scripts/download_data.py --source ccxt --exchange bitfinex --symbol BTCUSDT --start 2014-01-01 --interval 1h --full

# ä¸‹è¼‰å¾Œæœƒè‡ªå‹•åˆä½µåˆ°æœ¬åœ° Parquet æ–‡ä»¶
```

### 11.3 æ•¸æ“šåˆä½µé‚è¼¯

- å¾ä¸åŒæ•¸æ“šæºä¸‹è¼‰çš„æ•¸æ“šæœƒè‡ªå‹•åˆä½µåˆ°åŒä¸€å€‹ Parquet æ–‡ä»¶
- åˆä½µæ™‚ä»¥æ™‚é–“æˆ³ç‚ºä¸»éµï¼Œå„ªå…ˆä¿ç•™è¼ƒæ–°çš„æ•¸æ“š
- ä¾‹å¦‚ï¼šBitfinex (2014-2017) + Binance (2017-now) â†’ å®Œæ•´ 12+ å¹´æ•¸æ“š

### 11.4 æ•¸æ“šå­˜å„²

```
data/binance/
â”œâ”€â”€ spot/
â”‚   â”œâ”€â”€ 1h/
â”‚   â”‚   â”œâ”€â”€ BTCUSDT.parquet  # åŒ…å«æ‰€æœ‰ä¾†æºçš„åˆä½µæ•¸æ“š
â”‚   â”‚   â””â”€â”€ ETHUSDT.parquet
â”‚   â””â”€â”€ 1d/
â”‚       â””â”€â”€ BTCUSDT.parquet  # 11+ å¹´æ—¥ç·šæ•¸æ“š
â””â”€â”€ futures/
    â””â”€â”€ 1h/
```

**å­˜å„²æ•ˆç‡**ï¼š
- 11 å¹´æ—¥ç·šæ•¸æ“šï¼š~227 KB
- 12 å¹´ 1h æ•¸æ“šï¼š~30 MB

---

## çµ„åˆå›æ¸¬ â­ NEW

æ”¯æ´å¤šå¹£ç¨®çµ„åˆå›æ¸¬ï¼Œè©•ä¼°æŠ•è³‡çµ„åˆçš„æ•´é«”è¡¨ç¾ã€‚

### 12.1 åŸºæœ¬ç”¨æ³•

```bash
# ç­‰æ¬Šé‡çµ„åˆ (BTC 50% + ETH 50%)
python scripts/run_portfolio_backtest.py -c config/rsi_adx_atr.yaml --symbols BTCUSDT ETHUSDT

# è‡ªè¨‚æ¬Šé‡ (BTC 70% + ETH 30%)
python scripts/run_portfolio_backtest.py -c config/rsi_adx_atr.yaml --symbols BTCUSDT ETHUSDT --weights 0.7 0.3

# é›™å¹£ç¨®çµ„åˆï¼ˆç•¶å‰ç”Ÿç”¢é…ç½®ï¼‰
python scripts/run_portfolio_backtest.py -c config/futures_rsi_adx_atr.yaml --symbols ETHUSDT SOLUSDT --weights 0.5 0.5
```

### 12.2 çµ„åˆå›æ¸¬çµæœç¯„ä¾‹

```
ğŸ“Š çµ„åˆé…ç½®:
   ETHUSDT: 50.0%
   SOLUSDT: 50.0%

ğŸ“… å…±åŒæ™‚é–“ç¯„åœ: 2022-01-01 â†’ 2026-02-17
  ETHUSDT: Sharpe 0.65, 3/4 å¹´æ­£
  SOLUSDT: Sharpe 1.30, 4/4 å¹´æ­£

======================================================================
  çµ„åˆå›æ¸¬çµæœ: ETHUSDT + SOLUSDTï¼ˆåš´æ ¼ç‰ˆï¼Œå« Funding Rate + Volume Slippageï¼‰
======================================================================

æŒ‡æ¨™                                           çµ„åˆç­–ç•¥        çµ„åˆ Buy&Hold
----------------------------------------------------------------------
Total Return [%]                           436.00             xxx.xx
Sharpe Ratio                                 1.32               x.xx
Max Drawdown [%]                            39.80              xx.xx
```

> âš ï¸ ä»¥ä¸Šç‚ºã€Œåš´æ ¼ç‰ˆã€å›æ¸¬çµæœï¼ˆå« Funding Rate + Volume Slippage æˆæœ¬ï¼‰ã€‚ç°¡æ˜“ç‰ˆï¼ˆä¸å«æˆæœ¬ï¼‰æ•¸å­—æœƒé«˜å¾ˆå¤šï¼Œä½†ä¸å¯ä¿¡ã€‚

### 12.3 çµ„åˆå„ªåŒ–å»ºè­°

| é…ç½® | ç‰¹é» | é©åˆ |
|------|------|------|
| ETH 50% + SOL 50% | å¹³è¡¡æ”¶ç›Šèˆ‡é¢¨éšª | â­ æ¨è–¦ï¼ˆåš´æ ¼å›æ¸¬é©—è­‰ï¼‰ |
| ETH 100% + SOL 100% | æ”¶ç›Šæœ€é«˜ï¼Œæ§“æ¡¿æ”¾å¤§ | æ¿€é€²å‹ï¼ˆç›®å‰ç”Ÿç”¢é…ç½®ï¼‰ |

> âš ï¸ åŠ å…¥æ–°å¹£å‰å‹™å¿…è·‘åš´æ ¼å›æ¸¬ï¼ˆ`funding_rate.enabled: true` + `slippage_model.enabled: true`ï¼‰ï¼Œé¿å…ã€Œå¿«æ¨‚è¡¨ã€ã€‚

### 12.4 è¼¸å‡ºæ–‡ä»¶

çµ„åˆå›æ¸¬æœƒç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
reports/{market_type}/{strategy}/portfolio/{timestamp}/
â”œâ”€â”€ portfolio_equity_curve.png   # çµ„åˆè³‡é‡‘æ›²ç·šåœ–
â”œâ”€â”€ portfolio_equity.csv         # çµ„åˆæ·¨å€¼æ•¸æ“š
â””â”€â”€ portfolio_stats.json         # çµ„åˆçµ±è¨ˆæŒ‡æ¨™
```

ä¾‹å¦‚ï¼š`reports/futures/rsi_adx_atr/portfolio/20260213_114917/`

---

## RSI Exit ç­–ç•¥é…ç½® â­ NEW

é€™æ˜¯ç¶“éå®Œæ•´é©—è­‰çš„æœ€ä½³ç­–ç•¥é…ç½®ï¼Œå»ºè­°æ–°æ‰‹ç›´æ¥ä½¿ç”¨ã€‚

### 13.1 ç­–ç•¥ç‰¹é»

**RSI Exit** èˆ‡æ¨™æº– ATR TP çš„å€åˆ¥ï¼š

| ç‰¹æ€§ | æ¨™æº–é…ç½® | RSI Exit |
|------|----------|----------|
| æ­¢æ | ATR-based | ATR-based |
| æ­¢ç›ˆ | å›ºå®š ATR å€æ•¸ | **RSI overbought** |
| å„ªé» | æ˜ç¢ºç›®æ¨™ | è®“åˆ©æ½¤å¥”è·‘ |
| é©åˆ | éœ‡ç›ªå¸‚ | **è¶¨å‹¢å¸‚** |

### 13.2 å„ªåŒ–å¾Œçš„æœ€ä½³åƒæ•¸

```yaml
# config/rsi_adx_atr_rsi_exit.yaml
strategy:
  name: "rsi_adx_atr"
  params:
    rsi_period: 10       # æ›´çŸ­é€±æœŸï¼Œæ›´å¿«åæ‡‰
    oversold: 30         # æ›´æ—©å…¥å ´
    overbought: 75       # å»¶å¾Œå‡ºå ´ï¼Œè®“åˆ©æ½¤è·‘
    min_adx: 15          # é™ä½è¶¨å‹¢é–€æª»
    adx_period: 14
    stop_loss_atr: 1.5   # æ›´ç·Šæ­¢æ
    take_profit_atr: null  # â­ é—œéµï¼šnull = RSI å‡ºå ´
    atr_period: 14
    cooldown_bars: 4
```

### 13.3 é©—è­‰çµæœï¼ˆ2026-02-13ï¼‰

**Walk-Forward é©—è­‰**ï¼š
| å¹£ç¨® | Train Sharpe | Test Sharpe | ç¸¾æ•ˆè¡°é€€ | 5-Fold |
|------|-------------|-------------|----------|--------|
| BTCUSDT | 3.00 | **3.43** | -14.5% | 5/5 âœ… |
| ETHUSDT | 3.89 | **4.07** | -4.6% | 5/5 âœ… |

**å®Œæ•´é©—è­‰æ‘˜è¦**ï¼š
```
Walk-Forward: âœ… PASS (å¹³å‡è¡°é€€ -9.5%)
Monte Carlo:  âœ… PASS (VaR 95%: 0.60%)
DSR:          âœ… PASS (æ ¡æ­£ SR: 3.75)
PBO:          âœ… PASS (20%)
Kelly:        âœ… PASS (2/2)
```

### 13.4 å›æ¸¬è¡¨ç¾ï¼ˆ2023-2026ï¼‰

| å¹£ç¨® | ç­–ç•¥æ”¶ç›Š | Sharpe | Max DD | vs Buy&Hold |
|------|----------|--------|--------|-------------|
| BTCUSDT | +1,044% | 4.03 | -10.3% | 3.4x |
| ETHUSDT | +1,663% | 3.72 | -10.4% | 23x |
| SOLUSDT | +13,976% | 4.18 | -17.9% | - |

### 13.5 å¿«é€Ÿé–‹å§‹

```bash
# 1. ä¸‹è¼‰æ•¸æ“š
python scripts/download_data.py -c config/rsi_adx_atr_rsi_exit.yaml

# 2. åŸ·è¡Œå›æ¸¬
python scripts/run_backtest.py -c config/rsi_adx_atr_rsi_exit.yaml

# 3. é©—è­‰ç­–ç•¥
python scripts/validate.py -c config/rsi_adx_atr_rsi_exit.yaml

# 4. Paper Trading
python scripts/run_live.py -c config/rsi_adx_atr_rsi_exit.yaml --paper --once
```

### 13.6 Kelly å€‰ä½å»ºè­°

| å¹£ç¨® | å‹ç‡ | ç›ˆè™§æ¯” | å»ºè­°å€‰ä½ |
|------|------|--------|----------|
| BTCUSDT | 52.7% | 2.02 | **7.3%** (Quarter Kelly) |
| ETHUSDT | 56.1% | 1.71 | **7.6%** (Quarter Kelly) |

å¦‚æœä½ æœ‰ 4 å€‹å¹£ç¨® + 20% ç¾é‡‘å„²å‚™ï¼Œæ¯å¹£ç´„ 20% æ¬Šé‡ï¼Œå¯¦éš›å€‰ä½ = 20% Ã— 7.5% â‰ˆ **1.5%** ç¸½è³‡é‡‘é¢¨éšªã€‚

---

## ç­–ç•¥å‡ç´šï¼šDynamic RSI + Funding Filter â­ v3.0

### 15.1 å•é¡Œï¼šAlpha Decay

ç ”ç©¶ç™¼ç¾ RSI çš„é æ¸¬èƒ½åŠ›ï¼ˆICï¼‰åœ¨è¡°æ¸›ï¼š
- 2023: IC = +0.065
- 2024: IC = +0.041ï¼ˆä¸‹é™ 37%ï¼‰
- 2025: IC = +0.025ï¼ˆä¸‹é™ 62%ï¼‰
- 2026: IC = +0.018ï¼ˆä¸‹é™ 72%ï¼‰

å›ºå®šé–¾å€¼ï¼ˆ30/70ï¼‰ç„¡æ³•é©æ‡‰å¸‚å ´çµæ§‹è®ŠåŒ–ã€‚

### 15.2 è§£æ±ºæ–¹æ¡ˆï¼šDynamic RSIï¼ˆRolling Percentileï¼‰

ç”¨**æ»¾å‹•ç™¾åˆ†ä½**å–ä»£å›ºå®šé–¾å€¼ï¼Œè®“ç­–ç•¥è‡ªå‹•é©æ‡‰å¸‚å ´ï¼š

```yaml
strategy:
  params:
    rsi_mode: "dynamic"       # å•Ÿç”¨å‹•æ…‹ RSI
    rsi_lookback_days: 14     # æ»¾å‹•çª—å£ 14 å¤©
    rsi_quantile_low: 0.10    # 10th percentile = è¶…è³£
    rsi_quantile_high: 0.90   # 90th percentile = è¶…è²·
```

**åŸç†**ï¼š
- ä¸å†ç”¨å›ºå®š 30/70ï¼Œè€Œæ˜¯å–éå» 14 å¤© RSI çš„ 10%/90% åˆ†ä½
- å¸‚å ´éœ‡ç›ªæ™‚é–¾å€¼æ”¶çª„ï¼ˆæ›´æ•æ„Ÿï¼‰ï¼Œè¶¨å‹¢æ™‚é–¾å€¼æ”¾å¯¬ï¼ˆæ›´è€å¿ƒï¼‰
- BTC 2026 å¹´ IC å¾ -0.002ï¼ˆStaticï¼‰æ¢å¾©åˆ° +0.015ï¼ˆDynamicï¼‰

### 15.3 Funding Rate éæ¿¾å™¨

Funding Rate æ˜¯**çœŸæ­£çš„ç¨ç«‹å› å­**ï¼ˆèˆ‡ RSI/ADX ç›¸é—œæ€§ < 0.1ï¼‰ï¼Œç”¨ä¾†éæ¿¾æ“æ“ äº¤æ˜“ï¼š

```yaml
strategy:
  params:
    use_funding_filter: true
    fr_max_pos: 0.0002    # 0.02%: funding > æ­¤å€¼æ™‚ä¸åšå¤šï¼ˆå¤šé ­å¤ªæ“æ“ ï¼‰
    fr_max_neg: -0.0002   # -0.02%: funding < æ­¤å€¼æ™‚ä¸åšç©ºï¼ˆç©ºé ­å¤ªæ“æ“ ï¼‰
```

**æ•ˆæœ**ï¼šéæ¿¾æ¥µç«¯ funding rate çš„ä¿¡è™Ÿå¾Œï¼ŒBTC åšå¤šå‹ç‡æå‡ç´„ 5%ã€‚

**é…å¥— cronï¼ˆæ¯ 8 å°æ™‚æ›´æ–° Funding Rate æ•¸æ“šï¼‰**ï¼š
```bash
10 */8 * * * cd ~/quant-binance-spot && source .venv/bin/activate && python scripts/download_data.py -c config/futures_rsi_adx_atr.yaml --funding-rate >> logs/download_data.log 2>&1
```

### 15.4 é¢¨æ§åƒæ•¸å„ªåŒ–

é€é `scan_risk_params.py` ç¶²æ ¼æƒæ SL Ã— Cooldown çš„ç†±åŠ›åœ–ï¼Œæ‰¾åˆ°æœ€ä½³å¹³è¡¡é»ï¼š

| åƒæ•¸ | èˆŠå€¼ | æ–°å€¼ | åŸå›  |
|------|------|------|------|
| `stop_loss_atr` | 2.5 | **2.0** | æ›´å¿«æ­¢æï¼Œä¿è­·æœ¬é‡‘ |
| `cooldown_bars` | 5 | **3** | ç¸®çŸ­å†·å»æœŸï¼Œä¸éŒ¯éæ©Ÿæœƒ |

```bash
# è‡ªè¡Œæƒæ
python scripts/scan_risk_params.py -c config/futures_rsi_adx_atr.yaml
```

---

## åŸ·è¡Œå„ªåŒ–ï¼šMaker å„ªå…ˆä¸‹å–® â­ v3.0

### 16.1 å•é¡Œï¼šTaker æ‰‹çºŒè²»é«˜

Binance Futures æ‰‹çºŒè²»ï¼š
- Takerï¼ˆå¸‚åƒ¹å–®ï¼‰ï¼š**0.04%**
- Makerï¼ˆé™åƒ¹å–®ï¼‰ï¼š**0.02%**ï¼ˆç”šè‡³å¯èƒ½æœ‰è¿”ä½£ï¼‰

æ¯ç­†äº¤æ˜“çœ 0.02%ï¼Œä¸€å¹´ä¸‹ä¾†äº¤æ˜“é »ç¹çš„ç­–ç•¥å¯çœ **2-4% å¹´åŒ–æ”¶ç›Š**ã€‚

### 16.2 Smart Order æ©Ÿåˆ¶

```
ç­–ç•¥è§¸ç™¼ä¸‹å–®
    â†“
æ›é™åƒ¹å–® (Maker) @ æœ€ä½³è²·/è³£åƒ¹
    â†“
ç­‰å¾… 10 ç§’
    â†“
â”Œâ”€ å·²æˆäº¤ï¼Ÿ â†’ âœ… å®Œæˆï¼ˆçœäº† 0.02%ï¼‰
â””â”€ æœªæˆäº¤ï¼Ÿ â†’ æ’¤å–® â†’ æ”¹å¸‚åƒ¹å–® (Taker) â†’ ç¢ºä¿æˆäº¤
```

### 16.3 é…ç½®

```yaml
live:
  prefer_limit_order: true    # å•Ÿç”¨ Maker å„ªå…ˆ
  limit_order_timeout_s: 10   # ç­‰å¾…ç§’æ•¸ï¼ˆè¶…æ™‚æ”¹å¸‚åƒ¹å–®ï¼‰
```

> ğŸ’¡ ä¸éœ€è¦æ”¹ç­–ç•¥ä»£ç¢¼ï¼Œç³»çµ±åœ¨ Broker å±¤è‡ªå‹•è™•ç†ã€‚Paper Trading ä¸å—å½±éŸ¿ã€‚

---

## WebSocket äº‹ä»¶é©…å‹• â­ v3.0

### 17.1 Polling vs WebSocket

| ç‰¹æ€§ | Pollingï¼ˆcronï¼‰ | WebSocket |
|------|----------------|-----------|
| å»¶é² | ~5 åˆ†é˜ | **< 1 ç§’** |
| è§¸ç™¼æ–¹å¼ | å®šæ™‚ï¼ˆæ¯å°æ™‚ç¬¬ 5 åˆ†ï¼‰ | K ç·šæ”¶ç›¤ç¬é–“ |
| è¨˜æ†¶é«” | ~200MBï¼ˆæ¯æ¬¡è¼‰å…¥ vectorbtï¼‰ | **~50MB**ï¼ˆåªä¿ç•™ 300 barï¼‰ |
| é©åˆ | ä½é »ç­–ç•¥ã€å¤šç­–ç•¥ | å°å»¶é²æ•æ„Ÿçš„ç­–ç•¥ |

### 17.2 å•Ÿå‹•æ–¹å¼

```bash
# 1. é…ç½® Swapï¼ˆOracle Cloud 1GB RAM å¿…å‚™ï¼Œåªéœ€è·‘ä¸€æ¬¡ï¼‰
bash scripts/setup_swap.sh

# 2. ç”¨ tmux èƒŒæ™¯å•Ÿå‹•ï¼ˆå«è‡ªå‹•é‡å•Ÿï¼‰
tmux kill-session -t trading 2>/dev/null
tmux new -d -s trading 'while true; do
  cd ~/quant-binance-spot && source .venv/bin/activate && git pull &&
  PYTHONPATH=src python scripts/run_websocket.py -c config/futures_rsi_adx_atr.yaml --real;
  echo "âš ï¸ Runner é€€å‡ºï¼Œ10ç§’å¾Œè‡ªå‹•é‡å•Ÿ..."; sleep 10;
done'

# 3. æª¢æŸ¥ç‹€æ…‹
sleep 10 && tmux capture-pane -t trading -p | tail -20
```

### 17.3 æ—¥å¸¸ç®¡ç†

```bash
# æŸ¥çœ‹å³æ™‚ log
tmux attach -t trading
# (Ctrl+B ç„¶å¾Œ D é›¢é–‹ï¼Œç¨‹å¼ç¹¼çºŒè·‘)

# ä¸é€² tmuxï¼Œç›´æ¥çœ‹æœ€è¿‘ log
tmux capture-pane -t trading -p | tail -50

# é‡å•Ÿ
tmux kill-session -t trading
# ç„¶å¾Œé‡æ–°åŸ·è¡Œä¸Šæ–¹ tmux new æŒ‡ä»¤
```

### 17.4 æ³¨æ„äº‹é …

- âš ï¸ **WebSocket å’Œ Cron ä¸å¯åŒæ™‚ä½¿ç”¨**ã€‚ç”¨ WebSocket æ™‚è¦æŠŠ cron è£¡çš„ `run_live.py` è¨»è§£æ‰
- âœ… Funding Rate ä¸‹è¼‰çš„ cron è¦ä¿ç•™ï¼ˆWebSocket ä¸è² è²¬ä¸‹è¼‰æ•¸æ“šï¼‰
- âœ… å¥åº·æª¢æŸ¥ã€æ—¥å ±ã€Telegram Bot ç­‰ cron ä¸å—å½±éŸ¿
- âœ… ä½¿ç”¨ç›¸åŒçš„ Brokerã€ç­–ç•¥ã€ä¿¡è™Ÿç”Ÿæˆé‚è¼¯ï¼Œè¡Œç‚ºèˆ‡ Polling æ¨¡å¼ä¸€è‡´

### 17.5 æ¶æ§‹ï¼ˆOracle Cloud 1GB RAM å¯è·‘ï¼‰

```
WebSocketRunner (ç¹¼æ‰¿ BaseRunner)
â”œâ”€â”€ BaseRunner æä¾›ï¼š
â”‚   â”œâ”€â”€ 14 å€‹å…±äº«å®‰å…¨æ©Ÿåˆ¶ï¼ˆç†”æ–·/Adaptive SL/å€‰ä½è¨ˆç®—/é˜²éœ‡ç›ª/...ï¼‰
â”‚   â”œâ”€â”€ SignalResult dataclassï¼ˆå‹åˆ¥å®‰å…¨ä¿¡è™Ÿå‚³éï¼‰
â”‚   â””â”€â”€ SL/TP ç®¡ç†ã€Telegram é€šçŸ¥ã€æ—¥èªŒè¨˜éŒ„
â”œâ”€â”€ WebSocketRunner è² è²¬ï¼š
â”‚   â”œâ”€â”€ é€£ç·š Binance Futures WebSocket
â”‚   â”‚   â””â”€â”€ è¨‚é–± ethusdt@kline_1h, solusdt@kline_1h
â”‚   â”œâ”€â”€ Rolling DataFrameï¼ˆæ¯å¹£ 365 æ ¹ K ç·šï¼Œ~1MBï¼‰
â”‚   â””â”€â”€ K ç·šæ”¶ç›¤äº‹ä»¶ â†’ å‘¼å« BaseRunner å…±ç”¨é‚è¼¯
â””â”€â”€ è¨˜æ†¶é«”ï¼š~50MBï¼ˆä¸è¼‰å…¥ vectorbtï¼‰
```

---

## SQLite äº¤æ˜“è³‡æ–™åº« â­ v3.0

### 18.1 ç‚ºä»€éº¼éœ€è¦ï¼Ÿ

ä¹‹å‰çš„äº¤æ˜“ç´€éŒ„æ•£è½åœ¨ log æ–‡ä»¶å’Œ JSON ä¸­ï¼Œé›£ä»¥åˆ†æã€‚ç¾åœ¨ç”¨ SQLite çµæ§‹åŒ–å„²å­˜ï¼š

| è¡¨ | å…§å®¹ | ç”¨é€” |
|----|------|------|
| `trades` | æ¯ç­†äº¤æ˜“æ˜ç´°ï¼ˆåƒ¹æ ¼ã€æ•¸é‡ã€PnLã€æ‰‹çºŒè²»ã€æ˜¯å¦ Makerï¼‰ | ç¸¾æ•ˆåˆ†æ |
| `signals` | æ¯æ¬¡ä¿¡è™Ÿå¿«ç…§ï¼ˆRSIã€ADXã€ç›®æ¨™å€‰ä½ï¼‰ | ç­–ç•¥è¨ºæ–· |
| `daily_equity` | æ¯æ—¥æ¬Šç›Šå¿«ç…§ | è³‡é‡‘æ›²ç·š |

### 18.2 æŸ¥è©¢å·¥å…·

```bash
# ç¸¾æ•ˆç¸½è¦½
python scripts/query_db.py -c config/futures_rsi_adx_atr.yaml summary

# æœ€è¿‘ 20 ç­†äº¤æ˜“
python scripts/query_db.py -c config/futures_rsi_adx_atr.yaml trades --limit 20

# ä¿¡è™Ÿç´€éŒ„
python scripts/query_db.py -c config/futures_rsi_adx_atr.yaml signals --limit 10

# åŒ¯å‡º CSV
python scripts/query_db.py -c config/futures_rsi_adx_atr.yaml export

# å£“ç¸®è³‡æ–™åº«ï¼ˆæ¸…ç†ç©ºé–“ï¼‰
python scripts/query_db.py -c config/futures_rsi_adx_atr.yaml compact
```

### 18.3 ç¯„ä¾‹è¼¸å‡º

```
============================================================
  ğŸ“Š äº¤æ˜“ç¸¾æ•ˆç¸½è¦½
============================================================
  ç¸½äº¤æ˜“ç­†æ•¸:     47
  å‹åˆ©:           28
  è™§æ:           19
  å‹ç‡:           59.6%
  ç¸½ PnL:         $+312.50
  å¹³å‡ PnL:       $+6.65
  æœ€ä½³äº¤æ˜“:       $+89.30
  æœ€å·®äº¤æ˜“:       $-45.20
  ç¸½æ‰‹çºŒè²»:       $18.80
------------------------------------------------------------
  Maker æˆäº¤æ¯”ä¾‹: 72.3%
  Maker çœä¸‹è²»ç”¨: $6.42
============================================================
```

### 18.4 è³‡æ–™åº«ä½ç½®

```
reports/futures/rsi_adx_atr/live/trading.db
```

è³‡æ–™åº«æœƒåœ¨**é¦–æ¬¡å¯¦ç›¤äº¤æ˜“æ™‚è‡ªå‹•å»ºç«‹**ï¼Œä¸éœ€è¦æ‰‹å‹•åˆå§‹åŒ–ã€‚

---

## æ³¢å‹•ç‡éæ¿¾ + HTF è»Ÿè¶¨å‹¢éæ¿¾ â­ v3.1

### 19.1 æ³¢å‹•ç‡éæ¿¾å™¨ï¼ˆVolatility Filterï¼‰

**å•é¡Œ**ï¼šä½æ³¢å‹•æœŸé–“ï¼ˆéœ‡ç›ªå¸‚ï¼‰é »ç¹äº¤æ˜“ï¼Œæ‰‹çºŒè²»åƒæ‰åˆ©æ½¤ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šç•¶ ATR/Price ä½æ–¼é–¾å€¼æ™‚ï¼Œä¸é–‹æ–°å€‰ï¼š

```yaml
strategy:
  params:
    min_atr_ratio: 0.005         # ATR/Price < 0.5% æ™‚ä¸é–‹å€‰
    vol_filter_mode: "absolute"  # "absolute"ï¼ˆå›ºå®šé–¾å€¼ï¼‰æˆ– "percentile"ï¼ˆç™¾åˆ†ä½ï¼‰
```

**æ¨¡å¼èªªæ˜**ï¼š

| æ¨¡å¼ | é‚è¼¯ | é©åˆ |
|------|------|------|
| `absolute` | ATR/Price < `min_atr_ratio` â†’ ä¸é–‹å€‰ | é€šç”¨ï¼Œæ¨è–¦ |
| `percentile` | ATR æ’å < `min_percentile`% â†’ ä¸é–‹å€‰ | è‡ªé©æ‡‰ |

**æ•ˆæœ**ï¼šå›æ¸¬é¡¯ç¤ºéæ¿¾ä½æ³¢å‹•å¾Œ Sharpe æ˜é¡¯æå‡ï¼Œå› ç‚ºæ¸›å°‘äº†ç„¡æ•ˆäº¤æ˜“å’Œæ‰‹çºŒè²»æ¶ˆè€—ã€‚

### 19.2 HTF è»Ÿè¶¨å‹¢éæ¿¾ï¼ˆSoft Trend Filterï¼‰

**å•é¡Œ**ï¼šèˆŠç‰ˆ HTF éæ¿¾æ˜¯äºŒå…ƒé–˜é–€ï¼ˆé †è¶¨å‹¢å…¨éã€é€†è¶¨å‹¢å…¨æ“‹ï¼‰ï¼Œå°è‡´æ¼æ‰é€†è¶¨å‹¢çš„å¥½æ©Ÿæœƒã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šç”¨**é€£çºŒæ¬Šé‡**å–ä»£äºŒå…ƒé–˜é–€ï¼š

```yaml
strategy:
  params:
    htf_interval: "4h"            # é«˜æ™‚é–“æ¡†æ¶
    htf_mode: "soft"              # "soft"ï¼ˆæ¨è–¦ï¼‰æˆ– "hard"ï¼ˆäºŒå…ƒé–˜é–€ï¼‰
    htf_ema_fast: 20              # å¿«é€Ÿ EMA
    htf_ema_slow: 50              # æ…¢é€Ÿ EMA
    htf_align_weight: 1.0         # é †è¶¨å‹¢ï¼šå…¨å€‰
    htf_counter_weight: 0.5       # é€†è¶¨å‹¢ï¼šåŠå€‰
    htf_neutral_weight: 0.75      # ç„¡è¶¨å‹¢ï¼š75%
```

**æ¬Šé‡é‚è¼¯**ï¼š

| æƒ…å¢ƒ | èˆ‰ä¾‹ | æ¬Šé‡ | æ•ˆæœ |
|------|------|:----:|------|
| é †è¶¨å‹¢ | åšå¤š + HTF ä¸Šå‡ | 1.0 | å…¨å€‰é–‹å…¥ |
| é€†è¶¨å‹¢ | åšå¤š + HTF ä¸‹é™ | 0.5 | åŠå€‰é–‹å…¥ |
| ç„¡è¶¨å‹¢ | HTF æŒå¹³ | 0.75 | 75% å€‰ä½ |

> ğŸ’¡ **soft æ¨¡å¼çš„å„ªé»**ï¼šä¸æœƒå®Œå…¨éŒ¯éé€†è¶¨å‹¢çš„äº¤æ˜“æ©Ÿæœƒï¼Œè€Œæ˜¯é™ä½æ›éšªã€‚å·²æœ‰æŒå€‰ä¸å—å½±éŸ¿ï¼Œåªèª¿æ•´æ–°é–‹å€‰çš„å€‰ä½å¤§å°ã€‚

**HTF å±¤ç´šå»ºè­°**ï¼š

| ç•¶å‰é€±æœŸ | HTF å»ºè­° |
|----------|---------|
| 15m | 1h |
| 1h | 4h |
| 4h | 1d |

### 19.3 ç‹€æ…‹æ©Ÿä¿®å¾©

v3.1 ä¿®å¾©äº†ç­–ç•¥ç‹€æ…‹æ©Ÿçš„ä¸€å€‹é‡è¦å•é¡Œï¼š**å¹³å€‰å¾Œç›´æ¥åæ‰‹**ã€‚

**èˆŠè¡Œç‚º**ï¼ˆæœ‰å•é¡Œï¼‰ï¼š
```
æŒæœ‰å¤šå€‰ â†’ ç©ºé ­å‡ºå ´ä¿¡è™Ÿè§¸ç™¼ â†’ ç«‹å³é–‹ç©ºå€‰
```

**æ–°è¡Œç‚º**ï¼ˆä¿®å¾©å¾Œï¼‰ï¼š
```
æŒæœ‰å¤šå€‰ â†’ å‡ºå ´ä¿¡è™Ÿè§¸ç™¼ â†’ å›åˆ° Flatï¼ˆç©ºå€‰ï¼‰â†’ cooldown â†’ æ–°çš„å…¥å ´ä¿¡è™Ÿ â†’ é–‹å€‰
```

é€™å€‹ä¿®å¾©ç¢ºä¿æ¯æ¬¡å‡ºå ´å¾Œéƒ½ç¶“é cooldown å†·å»æœŸï¼Œé¿å…é »ç¹åæ‰‹é€ æˆçš„æ»‘é»å’Œæ‰‹çºŒè²»æå¤±ã€‚

---

## æ³¢å‹•ç‡ç›®æ¨™å€‰ä½ç®¡ç† â­ v3.1

### 20.1 å•é¡Œï¼šå›ºå®šå€‰ä½çš„ç¼ºé™·

å›ºå®šå€‰ä½ï¼ˆ`method: "fixed"`ï¼‰ä¸è€ƒæ…®å¸‚å ´æ³¢å‹•ç‡ï¼š
- é«˜æ³¢å‹•æœŸï¼šå€‰ä½ä¸è®Šï¼Œé¢¨éšªéå¤§
- ä½æ³¢å‹•æœŸï¼šå€‰ä½ä¸è®Šï¼Œè³‡é‡‘æ•ˆç‡ä½

### 20.2 è§£æ±ºæ–¹æ¡ˆï¼šæ³¢å‹•ç‡ç›®æ¨™ï¼ˆVolatility Targetingï¼‰

æ ¹æ“š**ç›®æ¨™å¹´åŒ–æ³¢å‹•ç‡**è‡ªå‹•èª¿æ•´å€‰ä½å¤§å°ï¼š

```yaml
position_sizing:
  method: "volatility"       # å•Ÿç”¨æ³¢å‹•ç‡ç›®æ¨™
  target_volatility: 1.00    # ç›®æ¨™å¹´åŒ–æ³¢å‹•ç‡ 100%ï¼ˆå…¨å€‰ä½ï¼‰
  vol_lookback: 168          # è¨ˆç®—æ³¢å‹•ç‡çš„å›çœ‹æœŸï¼ˆ168 bars = 7 å¤© @ 1hï¼‰
```

**åŸç†**ï¼š
```
èª¿æ•´å› å­ = target_volatility / current_volatility

å¦‚æœç•¶å‰å¹´åŒ–æ³¢å‹•ç‡ = 200%ï¼Œç›®æ¨™ = 100%
â†’ èª¿æ•´å› å­ = 100% / 200% = 0.5
â†’ åŸå§‹ä¿¡è™Ÿ 1.0 â†’ èª¿æ•´å¾Œ 0.5ï¼ˆåŠå€‰ï¼‰

å¦‚æœç•¶å‰å¹´åŒ–æ³¢å‹•ç‡ = 50%ï¼Œç›®æ¨™ = 100%
â†’ èª¿æ•´å› å­ = 100% / 50% = 2.0ï¼ˆä¸Šé™ capï¼‰
â†’ åŸå§‹ä¿¡è™Ÿ 1.0 â†’ èª¿æ•´å¾Œ 1.0ï¼ˆå…¨å€‰ï¼Œä¸è¶…éæ§“æ¡¿ä¸Šé™ï¼‰
```

**èª¿æ•´å› å­ä¸Šä¸‹é™**ï¼š`[0.1, 2.0]`ï¼Œé¿å…æ¥µç«¯å€‰ä½ã€‚

### 20.3 ä¸‰ç¨®å€‰ä½ç®¡ç†æ¯”è¼ƒ

| æ–¹æ³• | ç‰¹é» | é©åˆ |
|------|------|------|
| `fixed` | å›ºå®šæ¯”ä¾‹ï¼Œç°¡å–® | æ–°æ‰‹ã€å°è³‡é‡‘ |
| `kelly` | åŸºæ–¼å‹ç‡/ç›ˆè™§æ¯”ï¼Œæ•¸å­¸æœ€å„ª | ç©©å®šç­–ç•¥ã€å……è¶³æ­·å² |
| `volatility` | åŸºæ–¼å¸‚å ´æ³¢å‹•ç‡ï¼Œå‹•æ…‹èª¿æ•´ | â­ **æ¨è–¦**ï¼Œå¹³è¡¡é¢¨éšª |

### 20.4 ä¸åŒæ™‚é–“æ¡†æ¶çš„ vol_lookback

| æ™‚é–“æ¡†æ¶ | vol_lookback | ç­‰æ•ˆå¤©æ•¸ |
|----------|:-----------:|:--------:|
| 15m | 672 | 7 å¤© |
| 1h | 168 | 7 å¤© |
| 4h | 42 | 7 å¤© |
| 1d | 20 | 20 å¤© |

---

## Alpha Decay ç›£æ§ â­ v3.1

### 21.1 ä»€éº¼æ˜¯ Alpha Decayï¼Ÿ

ç­–ç•¥çš„é æ¸¬èƒ½åŠ›ï¼ˆAlphaï¼‰æœƒéš¨æ™‚é–“è¡°æ¸›ã€‚æˆ‘å€‘ç”¨ **Information Coefficientï¼ˆICï¼‰** ä¾†é‡åŒ–ï¼š

| å¹´ä»½ | RSI IC | è¡°é€€ |
|------|:------:|:----:|
| 2023 | +0.065 | â€” |
| 2024 | +0.041 | -37% |
| 2025 | +0.025 | -62% |
| 2026 | +0.018 | -72% |

ç•¶ IC æ¥è¿‘ 0ï¼Œç­–ç•¥ä¿¡è™Ÿä¸å†æœ‰é æ¸¬åƒ¹å€¼ã€‚

### 21.2 IC ç›£æ§å·¥å…·

```bash
# åŸ·è¡Œ Alpha Decay ç›£æ§
python scripts/monitor_alpha_decay.py -c config/futures_rsi_adx_atr.yaml

# éœé»˜æ¨¡å¼ + Telegram é€šçŸ¥ï¼ˆç”¨æ–¼ cronï¼‰
python scripts/monitor_alpha_decay.py -c config/futures_rsi_adx_atr.yaml --quiet --notify

# æŒ‡å®šå‰ç»æœŸå’Œçª—å£
python scripts/monitor_alpha_decay.py -c config/futures_rsi_adx_atr.yaml --forward-bars 24 --window-days 180
```

**è¼¸å‡ºç¯„ä¾‹**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BTCUSDT  IC Analysis
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“Š æœ‰æ•ˆä¿¡è™Ÿ: 12,345 ç­† (68.5% æ´»èº)

  â”€â”€ å…¨å±€ IC â”€â”€
  Overall IC:     +0.0312  (p=0.0001)
  Average IC:     +0.0285
  IC IR:          0.450

  â”€â”€ Alpha Decay åµæ¸¬ â”€â”€
  Historical IC:  +0.0450
  Recent IC:      +0.0180
  IC è¡°é€€:        -60%  ğŸ”´

  â”€â”€ å¹´åº¦ IC â”€â”€
  2023: +0.0650  ğŸŸ¢ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  2024: +0.0410  ğŸŸ¢ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  2025: +0.0250  ğŸŸ¡ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
  2026: +0.0180  ğŸŸ¡ â–ˆâ–ˆâ–ˆ

  âœ… ç„¡è­¦å ±ï¼Œä¿¡è™Ÿå“è³ªæ­£å¸¸
```

### 21.3 è‡ªå‹•æ’ç¨‹

å»ºè­°æ¯é€±è·‘ä¸€æ¬¡ IC ç›£æ§ï¼š

```bash
# crontab -e
# æ¯é€±æ—¥ 01:00 UTC åŸ·è¡Œ Alpha Decay ç›£æ§
0 1 * * 0 cd ~/quant-binance-spot && source .venv/bin/activate && bash scripts/cron_alpha_monitor.sh >> logs/alpha_monitor.log 2>&1
```

### 21.4 è­¦å ±ç´šåˆ¥

| ç´šåˆ¥ | è§¸ç™¼æ¢ä»¶ | å»ºè­°è¡Œå‹• |
|------|---------|---------|
| ğŸš¨ CRITICAL | IC è¡°é€€ > 50% æˆ– Recent IC â‰ˆ 0 | è€ƒæ…®åœæ­¢ç­–ç•¥æˆ–åˆ‡æ›æ™‚é–“æ¡†æ¶ |
| âš ï¸ WARNING | IC IR < 0.3 æˆ– p-value > 0.05 | ç›£æ§ï¼Œæº–å‚™æ‡‰æ€¥æ–¹æ¡ˆ |
| â„¹ï¸ INFO | IC ä¸‹é™ä½†ä»é¡¯è‘— | æŒçºŒè§€å¯Ÿ |

### 21.5 JSON å ±å‘Š

æ¯æ¬¡åŸ·è¡Œæœƒä¿å­˜ JSON å ±å‘Šåˆ° `reports/alpha_decay/`ï¼š

```bash
ls reports/alpha_decay/
# ic_report_20260216_120000.json
```

å¯ç”¨æ–¼é•·æœŸè¿½è¹¤ IC è¶¨å‹¢ã€‚

---

## ç­–ç•¥çµ„åˆ Ensemble â­ v3.1

### 22.1 ç‚ºä»€éº¼è¦çµ„åˆç­–ç•¥ï¼Ÿ

å–®ä¸€ç­–ç•¥å®¹æ˜“å— Alpha Decay å½±éŸ¿ã€‚çµ„åˆ**ä½ç›¸é—œ**ç­–ç•¥å¯ä»¥ï¼š
- ğŸŸ¢ å¹³æ»‘è³‡é‡‘æ›²ç·šï¼ˆé™ä½æ³¢å‹•ï¼‰
- ğŸŸ¢ é™ä½ Max Drawdown
- ğŸŸ¢ æå‡ Sharpe Ratioï¼ˆåˆ†æ•£åŒ–æ•ˆæ‡‰ï¼‰

### 22.2 ç­–ç•¥ç›¸é—œæ€§åˆ†æ

å…ˆç”¨ç ”ç©¶è…³æœ¬æ‰¾å‡ºä½ç›¸é—œé…å°ï¼š

```bash
python scripts/research_strategy_correlation.py -c config/futures_rsi_adx_atr.yaml --symbol BTCUSDT
```

**è¼¸å‡º**ï¼š
```
ä¿¡è™Ÿæ–¹å‘ç›¸é—œæ€§çŸ©é™£ (Pearson)
                    rsi_adx_atr  macd_momentum  bb_mean_reversion
rsi_adx_atr              1.000          0.150             0.420
macd_momentum            0.150          1.000             0.380
bb_mean_reversion        0.420          0.380             1.000

ä½ç›¸é—œé…å° (|corr| < 0.3):
  rsi_adx_atr Ã— macd_momentum: corr=0.150 âœ…
```

### 22.3 ä½¿ç”¨ Ensemble ç­–ç•¥

```bash
# å›æ¸¬ Ensemble ç­–ç•¥
python scripts/run_backtest.py -c config/futures_ensemble.yaml

# Walk-Forward é©—è­‰
python scripts/run_walk_forward.py -c config/futures_ensemble.yaml --splits 6
```

**é…ç½®æª”**ï¼ˆ`config/futures_ensemble.yaml`ï¼‰ï¼š

```yaml
strategy:
  name: "ensemble_rsi_macd"
  params:
    strategy1_name: "rsi_adx_atr"
    strategy2_name: "macd_momentum"
    weight1: 0.5              # RSI ç­–ç•¥æ¬Šé‡ 50%
    weight2: 0.5              # MACD ç­–ç•¥æ¬Šé‡ 50%
    # ... å…±ç”¨éæ¿¾å™¨åƒæ•¸ï¼ˆèˆ‡ä¸»ç­–ç•¥ç›¸åŒï¼‰
```

### 22.4 çµ„åˆé‚è¼¯

```
RSI ä¿¡è™Ÿ:  +1.0 (åšå¤š)
MACD ä¿¡è™Ÿ: +0.5 (å¼±å¤š)
â†’ çµ„åˆä¿¡è™Ÿ = 0.5 Ã— 1.0 + 0.5 Ã— 0.5 = +0.75

RSI ä¿¡è™Ÿ:  +1.0 (åšå¤š)
MACD ä¿¡è™Ÿ: -1.0 (åšç©º)
â†’ çµ„åˆä¿¡è™Ÿ = 0.5 Ã— 1.0 + 0.5 Ã— (-1.0) = 0.0ï¼ˆè¡çª â†’ ä¸é–‹å€‰ï¼‰
```

> ğŸ’¡ **è‡ªç„¶é¿éšª**ï¼šç•¶å…©å€‹ç­–ç•¥ä¿¡è™Ÿè¡çªæ™‚ï¼Œçµ„åˆä¿¡è™Ÿè¶¨è¿‘ 0ï¼ˆä¸äº¤æ˜“ï¼‰ï¼Œè‡ªå‹•é¿é–‹ä¸ç¢ºå®šçš„è¡Œæƒ…ã€‚

### 22.5 å¯ç”¨çš„å¤šæ™‚é–“æ¡†æ¶é…ç½®

| é…ç½®æª” | æ™‚é–“æ¡†æ¶ | HTF | ç”¨é€” |
|--------|:--------:|:---:|------|
| `futures_rsi_adx_atr.yaml` | 1h | 4h | â­ ä¸»åŠ› |
| `futures_rsi_adx_atr_15m.yaml` | 15m | 1h | é«˜é »ç ”ç©¶ |
| `futures_rsi_adx_atr_4h.yaml` | 4h | 1d | ä½é »ç ”ç©¶ |
| `futures_ensemble.yaml` | 1h | 4h | çµ„åˆç­–ç•¥ |

---

## å®Œæ•´ç¯„ä¾‹ï¼šRSI ç­–ç•¥

è®“æˆ‘å€‘å®Œæ•´åœ°é–‹ç™¼ä¸€å€‹ RSI ç­–ç•¥ã€‚

### æ­¥é©Ÿ 1ï¼šå»ºç«‹ç­–ç•¥æª”æ¡ˆ

å»ºç«‹ `src/qtrade/strategy/my_rsi_strategy.py`ï¼š

```python
"""
RSI è¶…è²·è¶…è³£ç­–ç•¥

ç­–ç•¥é‚è¼¯ï¼š
- RSI < 30ï¼šè²·å…¥
- RSI > 70ï¼šè³£å‡º
"""
from __future__ import annotations
import pandas as pd
from .base import StrategyContext
from . import register_strategy
from ..indicators import calculate_rsi


@register_strategy("my_rsi_strategy")
def generate_positions(df: pd.DataFrame, ctx: StrategyContext, params: dict) -> pd.Series:
    period = params.get("period", 14)
    oversold = params.get("oversold", 30)
    overbought = params.get("overbought", 70)
    
    close = df["close"]
    rsi = calculate_rsi(close, period=period)
    
    pos = pd.Series(0.0, index=df.index)
    pos[rsi < oversold] = 1.0  # è¶…è³£è²·å…¥
    pos[rsi > overbought] = 0.0  # è¶…è²·è³£å‡º
    
    # é¿å…æœªä¾†è³‡è¨Šæ´©æ¼
    pos = pos.shift(1).fillna(0.0)
    
    return pos
```

### æ­¥é©Ÿ 2ï¼šè¨»å†Šç­–ç•¥

åœ¨ `src/qtrade/strategy/__init__.py` ä¸­æ–°å¢ï¼š

```python
from . import my_rsi_strategy  # noqa: E402
```

### æ­¥é©Ÿ 3ï¼šè¨­å®šç­–ç•¥ï¼ˆâ­ é‡è¦ï¼ï¼‰

**é€™æ˜¯é—œéµæ­¥é©Ÿ**ï¼šå›æ¸¬è…³æœ¬æœƒè®€å–è¨­å®šæª”ä¾†ç¢ºå®šä½¿ç”¨å“ªå€‹ç­–ç•¥ã€‚

ç·¨è¼¯ `config/base.yaml` æª”æ¡ˆï¼š

```yaml
strategy:
  name: "my_rsi_strategy"  # âš ï¸ å¿…é ˆèˆ‡ @register_strategy("my_rsi_strategy") ä¸­çš„åç¨±å®Œå…¨ä¸€è‡´
  params:
    period: 14
    oversold: 30
    overbought: 70
```

**é‹ä½œåŸç†**ï¼š
1. ç•¶ä½ åŸ·è¡Œ `python scripts/run_backtest.py` æ™‚
2. è…³æœ¬æœƒè®€å– `config/base.yaml` æª”æ¡ˆ
3. æ ¹æ“š `strategy.name` æ‰¾åˆ°å°æ‡‰çš„ç­–ç•¥å‡½å¼ï¼ˆé€é `@register_strategy` è¨»å†Šçš„ï¼‰
4. ä½¿ç”¨ `strategy.params` ä¸­çš„åƒæ•¸åŸ·è¡Œç­–ç•¥
5. å°è¨­å®šä¸­çš„æ‰€æœ‰äº¤æ˜“å°é€²è¡Œå›æ¸¬

**å¦‚ä½•åˆ‡æ›ç­–ç•¥ï¼Ÿ**
åªéœ€è¦ä¿®æ”¹è¨­å®šæª”ï¼Œç„¡éœ€ä¿®æ”¹ç¨‹å¼ç¢¼ï¼š
```yaml
strategy:
  name: "ema_cross"  # åˆ‡æ›åˆ° EMA äº¤å‰ç­–ç•¥
  params:
    fast: 20
    slow: 60
```

**å¦‚æœç­–ç•¥åç¨±éŒ¯èª¤æœƒæ€æ¨£ï¼Ÿ**
æœƒå ±éŒ¯ä¸¦é¡¯ç¤ºæ‰€æœ‰å¯ç”¨çš„ç­–ç•¥ï¼š
```
ValueError: Strategy 'wrong_name' not found. 
Available: ['ema_cross', 'rsi', 'my_rsi_strategy', ...]
```

### æ­¥é©Ÿ 4ï¼šä¸‹è¼‰è³‡æ–™

```bash
python scripts/download_data.py --symbol BTCUSDT --interval 1h --start 2022-01-01
```

### æ­¥é©Ÿ 5ï¼šåŸ·è¡Œå›æ¸¬

```bash
python scripts/run_backtest.py
```

### æ­¥é©Ÿ 6ï¼šæŸ¥çœ‹çµæœ

æŸ¥çœ‹ `reports/spot/{strategy}/backtest/{timestamp}/` ç›®éŒ„ä¸‹çš„ `stats_BTCUSDT.csv` å’Œ `equity_curve_BTCUSDT.png`

### æ­¥é©Ÿ 7ï¼šå„ªåŒ–åƒæ•¸

```bash
python scripts/optimize_params.py --strategy my_rsi_strategy --metric "Sharpe Ratio"
```

### æ­¥é©Ÿ 8ï¼šé©—è­‰ç­–ç•¥

```bash
# æ¨™æº–é©—è­‰å¥—ä»¶
python scripts/validate.py -c config/rsi_adx_atr.yaml

# åªåŸ·è¡Œ Kelly é©—è­‰
python scripts/validate.py -c config/rsi_adx_atr.yaml --only kelly
```

### æ­¥é©Ÿ 9ï¼šPaper Trading

```bash
# å•Ÿå‹•æ¨¡æ“¬äº¤æ˜“
python scripts/run_live.py -c config/base.yaml --paper --once

# æŸ¥çœ‹ç‹€æ…‹
python scripts/run_live.py -c config/base.yaml --status
```

### æ­¥é©Ÿ 10ï¼šå¦‚æœçµæœå¥½ï¼Œå¯ä»¥å¯¦ç›¤

å¦‚æœé©—è­‰é€šéä¸” Paper Trading è¡¨ç¾è‰¯å¥½ï¼Œå¯ä»¥è€ƒæ…®å¯¦ç›¤äº¤æ˜“ã€‚

---

## å¸¸è¦‹å•é¡Œ

### Q1: ç­–ç•¥ç¸½æ˜¯è™§ææ€éº¼è¾¦ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
1. ç­–ç•¥é‚è¼¯æœ‰å•é¡Œ
2. åƒæ•¸ä¸åˆé©
3. å¸‚å ´ç’°å¢ƒä¸é©åˆè©²ç­–ç•¥

**è§£æ±ºæ–¹æ³•**ï¼š
1. æª¢æŸ¥è¨Šè™Ÿæ˜¯å¦åˆç†ï¼ˆæŸ¥çœ‹è³‡é‡‘æ›²ç·šåœ–ï¼‰
2. å˜—è©¦ä¸åŒåƒæ•¸
3. å˜—è©¦ä¸åŒäº¤æ˜“å°
4. ç°¡åŒ–ç­–ç•¥é‚è¼¯

### Q2: å›æ¸¬çµæœå¾ˆå¥½ï¼Œä½†é©—è­‰å¤±æ•—ï¼Ÿ

**é€™æ˜¯éæ“¬åˆçš„å…¸å‹è¡¨ç¾**ã€‚

**è§£æ±ºæ–¹æ³•**ï¼š
1. ç°¡åŒ–ç­–ç•¥
2. æ¸›å°‘åƒæ•¸
3. ä½¿ç”¨æ›´ä¿å®ˆçš„åƒæ•¸
4. å¢åŠ æ›´å¤šæ­·å²è³‡æ–™

### Q3: å¦‚ä½•é¸æ“‡å„ªåŒ–æŒ‡æ¨™ï¼Ÿ

**æ¨è–¦é †åº**ï¼š
1. **å¤æ™®æ¯”ç‡**ï¼šç¶œåˆè€ƒæ…®æ”¶ç›Šå’Œé¢¨éšª
2. **ç¸½æ”¶ç›Šç‡**ï¼šå¦‚æœé¢¨éšªå¯æ§
3. **æœ€å¤§å›æ’¤**ï¼šå¦‚æœé¢¨éšªæ‰¿å—èƒ½åŠ›ä½

### Q4: ç­–ç•¥åœ¨æŸå€‹äº¤æ˜“å°ä¸Šè¡¨ç¾å¥½ï¼Œå¦ä¸€å€‹ä¸å¥½ï¼Ÿ

**é€™æ˜¯æ­£å¸¸çš„**ï¼Œä¸åŒè³‡ç”¢æœ‰ä¸åŒçš„ç‰¹æ€§ã€‚

**è§£æ±ºæ–¹æ³•**ï¼š
1. ç‚ºä¸åŒè³‡ç”¢ä½¿ç”¨ä¸åŒåƒæ•¸
2. ä½¿ç”¨ç­–ç•¥çµ„åˆ
3. åªäº¤æ˜“é©åˆè©²ç­–ç•¥çš„è³‡ç”¢

### Q5: Live å’Œ Backtest è¨Šè™Ÿä¸ä¸€è‡´ï¼Ÿ â­ NEW

**å¯èƒ½åŸå› **ï¼š
1. Look-ahead biasï¼ˆä½¿ç”¨äº†æœªä¾†è³‡è¨Šï¼‰
2. è³‡æ–™å°é½Šå•é¡Œ
3. å¯¦ä½œéŒ¯èª¤
4. **æ»‘å‹•çª—å£æ•¸æ“šå·®ç•°**ï¼ˆv2.8 å‰æœ€å¸¸è¦‹çš„åŸå› ï¼‰â†’ è¦‹ [Q10](#q10-å¯¦ç›¤ä¿¡è™Ÿè·Ÿå›æ¸¬ä¸ä¸€è‡´é »ç¹ç¿»è½‰-v28)

**è§£æ±ºæ–¹æ³•**ï¼š
```bash
# åŸ·è¡Œä¸€è‡´æ€§é©—è­‰æ‰¾å‡ºå•é¡Œ
python scripts/validate.py -c config/rsi_adx_atr.yaml --only consistency

# v2.8: ç¢ºèªå¢é‡å¿«å–å·²å•Ÿç”¨
grep "kline_cache" config/futures_rsi_adx_atr.yaml
```

### Q6: Kelly å»ºè­°ä¸ä½¿ç”¨æ€éº¼è¾¦ï¼Ÿ â­ NEW

**å¯èƒ½åŸå› **ï¼š
1. å‹ç‡å¤ªä½ï¼ˆ< 40%ï¼‰
2. ç›ˆè™§æ¯”å¤ªå·®ï¼ˆ< 1.0ï¼‰
3. äº¤æ˜“æ¬¡æ•¸å¤ªå°‘ï¼ˆ< 30 ç­†ï¼‰
4. çµ±è¨ˆä¸ç©©å®š

**è§£æ±ºæ–¹æ³•**ï¼š
1. æš«æ™‚ä½¿ç”¨å›ºå®šå€‰ä½
2. ç´¯ç©æ›´å¤šäº¤æ˜“è³‡æ–™å¾Œå†è©•ä¼°
3. å„ªåŒ–ç­–ç•¥æé«˜å‹ç‡å’Œç›ˆè™§æ¯”

### Q7: æ§“æ¡¿åŠ å¤§ä½†å€‰ä½æ²’è®Šå¤§ï¼Ÿ â­ NEW

**é€™æ˜¯æ­£ç¢ºè¡Œç‚ºï¼** æ§“æ¡¿åªå½±éŸ¿ä¿è­‰é‡‘éœ€æ±‚ï¼Œä¸å½±éŸ¿å€‰ä½åç¾©åƒ¹å€¼ã€‚

```
5x æ§“æ¡¿ã€å€‰ä½ $1,000 â†’ ä¿è­‰é‡‘ = $200
10x æ§“æ¡¿ã€å€‰ä½ $1,000 â†’ ä¿è­‰é‡‘ = $100  â† ä¿è­‰é‡‘è®Šå°‘ï¼Œå€‰ä½ä¸è®Š
```

å¦‚æœä½ æƒ³åŠ å¤§å€‰ä½ï¼Œèª¿æ•´ `portfolio.allocation`ï¼š

```yaml
portfolio:
  allocation:
    BTCUSDT: 0.50  # 50% æ¬Šç›Š â†’ æ”¹æˆ 1.00 â†’ 100% æ¬Šç›Šï¼Œå€‰ä½ç¿»å€
```

è©³è¦‹ [Â§10.12 å¤šå¹£ç¨®å€‰ä½åˆ†é…](#1012-å¤šå¹£ç¨®å€‰ä½åˆ†é…--new)ã€‚

### Q8: ç‚ºä»€éº¼å‡ºç¾é‡è¤‡çš„ SL/TP æ›å–®ï¼Ÿ â­ NEW

**èˆŠç‰ˆæœ¬å·²çŸ¥å•é¡Œï¼Œå·²ä¿®å¾©ã€‚** åŸå› æ˜¯ bot é‡å•Ÿå¾Œéºå¤±äº†æ›å–®è¨˜éŒ„ï¼Œæ¯æ¬¡ cron éƒ½é‡æ–°æ›ä¸€çµ„ã€‚

**ä¿®å¾©å¾Œçš„æ©Ÿåˆ¶**ï¼š
1. SL/TP è¨˜éŒ„æŒä¹…åŒ–åˆ° `algo_orders_cache.json`ï¼ˆé‡å•Ÿä¸ä¸Ÿå¤±ï¼‰
2. æ›å–®å‰æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸è¿‘è§¸ç™¼åƒ¹çš„æ›å–®ï¼ˆ0.2% å®¹å·®ï¼‰
3. å¹³å€‰æ™‚è‡ªå‹•å–æ¶ˆæ‰€æœ‰ SL + TP ä¸¦æ¸…ç†å¿«å–

å¦‚æœä½ åœ¨ Binance çœ‹åˆ°å¤šé¤˜çš„èˆŠæ›å–®ï¼Œæ‰‹å‹•å–æ¶ˆå³å¯ï¼Œä¸‹æ¬¡ cron æœƒæ ¹æ“šç•¶å‰æŒå€‰è‡ªå‹•è£œæ›æ­£ç¢ºçš„ã€‚

### Q9: ä¿¡è™Ÿé¡¯ç¤º 100% ä½†å¯¦éš›å€‰ä½åªæœ‰ 32%ï¼Ÿ â­ NEW

**å¯èƒ½åŸå› **ï¼š
1. **å‰›é–‹å€‰**ï¼Œä¸‹ä¸€è¼ª cron æœƒåŠ å€‰åˆ°ç›®æ¨™ï¼ˆå¡«å……ç‡ < 80% æ‰æœƒåŠ å€‰ï¼‰
2. **`allocation` è¨­å®šå¤ªä½**ï¼Œå€‰ä½ä¸æœƒè¶…éåˆ†é…æ¯”ä¾‹

**è§£æ±ºæ–¹æ³•**ï¼š
1. ç­‰ä¸‹ä¸€è¼ª cron åŸ·è¡Œï¼ˆæ¯å°æ™‚ç¬¬ 5 åˆ†é˜ï¼‰
2. æª¢æŸ¥ `config.yaml` çš„ `portfolio.allocation` è¨­å®šï¼š

```yaml
# å¦‚æœä½ æƒ³è®“ä¿¡è™Ÿ 100% å°æ‡‰å…¨éƒ¨æ¬Šç›Š
portfolio:
  cash_reserve: 0
  allocation:
    ETHUSDT: 1.00  # 100% æ¬Šç›Š
    SOLUSDT: 1.00
```

### Q10: å¯¦ç›¤ä¿¡è™Ÿè·Ÿå›æ¸¬ä¸ä¸€è‡´ï¼ˆé »ç¹ç¿»è½‰ï¼‰ï¼Ÿ â­ v2.8

**åŸå› **ï¼šç­–ç•¥æ˜¯ã€Œç‹€æ…‹æ©Ÿã€ï¼Œè¨ˆç®—çµæœä¾è³´èµ·å§‹ barã€‚å›æ¸¬ç”¨å®Œæ•´æ­·å²ï¼Œå¯¦ç›¤èˆŠç‰ˆæ¯æ¬¡åªæ‹‰æœ€è¿‘ 300 barï¼ˆæ»‘å‹•çª—å£ï¼‰ï¼Œçª—å£åç§» 1 bar å°±å¯èƒ½è®“ä¿¡è™Ÿç¿»è½‰ã€‚

**è§£æ±ºæ–¹æ³•**ï¼šå•Ÿç”¨å¢é‡ K ç·šå¿«å–ï¼ˆv2.8 é è¨­é–‹å•Ÿï¼‰ï¼š

```yaml
live:
  kline_cache: true         # å¿«å–æ•¸æ“šï¼Œç­–ç•¥å¾ bar 0 è·‘åˆ°æœ€æ–° bar
  flip_confirmation: false  # æ•¸æ“šç©©å®šå¾Œä¸éœ€è¦ç¢ºèª
```

è©³è¦‹ [Â§11 å¢é‡ K ç·šå¿«å–](#å¢é‡-k-ç·šå¿«å–)ã€‚

### Q11: `/signals` å’Œ cron ä¿¡è™Ÿä¸ä¸€è‡´ï¼Ÿ â­ v2.8

**åŸå› **ï¼šèˆŠç‰ˆ `/signals` å‘½ä»¤æœƒç¨ç«‹æ‹‰å– 300 bar æ•¸æ“šå³æ™‚è¨ˆç®—ï¼Œèˆ‡ cron æ‹‰å–çš„æ•¸æ“šå¯èƒ½æœ‰å¾®å°å·®ç•°ï¼ˆåç§» 1 barï¼‰ï¼Œå°è‡´ä¿¡è™Ÿä¸åŒã€‚

**ä¿®å¾©å¾Œçš„æ©Ÿåˆ¶**ï¼š
1. cron æ¯æ¬¡åŸ·è¡Œå¾Œï¼Œæœƒå°‡ä¿¡è™Ÿå¿«ç…§ä¿å­˜åˆ° `last_signals.json`
2. `/signals` å‘½ä»¤å„ªå…ˆè®€å–é€™å€‹å¿«ç…§ï¼Œ**ä¿è­‰èˆ‡ cron ä¿¡è™Ÿå®Œå…¨ä¸€è‡´**
3. å¿«ç…§é¡¯ç¤ºæ ¼å¼ç‚ºã€Œâ± X åˆ†é˜å‰ã€ï¼Œè¡¨ç¤ºæ˜¯å¿«å–çš„
4. è‹¥å¿«ç…§ä¸å­˜åœ¨æˆ–è¶…é 2 å°æ™‚ï¼Œæ‰ fallback åˆ°å³æ™‚ç”Ÿæˆï¼ˆä¹Ÿæœƒä½¿ç”¨å¢é‡å¿«å–æ•¸æ“šï¼‰

### Q12: ETH çš„ SL æ›ä¸ä¸Šä½† BTC å¯ä»¥ï¼Ÿ â­ NEW

**åŸå› **ï¼šBinance å°ä¸åŒäº¤æ˜“å°çš„æ¢ä»¶å–® API æ”¯æ´ä¸åŒã€‚éƒ¨åˆ†å¸³æˆ¶çš„ ETHUSDT æ¨™æº– API æœƒå›å‚³ `-4120` éŒ¯èª¤ã€‚

**ç³»çµ±å·²è‡ªå‹•è™•ç†**ï¼šåµæ¸¬åˆ° `-4120` å¾Œè‡ªå‹•é™ç´šåˆ° Algo Order APIã€‚å¦‚æœä½ åœ¨ log ä¸­çœ‹åˆ°ï¼š

```
âš ï¸ ETHUSDT: æ¨™æº– Order (STOP_MARKET) å¤±æ•—... -4120
âœ… ETHUSDT: æ¢ä»¶å–®å·²æ› via Algo Order API
```

é€™æ˜¯æ­£å¸¸çš„ï¼ŒSL/TP å·²æˆåŠŸæ›ä¸Šã€‚åªè¦æœ€å¾Œçœ‹åˆ° `âœ… æ¢ä»¶å–®å·²æ›` å°±æ²’å•é¡Œã€‚

**å¦å¤–**ï¼šå¦‚æœçœ‹åˆ° `algoOrder/openOrders` çš„ `404` è­¦å‘Šï¼Œé€™ä¹Ÿæ˜¯ç„¡å®³çš„â€”â€”è¡¨ç¤ºä½ çš„å¸³æˆ¶ä¸æ”¯æ´ Algo Order æŸ¥è©¢ APIï¼Œç³»çµ±æœƒè‡ªå‹•å›é€€åˆ°æ¨™æº–æ›å–® + æœ¬åœ°å¿«å–ã€‚

### Q13: `git pull` å¾Œ kline_cache æ²’æœ‰ç”Ÿæ•ˆï¼Ÿ â­ NEW

**ç—‡ç‹€**ï¼šæ›´æ–°ä»£ç¢¼åˆ° v2.8 å¾Œï¼Œlog è£¡çœ‹ä¸åˆ° `ğŸ“¦ å¢é‡ K ç·šå¿«å–å·²å•Ÿç”¨`ï¼Œä¸” `kline_cache/` ç›®éŒ„ä¸å­˜åœ¨ã€‚

**åŸå› **ï¼šPython çš„ `.pyc` ç·¨è­¯å¿«å–ã€‚`git pull` åªæ›´æ–° `.py` åŸå§‹ç¢¼ï¼Œä½† Python æœƒå„ªå…ˆè®€å– `__pycache__/` è£¡çš„èˆŠç‰ˆ `.pyc`ï¼Œå°è‡´æ–°åŠŸèƒ½ï¼ˆå¦‚ kline_cache åˆå§‹åŒ–ï¼‰**å®Œå…¨ä¸è¢«åŸ·è¡Œ**ã€‚

**è§£æ±ºæ–¹æ³•**ï¼š

```bash
# æ–¹æ³•ä¸€ï¼šç”¨éƒ¨ç½²è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
./scripts/setup_cron.sh --update

# æ–¹æ³•äºŒï¼šæ‰‹å‹•æ¸…é™¤
find . -name "*.pyc" -delete
find . -name "__pycache__" -exec rm -rf {} +
```

**é©—è­‰**ï¼š

```bash
# æ¸…é™¤å¾Œæ‰‹å‹•è§¸ç™¼ä¸€æ¬¡ï¼Œç¢ºèªå¿«å–ç”Ÿæ•ˆ
python scripts/run_live.py -c config/futures_rsi_adx_atr.yaml --real --dry-run --once 2>&1 | grep "å¢é‡"
# æ‡‰çœ‹åˆ°ï¼šğŸ“¦ å¢é‡ K ç·šå¿«å–å·²å•Ÿç”¨

# ä¸‹ä¸€æ¬¡ cron åŸ·è¡Œå¾Œæª¢æŸ¥å¿«å–æª”
ls -la reports/futures/rsi_adx_atr/live/kline_cache/
# æ‡‰çœ‹åˆ° ETHUSDT.parquet å’Œ SOLUSDT.parquet
```

> âš ï¸ **é»ƒé‡‘æ³•å‰‡**ï¼šæ¯æ¬¡ `git pull` å¾Œéƒ½åŸ·è¡Œ `./scripts/setup_cron.sh --update`ï¼Œé¤Šæˆç¿’æ…£å°±ä¸æœƒè¸©å‘ã€‚

### Q14: å›æ¸¬æ•¸æ“šæ¼‚äº®ä½†å¯¦ç›¤ä¸è¡Œï¼ˆã€Œå¿«æ¨‚è¡¨ã€ï¼‰ï¼Ÿ â­ NEW

**ç—‡ç‹€**ï¼šå›æ¸¬é¡¯ç¤ºé«˜ Sharpe / é«˜æ”¶ç›Šï¼Œä½†å¯¦éš›äº¤æ˜“è™§æã€‚

**å¸¸è¦‹åŸå› **ï¼š
1. **Funding Rate æœªé–‹å•Ÿ**ï¼šåˆç´„æŒå€‰æœ‰è³‡é‡‘è²»ç‡æˆæœ¬ï¼Œå›æ¸¬ä¸å«æ­¤æˆæœ¬æœƒåš´é‡é«˜ä¼°
2. **Volume Slippage æœªé–‹å•Ÿ**ï¼šå¤§å–®äº¤æ˜“æœ‰å¸‚å ´è¡æ“Šï¼Œå›ºå®šæ»‘é»ä½ä¼°çœŸå¯¦æˆæœ¬
3. **ä¸åŒè…³æœ¬èµ°ä¸åŒè·¯å¾‘**ï¼šçµ„åˆå›æ¸¬ç¹éäº†æˆæœ¬æ¨¡å‹

**è§£æ±ºæ–¹æ³•**ï¼š

```yaml
# config ä¸­å¿…é ˆé–‹å•Ÿï¼ˆåˆç´„æ¨¡å¼ï¼‰
backtest:
  funding_rate:
    enabled: true        # â­ å¿…é ˆ
  slippage_model:
    enabled: true        # â­ å¿…é ˆ
```

```bash
# åš´æ ¼å›æ¸¬ï¼ˆå«æ‰€æœ‰æˆæœ¬æ¨¡å‹ï¼‰â€” é è¨­è¡Œç‚º
python scripts/run_backtest.py -c config/futures_rsi_adx_atr.yaml

# ç°¡æ˜“å›æ¸¬ï¼ˆè·³éæˆæœ¬æ¨¡å‹ï¼Œåƒ…ä¾›å¿«é€Ÿå°æ¯”ï¼‰
python scripts/run_backtest.py -c config/futures_rsi_adx_atr.yaml --simple
```

**ç³»çµ±é˜²è­·æ©Ÿåˆ¶**ï¼š
- `validate_backtest_config()` æœƒåœ¨åˆç´„æ¨¡å¼ä¸‹è‡ªå‹•è­¦å‘Šæœªé–‹å•Ÿçš„æˆæœ¬æ¨¡å‹
- `BacktestResult` dataclass æ¨™æº–åŒ–å›æ¸¬è¼¸å‡ºï¼Œæ‰€æœ‰è…³æœ¬å…±ç”¨åŒä¸€å¥—æˆæœ¬é‚è¼¯
- çµ„åˆå›æ¸¬ (`run_portfolio_backtest.py`) å·²é‡æ§‹ç‚ºå‘¼å« `run_symbol_backtest`ï¼Œä¸å†ç¹éæˆæœ¬

**æ•™è¨“**ï¼šAVAX/LINK/XRP/BNB åœ¨ç°¡æ˜“å›æ¸¬ä¸‹çœ‹ä¼¼ä¸éŒ¯ï¼Œåš´æ ¼ç‰ˆå…¨éƒ¨çˆ†è™§ã€‚**æ°¸é ç”¨åš´æ ¼ç‰ˆåšæ±ºç­–**ã€‚

### Q15: å‡ºç¾ä¸æ˜äº¤æ˜“ï¼ˆbot log è£¡æ²’æœ‰è¨˜éŒ„ï¼‰ï¼Ÿ

**ç—‡ç‹€**ï¼šåœ¨ Binance äº¤æ˜“è¨˜éŒ„ä¸­çœ‹åˆ°æŸå€‹æ™‚é–“çš„äº¤æ˜“ï¼Œä½† bot çš„æ‰€æœ‰ log æ–‡ä»¶éƒ½æ²’æœ‰å°æ‡‰è¨˜éŒ„ã€‚

**æ’æŸ¥æ­¥é©Ÿ**ï¼š

```bash
# 1. ç¢ºèªæ‰€æœ‰ log è£¡éƒ½æ²’æœ‰è¨˜éŒ„
grep -r "09:44" /home/ubuntu/quant-binance-spot/logs/ 2>/dev/null

# 2. ç¢ºèªæ²’æœ‰å¸¸é§é€²ç¨‹åœ¨è·‘
ps aux | grep run_live | grep -v grep

# 3. ç”¨ API æŸ¥äº¤æ˜“çš„ orderId å’Œ origType
python -c "
from qtrade.live.binance_futures_broker import BinanceFuturesBroker
from datetime import datetime
b = BinanceFuturesBroker(dry_run=True)
for s in ['BTCUSDT', 'ETHUSDT']:
    trades = b.http.signed_get('/fapi/v1/userTrades', {'symbol': s, 'limit': 20})
    for t in trades:
        ts = datetime.fromtimestamp(int(t['time'])/1000)
        oid = t['orderId']
        order = b.http.signed_get('/fapi/v1/order', {'symbol': s, 'orderId': oid})
        print(f'{s} {ts} {t[\"side\"]} origType={order.get(\"origType\")} clientOrderId={order.get(\"clientOrderId\")}')
"
```

**åˆ¤è®€çµæœ**ï¼š

| `origType` | `clientOrderId` ç‰¹å¾µ | ä¾†æº |
|------------|---------------------|------|
| `STOP_MARKET` | ç³»çµ±ç”Ÿæˆ | âœ… SL æ›å–®è‡ªå‹•è§¸ç™¼ |
| `TAKE_PROFIT_MARKET` | ç³»çµ±ç”Ÿæˆ | âœ… TP æ›å–®è‡ªå‹•è§¸ç™¼ |
| `MARKET` | éš¨æ©Ÿå­—ä¸² | âš ï¸ æ‰‹å‹•æ“ä½œï¼ˆBinance App/Webï¼‰ |
| `MARKET` | æœ‰ç‰¹å®šå‰ç¶´ | âš ï¸ å…¶ä»– API/Bot |

å¦‚æœç¢ºèªä¸æ˜¯è‡ªå·±æ“ä½œçš„ï¼Œå»ºè­°åˆ° Binance App â†’ API Management æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»– API Keyã€‚

---

## ä¸‹ä¸€æ­¥

1. **å°ˆæ¡ˆåœ°åœ– & æŒ‡ä»¤é€ŸæŸ¥**ï¼šæŸ¥çœ‹ `CLI_REFERENCE.md`
2. **ç­–ç•¥åƒæ•¸èª¿æ•´**ï¼šç·¨è¼¯ `config/futures_rsi_adx_atr.yaml`
3. **å›æ¸¬é©—è­‰**ï¼šä½¿ç”¨ `scripts/run_backtest.py` å’Œ `scripts/validate.py`

---

## ç¸½çµ

å®Œæ•´çš„ç­–ç•¥é–‹ç™¼æµç¨‹ï¼š

1. âœ… **ç­–ç•¥ç™¼æƒ³**ï¼šè§€å¯Ÿå¸‚å ´ï¼Œå½¢æˆå‡è¨­
2. âœ… **å»ºç«‹ç­–ç•¥**ï¼šç·¨å¯«ç¨‹å¼ç¢¼ï¼Œå¯¦ç¾é‚è¼¯
3. âœ… **å›æ¸¬**ï¼šç”¨æ­·å²è³‡æ–™æ¸¬è©¦
4. âœ… **å„ªåŒ–**ï¼šæ‰¾åˆ°æœ€ä½³åƒæ•¸
5. âœ… **é©—è­‰**ï¼šç¢ºä¿ä¸éæ“¬åˆ
6. âœ… **Kelly é©—è­‰**ï¼šè©•ä¼°å€‰ä½ç®¡ç†æ–¹å¼
7. âœ… **é¢¨éšªç®¡ç†**ï¼šæ–°å¢é¢¨éšªæ§åˆ¶
8. âœ… **Paper Trading**ï¼šæ¨¡æ“¬äº¤æ˜“è§€å¯Ÿ
9. âœ… **ä¸€è‡´æ€§é©—è­‰**ï¼šç¢ºä¿ Live/Backtest ä¸€è‡´
10. âœ… **Pre-Deploy æª¢æŸ¥**ï¼š`validate_live_consistency.py` å…¨éå†ä¸Šç·š
11. âœ… **å¯¦ç›¤**ï¼šå¦‚æœä¸€åˆ‡é †åˆ©ï¼ˆ`live.kline_cache: true` ç¢ºä¿æ•¸æ“šä¸€è‡´ï¼‰
12. âœ… **ç›£æ§**ï¼šå¥åº·æª¢æŸ¥å’Œæ—¥å ±

è¨˜ä½ï¼š**é‡åŒ–äº¤æ˜“ä¸æ˜¯ä¸€å¤œæš´å¯Œï¼Œè€Œæ˜¯æŒçºŒæ”¹é€²çš„éç¨‹**ã€‚

ç¥ä½ äº¤æ˜“é †åˆ©ï¼ğŸ‰
